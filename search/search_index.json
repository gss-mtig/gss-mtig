{"config":{"lang":["es"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"GeoServicios para Smarts Cities","text":"<p>Materiales para el curso sobre Geoservicios para Smart Cities (GSS) del M\u00e0ster Tecnologies de la Informaci\u00f3 Geografica de la UAB</p> <p>Temario:</p>"},{"location":"#httpsgss-mtiggithubiogss-mtig","title":"https://gss-mtig.github.io/gss-mtig/","text":"<ul> <li>Introducci\u00f3n a las Smart Cities<ul> <li>Conceptos Smart Cities</li> <li>Conceptos Open Data</li> <li>Conceptos sensores</li> <li>Tecnolog\u00edas OpenData</li> </ul> </li> <li>Introducci\u00f3n al Open data<ul> <li>API servicios Open data (CKAN y SOCRATA)</li> </ul> </li> <li>Conceptos Vector-Tiles</li> <li>Visualizaci\u00f3n con Kepler.gl</li> <li>Herramientas de visualizaci\u00f3n de datos</li> <li>Conceptos b\u00e1sicos de Geoservicios</li> <li>Ejemplo servicio WMS</li> <li>Consideraciones sobre servicios Open data</li> <li>Ejemplo servicio bicing Barcelona</li> <li>Ejemplo servicio bicing Barcelona (VectorTiles)</li> <li>Consideraciones sobre servicios de Sensores</li> <li>Ejemplo Sentilo ACA</li> <li>Geoservicios realtime</li> <li>Herramientas de visualizaci\u00f3n geoservicios</li> <li>Ejemplo Geocodificador</li> <li>Ejemplo Mobility</li> <li>Ejemplo servicio realtime para compartir la ubicaci\u00f3n</li> <li>Ejemplo GTFS</li> </ul>"},{"location":"#autores","title":"Autores","text":"<ul> <li>Wladimir Szczerban (alias Bolo) @bolosig, MapTiler (Departamento de Geograf\u00eda UAB)</li> <li>Victor Pascual Ayats  @sfggeogis, geostarter (ICGC)</li> </ul> <p>Condiciones de reutilizaci\u00f3n de estos apuntes</p> <p>Estos materiales est\u00e1n publicados bajo licencia CreativeCommons (by-sa) 4.0 internacional</p> <p>Usted es libre de: * Compartir \u2014 copiar y redistribuir el material en cualquier medio o formato * Adaptar \u2014 remezclar, transformar y crear a partir del material para cualquier finalidad, incluso comercial.</p> <p>Bajo las condiciones siguientes:</p> <ul> <li> <p>Reconocimiento \u2014 Debe reconocer adecuadamente la autor\u00eda, proporcionar un enlace a la licencia e indicar si se han realizado cambios. Puede hacerlo de cualquier manera razonable, pero no de una manera que sugiera que tiene el apoyo del licenciador o lo recibe por el uso que hace.</p> </li> <li> <p>CompartirIgual \u2014 Si remezcla, transforma o crea a partir del material, deber\u00e1 difundir sus contribuciones bajo la misma licencia que el original.</p> </li> <li> <p>No hay restricciones adicionales \u2014 No puede aplicar t\u00e9rminos legales o medidas tecnol\u00f3gicas que legalmente restrinjan realizar aquello que la licencia permite.</p> </li> </ul>"},{"location":"10_ejemplo_servicio_bicing_bcn_vt/","title":"Ejemplo servicio bicing Barcelona VectorTiles","text":""},{"location":"10_ejemplo_servicio_bicing_bcn_vt/#acceso-al-servicio-de-datos-del-bicing-de-barcelona","title":"Acceso al servicio de datos del Bicing de Barcelona","text":"<p>En el portal Open data del Ayuntamiento de Barcelona podemos encontrar un dataset (conjunto de datos) que contiene las estaciones del servicio de Bicing</p> <p>Anteriormente ten\u00edan un servicio donde daban toda la informaci\u00f3n de la estaci\u00f3n en tiempo real http://wservice.viabicing.cat/v2/stations. Actualmente lo han separado en dos servicios unos con la informaci\u00f3n de las estaciones (identificador, nombre, coordenadas, etc.) y otro con estado de las estaciones (n\u00famero de bicis disponibles, tipos de bicis, etc)</p> <p>Si bien el Ayuntamiento de Barcelona no ofrece expl\u00edcitamente el acceso a los datos del Bicing como un servicio, si que tiene un servicio de datos en tiempo real. La url la podemos encontrar presionando el bot\u00f3n de Descargar del recurso json</p> <p> url servicio de bicing</p> <p>Al abrir la url https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_information en nuestro navegador observaremos que la respuesta es un archivo json con un conjunto de elementos que tienen las coordenadas de la localizaci\u00f3n de la estaci\u00f3n de bicing, la direcci\u00f3n, la capacidad, etc.</p> <p>Mapa que utiliza este servicio, https://www.bicing.barcelona/es/mapa-de-disponibilidad-provisional</p> <p>El archivo json que retorna el servicio tiene coordenadas pero no es un fichero GeoJSON. <sup>1</sup></p> <p>Para ver estos datos sobre un mapa crearemos un visor utilizando MapLibre GL JS. <sup>2</sup></p>"},{"location":"10_ejemplo_servicio_bicing_bcn_vt/#creacion-de-un-visor","title":"Creaci\u00f3n de un visor","text":"<ul> <li>Crear una carpeta con el nombre de visor-bicing-vt.</li> <li>Crear una carpeta con el nombre de public dentro de la carpeta visor-bicing-vt.</li> <li>Crear un archivo con el nombre de index.html dentro de la carpeta public.</li> <li>Abrir el archivo index.html con un editor de texto y copiar el siguiente c\u00f3digo.</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Servicio de Bicing realtime VectorTiles&lt;/title&gt;\n  &lt;meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' /&gt;\n  &lt;script src='https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.js'&gt;&lt;/script&gt;\n  &lt;link href='https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.css' rel='stylesheet' /&gt;\n\n  &lt;style&gt;\n    body {\n      margin: 0;\n      padding: 0;\n    }\n\n    #map {\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      width: 100%;\n      height: 100%\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script type=\"text/javascript\"&gt;\n    var map = new maplibregl.Map({\n      container: 'map',\n      style: 'https://geoserveis.icgc.cat/contextmaps/icgc.json',\n      center: [2.1777, 41.3887],\n      zoom: 13,\n      maxZoom: 14,\n      hash: true,\n    });\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Abrir el archivo index.html en el navegador para ver que carga un mapa centrado en Barcelona.</li> </ul>"},{"location":"10_ejemplo_servicio_bicing_bcn_vt/#creacion-del-proxy","title":"Creaci\u00f3n del proxy","text":"<p>Crearemos un proxy que nos permita  </p> <ul> <li>Instalar Node.js <sup>3</sup>. Descargar la \u00faltima versi\u00f3n LTS y lo instalaremos con las opciones por defecto. Una vez instalado el Node abrir la consola para verificar que se ha instalado correctamente. Escribir</li> </ul> <pre><code>node -v\n</code></pre> <ul> <li>Navegar hasta nuestra carpeta visor-bicing-vt y escribir:</li> </ul> <pre><code>npm init -y\n</code></pre> <p>Con este comando estaremos creando el archivo package.json. La opci\u00f3n -y acepta todas la opciones por defecto. Si no ponemos la opci\u00f3n -y este comando solicita varios elementos como, por ejemplo, el nombre y la versi\u00f3n de la aplicaci\u00f3n. S\u00f3lo hay que pulsar ENTER para aceptar los valores predeterminados.</p> <ul> <li> <p>Instalar las dependencias para crear nuestro servicio de proxy <sup>4</sup>. En este caso utilizaremos Express <sup>5</sup> como servidor web, el m\u00f3dulo axios <sup>6</sup> y el m\u00f3dulo de cors <sup>7</sup>.</p> </li> <li> <p>Instalar el express y los m\u00f3dulos y guardarlo en la lista de dependencias</p> </li> </ul> <pre><code>npm install --save express axios cors\n</code></pre> <p>Al ejecutar este comando veremos que se crea una carpeta llamada node_modules donde se guardan los m\u00f3dulos instalados.</p> <ul> <li>Instalar el m\u00f3dulo nodemon <sup>8</sup> de manera global.</li> </ul> <pre><code>npm install -g nodemon\n</code></pre> <ul> <li>Crear un archivo llamado app.js que servir\u00e1 de proxy con el servicio de Bicing. Copiar lo siguiente en este archivo.</li> </ul> <pre><code>var express  = require('express');\nvar app      = express();\nvar cors = require('cors');\nvar axios = require('axios');\nvar serverBicing = 'https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_information';\n\napp.use(cors());\napp.use(express.static('public'));\n\napp.all(\"/bicingjson/*\", function(req, res) {\n  console.log('redirecting to Server2');\n  var geojson = {\n    type: 'FeatureCollection',\n    features: []\n  };\n  axios.get(serverBicing).then(function(response){\n    // handle success\n    var stations = response.data.data.stations;\n    for (let i = stations.length - 1; i &gt;= 0; i--) {\n      var station = stations[i];\n      var feature = {\n        type: 'Feature',\n        properties: {\n          altitude: station.altitude,\n          id: station.station_id,\n          address: station.address,\n          post_code: station.post_code,\n          capacity: station.capacity\n        },\n        geometry: {\n          type: 'Point',\n          coordinates: [station.lon, station.lat]\n        }\n      };\n      geojson.features.push(feature);\n    }\n    res.send(geojson);\n  }).catch(function (error) {\n    console.log(error);\n    res.send(error);\n  });\n});\n\napp.listen(3000);\n</code></pre> <ul> <li>Probar que nuestro proxy est\u00e1 funcionando, escribiendo:</li> </ul> <pre><code>nodemon app.js\n</code></pre> <ul> <li> <p>Abrir la url de nuestro proxy http://localhost:3000/bicingjson/ en el navegador.</p> </li> <li> <p>Escribir en el navegador http://localhost:3000 para ver nuestro mapa.</p> </li> </ul>"},{"location":"10_ejemplo_servicio_bicing_bcn_vt/#modificar-el-visor","title":"Modificar el visor","text":"<ul> <li>Modificar el archivo index.html para que llame al proxy que hemos creado y cargue la capa de bicing. Escribir justo despu\u00e9s de la declaraci\u00f3n del mapa.</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Servicio de Bicing realtime VectorTiles&lt;/title&gt;\n  &lt;meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' /&gt;\n  &lt;script src='https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.js'&gt;&lt;/script&gt;\n  &lt;link href='https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.css' rel='stylesheet' /&gt;\n  &lt;style&gt;\n    body {\n      margin: 0;\n      padding: 0;\n    }\n\n    #map {\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      width: 100%;\n      height: 100%\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script type=\"text/javascript\"&gt;\n    var map = new maplibregl.Map({\n      container: 'map',\n      style: 'https://geoserveis.icgc.cat/contextmaps/icgc.json',\n      center: [2.1777, 41.3887],\n      zoom: 13,\n      maxZoom: 14,\n      hash: true,\n    });\n\n    map.on(\"load\", function() {\n      //funcion que se llama al terminar de cargar el estilo del mapa\n\n      //agregamos la fuente de datos al mapa\n      map.addSource('bicing-source', {\n        type: 'geojson',\n        data: 'http://localhost:3000/bicingjson/'\n      });\n\n      //agregamos la capa con su estilo al mapa\n      map.addLayer({\n        \"id\": \"bicing\",\n        \"type\": \"circle\",\n        \"source\": \"bicing-source\",\n        \"paint\": {\n            \"circle-radius\": 6,\n            \"circle-color\": \"#B42222\"\n        },\n      });\n    });\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar la aplicaci\u00f3n y veremos los puntos de las estaciones de bicing.</p> </li> <li> <p>Actualizar los datos del mapa. Para actualizar los datos del mapa se debe recargar la capa de estaciones de bicing cada X tiempo. Para recargar la capa cada 3 segundos escribir los siguiente al final de la funci\u00f3n que se llama al terminar de cargar el estilo del mapa.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Servicio de Bicing realtime VectorTiles&lt;/title&gt;\n  &lt;meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' /&gt;\n  &lt;script src='https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.js'&gt;&lt;/script&gt;\n  &lt;link href='https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.css' rel='stylesheet' /&gt;\n  &lt;style&gt;\n    body {\n      margin: 0;\n      padding: 0;\n    }\n\n    #map {\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      width: 100%;\n      height: 100%\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script type=\"text/javascript\"&gt;\n    var map = new maplibregl.Map({\n      container: 'map',\n      style: 'https://geoserveis.icgc.cat/contextmaps/icgc.json',\n      center: [2.1777, 41.3887],\n      zoom: 13,\n      maxZoom: 14,\n      hash: true,\n    });\n\n    map.on(\"load\", function() {\n      //funcion que se llama al terminar de cargar el estilo del mapa\n\n      //agregamos la fuente de datos al mapa\n      map.addSource('bicing-source', {\n        type: 'geojson',\n        data: 'http://localhost:3000/bicingjson/'\n      });\n\n      //agregamos la capa con su estilo al mapa\n      map.addLayer({\n        \"id\": \"bicing\",\n        \"type\": \"circle\",\n        \"source\": \"bicing-source\",\n        \"paint\": {\n            \"circle-radius\": 6,\n            \"circle-color\": \"#B42222\"\n        },\n      });\n\n      window.setInterval(function() {\n        map.getSource('bicing-source').setData('http://localhost:3000/bicingjson/');\n      }, 3000);\n    });\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar la aplicaci\u00f3n y veremos los puntos de las estaciones de bicing. Si vamos a la pesta\u00f1a de red (network) en la consola de desarrollador del navegador podremos ver que cada 3 segundos se hace una llamada a nuestro proxy.</p> </li> <li> <p>Cambiar el estilo de la capa de estaciones de bicing. Para representar las estaciones con un estilo basado en los valores de algunos de sus atributos utilizar el data-driven style siguiendo la especificaci\u00f3n de estilo de MapLibre <sup>9</sup>. Modificar la propiedad paint de la capa y escribir</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Servicio de Bicing realtime VectorTiles&lt;/title&gt;\n  &lt;meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' /&gt;\n  &lt;script src='https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.js'&gt;&lt;/script&gt;\n  &lt;link href='https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.css' rel='stylesheet' /&gt;\n  &lt;style&gt;\n    body {\n      margin: 0;\n      padding: 0;\n    }\n\n    #map {\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      width: 100%;\n      height: 100%\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script type=\"text/javascript\"&gt;\n    var map = new maplibregl.Map({\n      container: 'map',\n      style: 'https://geoserveis.icgc.cat/contextmaps/icgc.json',\n      center: [2.1777, 41.3887],\n      zoom: 13,\n      maxZoom: 14,\n      hash: true,\n    });\n\n    map.on(\"load\", function() {\n      //funcion que se llama al terminar de cargar el estilo del mapa\n\n      //agregamos la fuente de datos al mapa\n      map.addSource('bicing-source', {\n        type: 'geojson',\n        data: 'http://localhost:3000/bicingjson/'\n      });\n\n      //agregamos la capa con su estilo al mapa\n      map.addLayer({\n        \"id\": \"bicing\",\n        \"type\": \"circle\",\n        \"source\": \"bicing-source\",\n        \"paint\": {\n          \"circle-radius\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"to-number\", ['get','capacity']],\n            15,\n            5,\n            50,\n            33\n          ],\n          \"circle-color\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"to-number\", [\"get\", \"altitude\"]],\n            0,\n            \"hsl(0, 88%, 55%)\",\n            50,\n            \"hsl(108, 93%, 59%)\"\n          ],\n          \"circle-opacity\": 0.86\n        },\n      });\n\n      window.setInterval(function() {\n        map.getSource('bicing-source').setData('http://localhost:3000/bicingjson/');\n      }, 3000);\n    });\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar la aplicaci\u00f3n y veremos el cambio de estilo de los puntos de las estaciones de bicing.</p> </li> <li> <p>Crear un popup para ver la informaci\u00f3n de la estaci\u00f3n al seleccionarla. Escribir despu\u00e9s de donde definimos el onload</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Servicio de Bicing realtime VectorTiles&lt;/title&gt;\n  &lt;meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' /&gt;\n  &lt;script src='https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.js'&gt;&lt;/script&gt;\n  &lt;link href='https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.css' rel='stylesheet' /&gt;\n  &lt;style&gt;\n    body {\n      margin: 0;\n      padding: 0;\n    }\n\n    #map {\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      width: 100%;\n      height: 100%\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script type=\"text/javascript\"&gt;\n    var map = new maplibregl.Map({\n      container: 'map',\n      style: 'https://geoserveis.icgc.cat/contextmaps/icgc.json',\n      center: [2.1777, 41.3887],\n      zoom: 13,\n      maxZoom: 14,\n      hash: true,\n    });\n\n    map.on(\"load\", function() {\n      //funcion que se llama al terminar de cargar el estilo del mapa\n\n      //agregamos la fuente de datos al mapa\n      map.addSource('bicing-source', {\n        type: 'geojson',\n        data: 'http://localhost:3000/bicingjson/'\n      });\n\n      //agregamos la capa con su estilo al mapa\n      map.addLayer({\n        \"id\": \"bicing\",\n        \"type\": \"circle\",\n        \"source\": \"bicing-source\",\n        \"paint\": {\n          \"circle-radius\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"to-number\", ['get','capacity']],\n            15,\n            5,\n            50,\n            33\n          ],\n          \"circle-color\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"to-number\", [\"get\", \"altitude\"]],\n            0,\n            \"hsl(0, 88%, 55%)\",\n            50,\n            \"hsl(108, 93%, 59%)\"\n          ],\n          \"circle-opacity\": 0.86\n        },\n      });\n\n      window.setInterval(function() {\n        map.getSource('bicing-source').setData('http://localhost:3000/bicingjson/');\n      }, 3000);\n    });\n\n    map.on('click', function(e) {\n      var features = map.queryRenderedFeatures(e.point, { layers: ['bicing'] });\n\n      // if the features have no info, return nothing\n      if (!features.length) {\n          return;\n      }\n\n      var feature = features[0];\n\n      // Populate the popup and set its coordinates\n      // based on the feature found\n      var popup = new maplibregl.Popup()\n      .setLngLat(feature.geometry.coordinates)\n      .setHTML('&lt;div id=\\'popup\\' class=\\'popup\\' style=\\'z-index: 10;\\'&gt; &lt;h5&gt; ' + feature.properties.id + ' &lt;/h5&gt;' +\n      '&lt;ul class=\\'list-group\\'&gt;' +\n      '&lt;li class=\\'list-group-item\\'&gt; ' + feature.properties.address + ' &lt;/li&gt;' +\n      '&lt;li class=\\'list-group-item\\'&gt; Altitud: ' + feature.properties.altitude + ' &lt;/li&gt;' +\n      '&lt;li class=\\'list-group-item\\'&gt; Capacidad: ' + feature.properties.capacity + ' &lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;')\n      .addTo(map);\n    });\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar la p\u00e1gina y hacer click sobre alguna estaci\u00f3n para ver su informaci\u00f3n en tiempo real.</p> </li> <li> <p>Cambiar el tipo de cursor al pasar sobre una estaci\u00f3n. Escribir despu\u00e9s de donde definimos el onload</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Servicio de Bicing realtime VectorTiles&lt;/title&gt;\n  &lt;meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' /&gt;\n  &lt;script src='https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.js'&gt;&lt;/script&gt;\n  &lt;link href='https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.css' rel='stylesheet' /&gt;\n  &lt;style&gt;\n    body {\n      margin: 0;\n      padding: 0;\n    }\n\n    #map {\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      width: 100%;\n      height: 100%\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script type=\"text/javascript\"&gt;\n    var map = new maplibregl.Map({\n      container: 'map',\n      style: 'https://geoserveis.icgc.cat/contextmaps/icgc.json',\n      center: [2.1777, 41.3887],\n      zoom: 13,\n      maxZoom: 14,\n      hash: true,\n    });\n\n    map.on(\"load\", function() {\n      //funcion que se llama al terminar de cargar el estilo del mapa\n\n      //agregamos la fuente de datos al mapa\n      map.addSource('bicing-source', {\n        type: 'geojson',\n        data: 'http://localhost:3000/bicingjson/'\n      });\n\n      //agregamos la capa con su estilo al mapa\n      map.addLayer({\n        \"id\": \"bicing\",\n        \"type\": \"circle\",\n        \"source\": \"bicing-source\",\n        \"paint\": {\n          \"circle-radius\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"to-number\", ['get','capacity']],\n            15,\n            5,\n            50,\n            33\n          ],\n          \"circle-color\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"to-number\", [\"get\", \"altitude\"]],\n            0,\n            \"hsl(0, 88%, 55%)\",\n            50,\n            \"hsl(108, 93%, 59%)\"\n          ],\n          \"circle-opacity\": 0.86\n        },\n      });\n\n      window.setInterval(function() {\n        map.getSource('bicing-source').setData('http://localhost:3000/bicingjson/');\n      }, 3000);\n    });\n\n    map.on('click', function(e) {\n      var features = map.queryRenderedFeatures(e.point, { layers: ['bicing'] });\n\n      // if the features have no info, return nothing\n      if (!features.length) {\n          return;\n      }\n\n      var feature = features[0];\n\n      // Populate the popup and set its coordinates\n      // based on the feature found\n      var popup = new maplibregl.Popup()\n      .setLngLat(feature.geometry.coordinates)\n      .setHTML('&lt;div id=\\'popup\\' class=\\'popup\\' style=\\'z-index: 10;\\'&gt; &lt;h5&gt; ' + feature.properties.id + ' &lt;/h5&gt;' +\n      '&lt;ul class=\\'list-group\\'&gt;' +\n      '&lt;li class=\\'list-group-item\\'&gt; ' + feature.properties.address + ' &lt;/li&gt;' +\n      '&lt;li class=\\'list-group-item\\'&gt; Altitud: ' + feature.properties.altitude + ' &lt;/li&gt;' +\n      '&lt;li class=\\'list-group-item\\'&gt; Capacidad: ' + feature.properties.capacity + ' &lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;')\n      .addTo(map);\n    });\n\n    // Use the same approach as above to indicate that the symbols are clickable\n    // by changing the cursor style to 'pointer'\n    map.on('mousemove', function(e) {\n        var features = map.queryRenderedFeatures(e.point, { layers: ['bicing'] });\n        map.getCanvas().style.cursor = features.length ? 'pointer' : '';\n    });\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Recargar la p\u00e1gina y pasar sobre alguna estaci\u00f3n para ver el cambio del cursor.</li> </ul> <p> mapa de servicio de bicing</p>"},{"location":"10_ejemplo_servicio_bicing_bcn_vt/#modificar-el-proxy","title":"Modificar el proxy","text":"<p>Modificaremos el proxy para agregar los datos de disponibilidad de bicis en las estaciones. Para ello debemos llamar al servicio de estado de estaciones.</p> <p>Al abrir la url del servicio podemos ver que est\u00e1 el listado de las estaciones con una serie de datos. En este caso no hay datos de posici\u00f3n, ni de descripci\u00f3n s\u00f3lo datos del estado de la estaci\u00f3n. Podemos ver que tambi\u00e9n hay un campo con el station_id que nos servir\u00e1 para vincular los datos de estado de la estaci\u00f3n con la estaci\u00f3n correspondiente.</p> <ul> <li>Agregar la url del servicio de estado de estaciones</li> </ul> <pre><code>var express  = require('express');\nvar app      = express();\nvar cors = require('cors');\nvar axios = require('axios');\nvar serverBicing = 'https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_information';\nvar statusBicing = 'https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_status';\n\napp.use(cors());\napp.use(express.static('public'));\n\napp.all(\"/bicingjson/*\", function(req, res) {\n  console.log('redirecting to Server2');\n  var geojson = {\n    type: 'FeatureCollection',\n    features: []\n  };\n  axios.get(serverBicing).then(function(response){\n    // handle success\n    var stations = response.data.data.stations;\n    for (var i = stations.length - 1; i &gt;= 0; i--) {\n      var station = stations[i];\n      var feature = {\n        type: 'Feature',\n        properties: {\n          altitude: station.altitude,\n          id: station.station_id,\n          address: station.address,\n          post_code: station.post_code,\n          capacity: station.capacity\n        },\n        geometry: {\n          type: 'Point',\n          coordinates: [station.lon, station.lat]\n        }\n      };\n      geojson.features.push(feature);\n    }\n    res.send(geojson);\n  }).catch(function (error) {\n    console.log(error);\n    res.send(error);\n  });\n});\n\napp.listen(3000);\n</code></pre> <ul> <li>Combinar la informaci\u00f3n del estado de estaciones con la informaci\u00f3n de la estaci\u00f3n</li> </ul> <pre><code>var express  = require('express');\nvar app      = express();\nvar cors = require('cors');\nvar axios = require('axios');\nvar serverBicing = 'https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_information';\nvar statusBicing = 'https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_status';\n\napp.use(cors());\napp.use(express.static('public'));\n\napp.all(\"/bicingjson/*\", function(req, res) {\n  console.log('redirecting to Server2');\n  var geojson = {\n    type: 'FeatureCollection',\n    features: []\n  };\n\n  Promise.all([axios.get(serverBicing), axios.get(statusBicing)]).then((responses) =&gt; {\n    var stations = responses[0].data.data.stations;\n    for (var i = stations.length - 1; i &gt;= 0; i--) {\n      var station = stations[i];\n      var feature = {\n        type: 'Feature',\n        properties: {\n          altitude: station.altitude,\n          id: station.station_id,\n          address: station.address,\n          post_code: station.post_code,\n          capacity: station.capacity\n        },\n        geometry: {\n          type: 'Point',\n          coordinates: [station.lon, station.lat]\n        }\n      };\n      geojson.features.push(feature);\n    }\n\n    var status = responses[1].data.data.stations;\n\n    for (var i = status.length - 1; i &gt;= 0; i--) {\n        var stat = status[i];\n        for (var j = geojson.features.length - 1; j &gt;= 0; j--) {\n            var feat = geojson.features[j];\n            if(feat.properties.id === stat.station_id) {\n                feat.properties.num_bikes_available = stat.num_bikes_available;\n                feat.properties.num_bikes_available_types = stat.num_bikes_available_types;\n                feat.properties.num_docks_available = stat.num_docks_available;\n            }\n        }\n    }\n    res.send(geojson);\n  }).catch(function (error) {\n    console.log(error);\n    res.send(error);\n  });\n});\n\napp.listen(3000);\n</code></pre>"},{"location":"10_ejemplo_servicio_bicing_bcn_vt/#modificar-el-visor_1","title":"Modificar el visor","text":"<ul> <li>Modificaremos el visor para cambiar el color del c\u00edrculo dependiendo del n\u00famere de bicis disponibles en la estaci\u00f3n</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Servicio de Bicing realtime VectorTiles&lt;/title&gt;\n  &lt;meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' /&gt;\n  &lt;script src='https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.js'&gt;&lt;/script&gt;\n  &lt;link href='https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.css' rel='stylesheet' /&gt;\n  &lt;style&gt;\n    body {\n      margin: 0;\n      padding: 0;\n    }\n\n    #map {\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      width: 100%;\n      height: 100%\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script type=\"text/javascript\"&gt;\n    var map = new maplibregl.Map({\n      container: 'map',\n      style: 'https://geoserveis.icgc.cat/contextmaps/icgc.json',\n      center: [2.1777, 41.3887],\n      zoom: 13,\n      maxZoom: 14,\n      hash: true,\n    });\n\n    map.on(\"load\", function() {\n      //funcion que se llama al terminar de cargar el estilo del mapa\n\n      //agregamos la fuente de datos al mapa\n      map.addSource('bicing-source', {\n        type: 'geojson',\n        data: 'http://localhost:3000/bicingjson/'\n      });\n\n      //agregamos la capa con su estilo al mapa\n      map.addLayer({\n        \"id\": \"bicing\",\n        \"type\": \"circle\",\n        \"source\": \"bicing-source\",\n        \"paint\": {\n          \"circle-radius\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"to-number\", ['get','capacity']],\n            15,\n            5,\n            50,\n            33\n          ],\n          \"circle-color\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"to-number\", [\"get\", \"num_bikes_available\"]],\n            0,\n            \"#ff0000\",\n            15,\n            \"#00ff00\"\n          ],\n          \"circle-opacity\": 0.86\n        },\n      });\n\n      window.setInterval(function() {\n        map.getSource('bicing-source').setData('http://localhost:3000/bicingjson/');\n      }, 3000);\n    });\n\n    map.on('click', function(e) {\n      var features = map.queryRenderedFeatures(e.point, { layers: ['bicing'] });\n\n      // if the features have no info, return nothing\n      if (!features.length) {\n          return;\n      }\n\n      var feature = features[0];\n\n      // Populate the popup and set its coordinates\n      // based on the feature found\n      var popup = new maplibregl.Popup()\n      .setLngLat(feature.geometry.coordinates)\n      .setHTML('&lt;div id=\\'popup\\' class=\\'popup\\' style=\\'z-index: 10;\\'&gt; &lt;h5&gt; ' + feature.properties.id + ' &lt;/h5&gt;' +\n      '&lt;ul class=\\'list-group\\'&gt;' +\n      '&lt;li class=\\'list-group-item\\'&gt; ' + feature.properties.address + ' &lt;/li&gt;' +\n      '&lt;li class=\\'list-group-item\\'&gt; Altitud: ' + feature.properties.altitude + ' &lt;/li&gt;' +\n      '&lt;li class=\\'list-group-item\\'&gt; Capacidad: ' + feature.properties.capacity + ' &lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;')\n      .addTo(map);\n    });\n\n    // Use the same approach as above to indicate that the symbols are clickable\n    // by changing the cursor style to 'pointer'\n    map.on('mousemove', function(e) {\n        var features = map.queryRenderedFeatures(e.point, { layers: ['bicing'] });\n        map.getCanvas().style.cursor = features.length ? 'pointer' : '';\n    });\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Modificar el visor para mostrar la informaci\u00f3n del n\u00famero de bicicletas disponibles</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Servicio de Bicing realtime VectorTiles&lt;/title&gt;\n  &lt;meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' /&gt;\n  &lt;script src='https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.js'&gt;&lt;/script&gt;\n  &lt;link href='https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.css' rel='stylesheet' /&gt;\n  &lt;style&gt;\n    body {\n      margin: 0;\n      padding: 0;\n    }\n\n    #map {\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      width: 100%;\n      height: 100%\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script type=\"text/javascript\"&gt;\n    var map = new maplibregl.Map({\n      container: 'map',\n      style: 'https://geoserveis.icgc.cat/contextmaps/icgc.json',\n      center: [2.1777, 41.3887],\n      zoom: 13,\n      maxZoom: 14,\n      hash: true,\n    });\n\n    map.on(\"load\", function() {\n      //funcion que se llama al terminar de cargar el estilo del mapa\n\n      //agregamos la fuente de datos al mapa\n      map.addSource('bicing-source', {\n        type: 'geojson',\n        data: 'http://localhost:3000/bicingjson/'\n      });\n\n      //agregamos la capa con su estilo al mapa\n      map.addLayer({\n        \"id\": \"bicing\",\n        \"type\": \"circle\",\n        \"source\": \"bicing-source\",\n        \"paint\": {\n          \"circle-radius\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"to-number\", ['get','capacity']],\n            15,\n            5,\n            50,\n            33\n          ],\n          \"circle-color\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"to-number\", [\"get\", \"num_bikes_available\"]],\n            0,\n            \"#ff0000\",\n            15,\n            \"#00ff00\"\n          ],\n          \"circle-opacity\": 0.86\n        },\n      });\n\n      window.setInterval(function() {\n        map.getSource('bicing-source').setData('http://localhost:3000/bicingjson/');\n      }, 3000);\n    });\n\n    map.on('click', function(e) {\n      var features = map.queryRenderedFeatures(e.point, { layers: ['bicing'] });\n\n      // if the features have no info, return nothing\n      if (!features.length) {\n          return;\n      }\n\n      var feature = features[0];\n\n      // Populate the popup and set its coordinates\n      // based on the feature found\n      var popup = new maplibregl.Popup()\n      .setLngLat(feature.geometry.coordinates)\n      .setHTML('&lt;div id=\\'popup\\' class=\\'popup\\' style=\\'z-index: 10;\\'&gt; &lt;h5&gt; ' + feature.properties.id + ' &lt;/h5&gt;' +\n      '&lt;ul class=\\'list-group\\'&gt;' +\n      '&lt;li class=\\'list-group-item\\'&gt; ' + feature.properties.address + ' &lt;/li&gt;' +\n      '&lt;li class=\\'list-group-item\\'&gt; Bicis disponibles: ' + feature.properties.num_bikes_available + ' &lt;/li&gt;' +\n      '&lt;li class=\\'list-group-item\\'&gt; Docks disponibles: ' + feature.properties.num_docks_available + ' &lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;')\n      .addTo(map);\n    });\n\n    // Use the same approach as above to indicate that the symbols are clickable\n    // by changing the cursor style to 'pointer'\n    map.on('mousemove', function(e) {\n        var features = map.queryRenderedFeatures(e.point, { layers: ['bicing'] });\n        map.getCanvas().style.cursor = features.length ? 'pointer' : '';\n    });\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>Ejercicios 2 pts</p> <p>Cambiar el estilo de los puntos de las estaciones. </p> <ol> <li>Cambiar los rangos del tama\u00f1o del punto (1 pt).</li> <li>Cambiar el rango de colores (1 pt).</li> </ol>"},{"location":"10_ejemplo_servicio_bicing_bcn_vt/#referencias","title":"Referencias","text":"<ol> <li> <p>https://es.wikipedia.org/wiki/GeoJSON \u21a9</p> </li> <li> <p>https://maplibre.org/maplibre-gl-js-docs/api/ \u21a9</p> </li> <li> <p>https://nodejs.org/es/ \u21a9</p> </li> <li> <p>https://es.wikipedia.org/wiki/Servidor_proxy \u21a9</p> </li> <li> <p>http://expressjs.com/ \u21a9</p> </li> <li> <p>https://github.com/axios/axios \u21a9</p> </li> <li> <p>https://www.npmjs.com/package/cors \u21a9</p> </li> <li> <p>https://www.npmjs.com/package/nodemon \u21a9</p> </li> <li> <p>https://maplibre.org/maplibre-gl-js-docs/style-spec/ \u21a9</p> </li> </ol>"},{"location":"11_consideraciones_servicios_realtime_sensores/","title":"Consideraciones sobre servicios de Sensores","text":""},{"location":"11_consideraciones_servicios_realtime_sensores/#problemas-frecuentes-al-trabajar-con-sensores","title":"Problemas frecuentes al trabajar con sensores","text":"<ul> <li> <p>Existe el est\u00e1ndar SOS de la OGC <sup>1</sup>, pero tiene poca implementaci\u00f3n, debido a que algunos de los fabricantes de sensores utilizan formatos propios, lo que dificulta la integraci\u00f3n de sensores de diferentes proveedores en un s\u00f3lo sistema.</p> </li> <li> <p>Datos err\u00f3neos y falsos, ya sea por una mala lectura \u00f3 porque el sensor no est\u00e1 funcionando correctamente. No tenemos forma de saber si el dato es correcto. Ejemplo</p> </li> </ul>"},{"location":"11_consideraciones_servicios_realtime_sensores/#ejemplo-de-buenas-practicas","title":"Ejemplo de buenas pr\u00e1cticas","text":"<p>El servicio de datos sobre embalses ofrecidos por la ACA (Agencia Catalana del Agua)http://aca.gencat.cat/ca/laigua/consulta-de-dades/dades-obertes/. Es un ejemplo de buenas pr\u00e1cticas porque est\u00e1 bien documentado y contiene ejemplos. El acceso es libre y gratuito y tiene salida en un mapa para los usuarios que no sean desarrolladores.</p> <p>Ejemplo de salida http://aca-web.gencat.cat/sdim2/apirest/catalog?componentType=embassament</p> <p>Si bien el formato de salida es un JSON donde tiene una propiedad location no es un formato geogr\u00e1fico que podamos utilizar directamente para poner en un mapa, para ello tendr\u00edamos que hacer una transformaci\u00f3n hacia alg\u00fan formato geogr\u00e1fico tipo GeoJSON.</p>"},{"location":"11_consideraciones_servicios_realtime_sensores/#ejemplo-de-malas-practicas","title":"Ejemplo de \"malas\" pr\u00e1cticas","text":"<p>El servicio de la DIBA https://www.diba.cat/es/web/smartregion/ptgu ya que para acceder a los servicios es necesaria una API Key y para obtenerla hay que enviar un email con nuestros datos y el motivo de uso. El simple hecho de tener que registrarse ya es una barrera.</p> <p>El acceso a la aplicaci\u00f3n http://sentilo.diba.cat/sentilo-catalog-web/ no es f\u00e1cil de encontrar y no hay ninguna documentaci\u00f3n.</p>"},{"location":"11_consideraciones_servicios_realtime_sensores/#referencias","title":"Referencias","text":"<ol> <li> <p>http://www.opengeospatial.org/standards/sos \u21a9</p> </li> </ol>"},{"location":"12_ejemplo_sentilo_aca/","title":"Ejemplo Sentilo ACA","text":""},{"location":"12_ejemplo_sentilo_aca/#acceso-al-servicio-de-sensores-sentilo-de-la-aca","title":"Acceso al servicio de sensores Sentilo de la ACA","text":"<p>En el apartado de consulta de datos de la p\u00e1gina de la ACA <sup>1</sup> encontraremos un subapartado de datos en tiempo real, estos datos los sirven utilizando la plataforma de sensores Sentilo <sup>2</sup>. Los sensores dan informaci\u00f3n sobre los diferentes embalses/pantanos que hay en Catalu\u00f1a.</p> <p>La p\u00e1gina tiene un acceso a un mapa con los datos de los diferentes sensores <sup>3</sup> este mapa es el que ofrece la plataforma de Sentilo y est\u00e1 basado en tecnolog\u00eda de Google Maps.</p> <p>Tambi\u00e9n encontraremos la documentaci\u00f3n <sup>4</sup> para usar la API, lo que nos permite acceder a los datos y generar nuestro propio visor.</p>"},{"location":"12_ejemplo_sentilo_aca/#creacion-de-un-visor","title":"Creaci\u00f3n de un visor","text":"<p>Para crear un visor de mapas utilizaremos la librer\u00eda de mapas Leaflet <sup>5</sup>.  </p> <ul> <li> <p>Crear una carpeta con el nombre de visor-aca.</p> </li> <li> <p>Crear una carpeta con el nombre de public dentro de la carpeta visor-aca.</p> </li> <li> <p>Crear un archivo con el nombre de index.html dentro de la carpeta public.</p> </li> <li> <p>Abrir el archivo index.html con un editor de texto y copiar el siguiente c\u00f3digo.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n  &lt;title&gt;Ejemplo Sentilo ACA&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n        height: 100%;\n        width: 100%;\n        position: absolute;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script&gt;\n    var map = L.map('map');\n\n    map.setView([41.5087, 2.1777], 8);  \n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n        attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Abrir el archivo index.html en el navegador para confirmar que se carga un mapa centrado en Catalu\u00f1a.</p> </li> <li> <p>Consultar la documentaci\u00f3n de la API y buscar la url de descripci\u00f3n del servicio que es http://aca-web.gencat.cat/sdim2/apirest/catalog. Abrir esta url en el navegador y confirmar que responde un JSON con la informaci\u00f3n de los diferentes sensores.</p> </li> <li> <p>Revisar el JSON de salida y buscar la propiedad location que indica las coordenadas de la ubicaci\u00f3n del sensor. A pesar de que el JSON tiene coordenadas no es un GeoJSON y por lo tanto no lo podemos pintar autom\u00e1ticamente en nuestro mapa.</p> </li> <li> <p>Cargar este JSON en nuestro mapa utilizando un plugin de Leaflet llamado leaflet-ajax <sup>6</sup>. Este plugin permite hacer una llamada AJAX a un servicio que retorne un JSON y cargar la respuesta en un mapa. Para cargar este plugin debemos agregar lo siguiente justo despu\u00e9s de donde hemos cargado el leaflet</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n  &lt;title&gt;Ejemplo Sentilo ACA&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n        height: 100%;\n        width: 100%;\n        position: absolute;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"&gt;&lt;/script&gt;\n  &lt;script&gt;\n    var map = L.map('map');\n\n    map.setView([41.5087, 2.1777], 8);  \n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n        attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Utilizar el plugin para agregar la capa al mapa llamando a la API de la ACA. Agregar lo siguiente al final de nuestro c\u00f3digo:</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n  &lt;title&gt;Ejemplo Sentilo ACA&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n        height: 100%;\n        width: 100%;\n        position: absolute;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"&gt;&lt;/script&gt;\n  &lt;script&gt;\n    var map = L.map('map');\n\n    map.setView([41.5087, 2.1777], 8);  \n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n\n    var geojsonLayer = new L.GeoJSON.AJAX('http://aca-web.gencat.cat/sdim2/apirest/catalog').addTo(map);\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Recargar la p\u00e1gina y confirmar que no aparece ninguna informaci\u00f3n en el mapa. En muchas ocasiones al abrir la consola de desarrollador del navegador (Ctrl+F12) vemos que aparece un mensaje de error XMLHttpRequest cannot load ... ello es debido a que estamos llamando a un servicio que no est\u00e1 en nuestro dominio y por lo tanto da un error de CORS <sup>7</sup>. Para evitar el error de CORS necesitamos un proxy <sup>8</sup> en nuestro servidor web que pueda hacer la llamada al servicio de la ACA y que nos devuelva el contenido.</li> </ul>"},{"location":"12_ejemplo_sentilo_aca/#creacion-del-proxy","title":"Creaci\u00f3n del proxy","text":"<ul> <li>Instalar Node.js <sup>9</sup>. Descargar la \u00faltima versi\u00f3n LTS y lo instalaremos con las opciones por defecto. Abrir la consola para verificar que se ha instalado correctamente y escribir</li> </ul> <pre><code>node -v\n</code></pre> <ul> <li>Navegar hasta nuestra carpeta visor-aca y escribir:</li> </ul> <pre><code>npm init -y\n</code></pre> <p>Con este comando estaremos creando el archivo package.json con los valores predeterminados.</p> <ul> <li> <p>Instalar las dependencias para crear nuestro servicio de proxy. En este caso utilizaremos Express <sup>10</sup> como servidor web, el m\u00f3dulo http-proxy <sup>11</sup> y el m\u00f3dulo de cors <sup>12</sup>.</p> </li> <li> <p>Instalar el express y guardarlo en la lista de dependencias</p> </li> </ul> <pre><code>npm install --save express http-proxy cors\n</code></pre> <p>Al ejecutar este comando veremos que se crea una carpeta llamada node_modules donde se guardan los m\u00f3dulos instalados.</p> <ul> <li>Instalar el m\u00f3dulo nodemon <sup>8</sup> de manera global.</li> </ul> <pre><code>npm install -g nodemon\n</code></pre> <ul> <li>Crear un archivo llamado app.js que servir\u00e1 de proxy con el servicio de la ACA. Copiar lo siguiente en este archivo.</li> </ul> <pre><code>var express  = require('express');\nvar app      = express();\nvar cors = require('cors');\nvar httpProxy = require('http-proxy');\nvar apiProxy = httpProxy.createProxyServer();\nvar serverAca = 'http://aca-web.gencat.cat/sdim2/apirest/catalog';\n\napp.use(cors());\napp.use(express.static('public'));\n\napp.all(\"/aca/*\", function(req, res) {\n  console.log('redirecting to Server1');\n  apiProxy.web(req, res, {\n    target: serverAca,\n    changeOrigin: false, \n    ignorePath: true\n  });\n});\n\napp.listen(3000);\n</code></pre> <ul> <li>Probar que nuestro proxy est\u00e1 funcionando, escribir:</li> </ul> <pre><code>nodemon app.js\n</code></pre> <ul> <li> <p>Abrir la url de nuestro proxy http://localhost:3000/aca/ en el navegador.</p> </li> <li> <p>Escribir en el navegador http://localhost:3000 y ver nuestro mapa.</p> </li> </ul>"},{"location":"12_ejemplo_sentilo_aca/#modificar-el-mapa","title":"Modificar el mapa","text":"<ul> <li>Modificar el archivo index.html para que llame al proxy que hemos creado. Cambiar la url de la capa geojsonLayer http://aca-web.gencat.cat/sdim2/apirest/catalog por nuestro proxy http://localhost:3000/aca/ (como el proxy y la aplicaci\u00f3n est\u00e1n en el mismo servidor podr\u00edamos usar /aca/).</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n  &lt;title&gt;Ejemplo Sentilo ACA&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n        height: 100%;\n        width: 100%;\n        position: absolute;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"&gt;&lt;/script&gt;\n  &lt;script&gt;\n    var map = L.map('map');\n\n    map.setView([41.5087, 2.1777], 8);  \n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n\n    var geojsonLayer = new L.GeoJSON.AJAX('http://localhost:3000/aca/').addTo(map);\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar la aplicaci\u00f3n con Ctrl+F5 y vemos que el error ha desaparecido. Continuaremos sin ver ning\u00fan dato en nuestro mapa. Esto es debido a lo que ya mencionamos; que la API no retorna un GeoJSON. Por lo tanto tendremos que convertir la respuesta de la API en un GeoJSON.</p> </li> <li> <p>Convertir la respuesta en un GeoJSON utilizando la opci\u00f3n middleware que ofrece la capa GeoJSON.AJAX. Esta opci\u00f3n permite crear una funci\u00f3n donde se pueden manipular los datos antes de agregarlos al mapa. Crear la funci\u00f3n que transforma los datos de Sentilo de la ACA en un GeoJSON. Escribir al final de nuestro c\u00f3digo</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n  &lt;title&gt;Ejemplo Sentilo ACA&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n        height: 100%;\n        width: 100%;\n        position: absolute;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"&gt;&lt;/script&gt;\n  &lt;script&gt;\n    var map = L.map('map');\n\n    map.setView([41.5087, 2.1777], 8);  \n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n\n    var geojsonLayer = new L.GeoJSON.AJAX('http://localhost:3000/aca/').addTo(map);\n\n    function sentiloAca2geoJSON(data){\n      var geojson = {\n        type: \"FeatureCollection\",\n        features: []\n      };\n      var sensors = data.providers[0].sensors;\n      for (var i = sensors.length - 1; i &gt;= 0; i--) {\n        var sensor = sensors[i];\n        var location = sensor.location.split(\" \");\n        var feature = {\n          type: 'Feature',\n          properties: {\n            description: sensor.description,\n            id: sensor.component,\n            nom: sensor.componentDesc,\n            info: sensor.componentAdditionalInfo,\n            unit: sensor.unit\n          },\n          geometry: {\n            type: 'Point',\n            coordinates: [location[1], location[0]]\n          }\n      };\n      geojson.features.push(feature);\n      }\n      return geojson;\n    }\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Modificar la capa geojsonLayer para que el middleware llame a nuestra funci\u00f3n de transformaci\u00f3n. Cambiar el c\u00f3digo de la capa por lo siguiente:</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n  &lt;title&gt;Ejemplo Sentilo ACA&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n        height: 100%;\n        width: 100%;\n        position: absolute;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"&gt;&lt;/script&gt;\n  &lt;script&gt;\n    var map = L.map('map');\n\n    map.setView([41.5087, 2.1777], 8);  \n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n\n    var geojsonLayer = new L.GeoJSON.AJAX('http://localhost:3000/aca/', {\n      middleware:function(data){\n        return sentiloAca2geoJSON(data);\n      }\n    }).addTo(map);\n\n    function sentiloAca2geoJSON(data){\n      var geojson = {\n        type: \"FeatureCollection\",\n        features: []\n      };\n      var sensors = data.providers[0].sensors;\n      for (var i = sensors.length - 1; i &gt;= 0; i--) {\n        var sensor = sensors[i];\n        var location = sensor.location.split(\" \");\n        var feature = {\n          type: 'Feature',\n          properties: {\n            description: sensor.description,\n            id: sensor.component,\n            nom: sensor.componentDesc,\n            info: sensor.componentAdditionalInfo,\n            unit: sensor.unit\n          },\n          geometry: {\n            type: 'Point',\n            coordinates: [location[1], location[0]]\n          }\n      };\n      geojson.features.push(feature);\n      }\n      return geojson;\n    }\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar el mapa y ver los puntos de los embalses en el mapa.</p> </li> <li> <p>Mostrar la informaci\u00f3n del punto. Agregar el evento click en cada unos de los puntos. Utilizar la opci\u00f3n de onEachFeature que ofrece las capa GeoJSON de Leaflet. Esta opci\u00f3n permite ejecutar una funci\u00f3n en la creaci\u00f3n de cada uno de los elementos de la capa. Es muy \u00fatil para agregar popups a los elementos \u00f3 para agregar eventos en los elementos.</p> </li> <li> <p>Crear una funci\u00f3n llamada eachFeature que recibe como par\u00e1metros un feature (elemento del GeoJSON) y un layer (elemento de Leaflet). La funci\u00f3n ser\u00eda la siguiente</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n  &lt;title&gt;Ejemplo Sentilo ACA&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n        height: 100%;\n        width: 100%;\n        position: absolute;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"&gt;&lt;/script&gt;\n  &lt;script&gt;\n    var map = L.map('map');\n\n    map.setView([41.5087, 2.1777], 8);  \n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n\n    var geojsonLayer = new L.GeoJSON.AJAX('http://localhost:3000/aca/', {\n      middleware:function(data){\n        return sentiloAca2geoJSON(data);\n      }\n    }).addTo(map);\n\n    function sentiloAca2geoJSON(data){\n      var geojson = {\n        type: \"FeatureCollection\",\n        features: []\n      };\n      var sensors = data.providers[0].sensors;\n      for (var i = sensors.length - 1; i &gt;= 0; i--) {\n        var sensor = sensors[i];\n        var location = sensor.location.split(\" \");\n        var feature = {\n          type: 'Feature',\n          properties: {\n            description: sensor.description,\n            id: sensor.component,\n            nom: sensor.componentDesc,\n            info: sensor.componentAdditionalInfo,\n            unit: sensor.unit\n          },\n          geometry: {\n            type: 'Point',\n            coordinates: [location[1], location[0]]\n          }\n      };\n      geojson.features.push(feature);\n      }\n      return geojson;\n    }\n\n    function eachFeature(f,l){\n      l.on('click',function(ev){\n        console.log(f);\n        console.log(l);\n      });\n    }\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Llamar a la funci\u00f3n eachFeature en la opci\u00f3n onEachFeature de la capa geojsonLayer. Escribir lo siguiente luego de la opci\u00f3n del middleware</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n  &lt;title&gt;Ejemplo Sentilo ACA&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n        height: 100%;\n        width: 100%;\n        position: absolute;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"&gt;&lt;/script&gt;\n  &lt;script&gt;\n    var map = L.map('map');\n\n    map.setView([41.5087, 2.1777], 8);  \n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n\n    var geojsonLayer = new L.GeoJSON.AJAX('http://localhost:3000/aca/', {\n      middleware:function(data){\n        return sentiloAca2geoJSON(data);\n      }\n      ,onEachFeature: eachFeature\n    }).addTo(map);\n\n    function sentiloAca2geoJSON(data){\n      var geojson = {\n        type: \"FeatureCollection\",\n        features: []\n      };\n      var sensors = data.providers[0].sensors;\n      for (var i = sensors.length - 1; i &gt;= 0; i--) {\n        var sensor = sensors[i];\n        var location = sensor.location.split(\" \");\n        var feature = {\n          type: 'Feature',\n          properties: {\n            description: sensor.description,\n            id: sensor.component,\n            nom: sensor.componentDesc,\n            info: sensor.componentAdditionalInfo,\n            unit: sensor.unit\n          },\n          geometry: {\n            type: 'Point',\n            coordinates: [location[1], location[0]]\n          }\n      };\n      geojson.features.push(feature);\n      }\n      return geojson;\n    }\n\n    function eachFeature(f,l){\n      l.on('click',function(ev){\n        console.log(f);\n        console.log(l);\n      });\n    }\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar el mapa y hacer click sobre un elemento. En la consola de desarrollador ver que aparecen 2 entradas una que corresponde al feature y otra al layer.</p> </li> <li> <p>Llamar a la API de la ACA para pedir la \u00faltima lectura del sensor y as\u00ed obtener la informaci\u00f3n. La url para obtener la \u00faltima lectura es http://aca-web.gencat.cat/sentilo-catalog-web/component/map/EMBASSAMENT-EST../lastOb/. <p>Por ejemplo:</p> <p>http://aca-web.gencat.cat/sentilo-catalog-web/component/map/EMBASSAMENT-EST.082687-001/lastOb/</p> <p>Como estamos llamando una url que est\u00e1 fuera de nuestro dominio tenemos el mismo problema de CORS.</p>"},{"location":"12_ejemplo_sentilo_aca/#modificar-el-proxy","title":"Modificar el proxy","text":"<ul> <li>Modificar nuestro proxy para obtener la informaci\u00f3n de un sensor. Escribir en nuestro archivo app.js justo debajo de la declaraci\u00f3n de la variable serverAca</li> </ul> <pre><code>var express  = require('express');\nvar app      = express();\nvar cors = require('cors');\nvar httpProxy = require('http-proxy');\nvar apiProxy = httpProxy.createProxyServer();\nvar serverAca = 'http://aca-web.gencat.cat/sdim2/apirest/catalog';\nvar serverAcaLastOb = 'http://aca-web.gencat.cat/sentilo-catalog-web/component/map/EMBASSAMENT-EST.';\n\napp.use(cors());\napp.use(express.static('public'));\n\napp.all(\"/aca/*\", function(req, res) {\n  console.log('redirecting to Server1');\n  apiProxy.web(req, res, {\n    target: serverAca,\n    changeOrigin: false, \n    ignorePath: true\n  });\n});\n\napp.listen(3000);\n</code></pre> <ul> <li>Agregar justo antes del app.listen el c\u00f3digo que nos va a ser de proxy.</li> </ul> <pre><code>var express  = require('express');\nvar app      = express();\nvar cors = require('cors');\nvar httpProxy = require('http-proxy');\nvar apiProxy = httpProxy.createProxyServer();\nvar serverAca = 'http://aca-web.gencat.cat/sdim2/apirest/catalog';\nvar serverAcaLastOb = 'http://aca-web.gencat.cat/sentilo-catalog-web/component/map/EMBASSAMENT-EST.';\n\napp.use(cors());\napp.use(express.static('public'));\n\napp.all(\"/aca/*\", function(req, res) {\n  console.log('redirecting to Server1');\n  apiProxy.web(req, res, {\n    target: serverAca,\n    changeOrigin: false, \n    ignorePath: true\n  });\n});\n\napp.all(\"/acalast/:id\", function(req, res){\n  console.log('redirecting to Server2' + req.params.id);\n  apiProxy.web(req, res, {\n    target: serverAcaLastOb+req.params.id+'/lastOb/',\n    changeOrigin: false,\n    ignorePath: true\n  });\n});\n\napp.listen(3000);\n</code></pre> <ul> <li> <p>Abrir la url http://localhost:3000/acalast/082687-001 en el navegador para comprobar que el proxy est\u00e1 funcionando correctamente.</p> </li> <li> <p>Modificar la funci\u00f3n que se llama al hacer click sobre un elemento del mapa para que llame a nuestro proxy. Esta funci\u00f3n ejecutar\u00e1 una llamada ajax al proxy. Modificar la funci\u00f3n eachFeature con el siguiente c\u00f3digo</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n  &lt;title&gt;Ejemplo Sentilo ACA&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n        height: 100%;\n        width: 100%;\n        position: absolute;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"&gt;&lt;/script&gt;\n  &lt;script&gt;\n    var map = L.map('map');\n\n    map.setView([41.5087, 2.1777], 8);  \n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n\n    var geojsonLayer = new L.GeoJSON.AJAX('http://localhost:3000/aca/', {\n      middleware:function(data){\n        return sentiloAca2geoJSON(data);\n      }\n      ,onEachFeature: eachFeature\n    }).addTo(map);\n\n    function sentiloAca2geoJSON(data){\n      var geojson = {\n        type: \"FeatureCollection\",\n        features: []\n      };\n      var sensors = data.providers[0].sensors;\n      for (var i = sensors.length - 1; i &gt;= 0; i--) {\n        var sensor = sensors[i];\n        var location = sensor.location.split(\" \");\n        var feature = {\n          type: 'Feature',\n          properties: {\n            description: sensor.description,\n            id: sensor.component,\n            nom: sensor.componentDesc,\n            info: sensor.componentAdditionalInfo,\n            unit: sensor.unit\n          },\n          geometry: {\n            type: 'Point',\n            coordinates: [location[1], location[0]]\n          }\n      };\n      geojson.features.push(feature);\n      }\n      return geojson;\n    }\n\n    function eachFeature(f,l){\n      l.on('click',function(ev){\n        var url = 'http://localhost:3000/acalast/'+f.properties.id;\n        fetch(url)\n        .then(function(response) {\n          response.json().then(function(data){\n            console.log(data);\n          });\n        })\n        .catch(function(myJson) {\n          console.log(myJson);\n        });\n      });\n    }\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar el mapa y hacer click sobre un elemento para ver que en la consola del desarrollador aparece un objeto que contiene la respuesta del sensor con la informaci\u00f3n de la \u00faltima lectura.</p> </li> <li> <p>Crear una funci\u00f3n llamada popUp para mostrar esta informaci\u00f3n en el mapa. La funci\u00f3n recibe como par\u00e1metros un layer de Leaflet y unos datos del sensor. Esta funci\u00f3n muestra un popup asociado al elemento con la informaci\u00f3n del sensor. Escribir despu\u00e9s de la funci\u00f3n eachFeature</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n  &lt;title&gt;Ejemplo Sentilo ACA&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n        height: 100%;\n        width: 100%;\n        position: absolute;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"&gt;&lt;/script&gt;\n  &lt;script&gt;\n    var map = L.map('map');\n\n    map.setView([41.5087, 2.1777], 8);  \n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n\n    var geojsonLayer = new L.GeoJSON.AJAX('http://localhost:3000/aca/', {\n      middleware:function(data){\n        return sentiloAca2geoJSON(data);\n      }\n      ,onEachFeature: eachFeature\n    }).addTo(map);\n\n    function sentiloAca2geoJSON(data){\n      var geojson = {\n        type: \"FeatureCollection\",\n        features: []\n      };\n      var sensors = data.providers[0].sensors;\n      for (var i = sensors.length - 1; i &gt;= 0; i--) {\n        var sensor = sensors[i];\n        var location = sensor.location.split(\" \");\n        var feature = {\n          type: 'Feature',\n          properties: {\n            description: sensor.description,\n            id: sensor.component,\n            nom: sensor.componentDesc,\n            info: sensor.componentAdditionalInfo,\n            unit: sensor.unit\n          },\n          geometry: {\n            type: 'Point',\n            coordinates: [location[1], location[0]]\n          }\n      };\n      geojson.features.push(feature);\n      }\n      return geojson;\n    }\n\n    function eachFeature(f,l){\n      l.on('click',function(ev){\n        var url = 'http://localhost:3000/acalast/'+f.properties.id;\n        fetch(url)\n        .then(function(response) {\n          response.json().then(function(data){\n            console.log(data);\n          });\n        })\n        .catch(function(myJson) {\n          console.log(myJson);\n        });\n      });\n    }\n\n    function popUp(l, data){\n      var out = [];\n      out.push('&lt;strong&gt;'+data.componentDesc+'&lt;/strong&gt;');\n        if (data.sensorLastObservations){\n          for (var i = data.sensorLastObservations.length - 1; i &gt;= 0; i--) {\n            var observ = data.sensorLastObservations[i];\n            out.push(observ.sensorType+\": \"+observ.value+\" \"+observ.unit);\n          }\n        }\n        l.unbindPopup();\n        l.bindPopup(out.join(\"&lt;br /&gt;\")).togglePopup();\n    }\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Llamar a la funci\u00f3n popUp dentro de la funci\u00f3n que se llama en el success de la llamada ajax. Escribir</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n  &lt;title&gt;Ejemplo Sentilo ACA&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n        height: 100%;\n        width: 100%;\n        position: absolute;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"&gt;&lt;/script&gt;\n  &lt;script&gt;\n    var map = L.map('map');\n\n    map.setView([41.5087, 2.1777], 8);  \n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n\n    var geojsonLayer = new L.GeoJSON.AJAX('http://localhost:3000/aca/', {\n      middleware:function(data){\n        return sentiloAca2geoJSON(data);\n      }\n      ,onEachFeature: eachFeature\n    }).addTo(map);\n\n    function sentiloAca2geoJSON(data){\n      var geojson = {\n        type: \"FeatureCollection\",\n        features: []\n      };\n      var sensors = data.providers[0].sensors;\n      for (var i = sensors.length - 1; i &gt;= 0; i--) {\n        var sensor = sensors[i];\n        var location = sensor.location.split(\" \");\n        var feature = {\n          type: 'Feature',\n          properties: {\n            description: sensor.description,\n            id: sensor.component,\n            nom: sensor.componentDesc,\n            info: sensor.componentAdditionalInfo,\n            unit: sensor.unit\n          },\n          geometry: {\n            type: 'Point',\n            coordinates: [location[1], location[0]]\n          }\n      };\n      geojson.features.push(feature);\n      }\n      return geojson;\n    }\n\n    function eachFeature(f,l){\n      l.on('click',function(ev){\n        var url = 'http://localhost:3000/acalast/'+f.properties.id;\n        fetch(url)\n        .then(function(response) {\n          response.json().then(function(data){\n            popUp(l, data);\n          });\n        })\n        .catch(function(myJson) {\n          console.log(myJson);\n        });\n      });\n    }\n\n    function popUp(l, data){\n      var out = [];\n      out.push('&lt;strong&gt;'+data.componentDesc+'&lt;/strong&gt;');\n        if (data.sensorLastObservations){\n          for (var i = data.sensorLastObservations.length - 1; i &gt;= 0; i--) {\n            var observ = data.sensorLastObservations[i];\n            out.push(observ.sensorType+\": \"+observ.value+\" \"+observ.unit);\n          }\n        }\n        l.unbindPopup();\n        l.bindPopup(out.join(\"&lt;br /&gt;\")).togglePopup();\n    }\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Recargar la aplicaci\u00f3n y clicar sobre un elemento. Debe aparecer un popup con la informaci\u00f3n de la \u00faltima lectura del sensor.</li> </ul> <p> ejemplo sentilo ACA</p>"},{"location":"12_ejemplo_sentilo_aca/#referencias","title":"Referencias","text":"<ol> <li> <p>http://aca.gencat.cat/ca/laigua/consulta-de-dades/dades-obertes/ \u21a9</p> </li> <li> <p>http://www.sentilo.io/wordpress/ \u21a9</p> </li> <li> <p>http://aca-web.gencat.cat/sentilo-catalog-web/component/map \u21a9</p> </li> <li> <p>http://aca.gencat.cat/web/.content/20_Aigua/08_consulta_de_dades/01_dades_obertes/us_serveis_dades_API_REST.pdf \u21a9</p> </li> <li> <p>http://leafletjs.com/ \u21a9</p> </li> <li> <p>https://github.com/calvinmetcalf/leaflet-ajax \u21a9</p> </li> <li> <p>https://developer.mozilla.org/es/docs/Web/HTTP/Access_control_CORS \u21a9</p> </li> <li> <p>https://es.wikipedia.org/wiki/Servidor_proxy \u21a9\u21a9</p> </li> <li> <p>https://nodejs.org/es/ \u21a9</p> </li> <li> <p>http://expressjs.com/ \u21a9</p> </li> <li> <p>https://github.com/nodejitsu/node-http-proxy \u21a9</p> </li> <li> <p>https://www.npmjs.com/package/cors \u21a9</p> </li> <li> <p>https://www.npmjs.com/package/nodemon \u21a9</p> </li> </ol>"},{"location":"13_geoservicios_realtime/","title":"Geoservicios realtime","text":"<p>Muchos de los geoservicios m\u00e1s tradicionales como los WMS o WFS pueden ser Geoservicios realtime, siempre y cuando los datos que se sirvan sean actualizados constantemente. Un ejemplo de esto es el servicio WMS sobre el estado del tr\u00e1fico del Servei Catal\u00e0 de Tr\u00e0nsit http://transit.gencat.cat/ca/informacio_viaria/estat_del_transit/informacio_geografica/estat_del_transit/</p> <p>Otro ejemplo de geoservicio o m\u00e1s bien geodatos en realtime ser\u00eda la capa de Tr\u00e1fico de Google Maps. https://developers.google.com/maps/documentation/javascript/3.exp/reference?hl=es-419#TrafficLayer </p>"},{"location":"13_geoservicios_realtime/#geocodificacion","title":"Geocodificaci\u00f3n","text":"<ul> <li>OpenCage Geocoder https://geocoder.opencagedata.com/</li> <li>Servicios basados en OSM http://wiki.openstreetmap.org/wiki/Search_engines</li> </ul>"},{"location":"13_geoservicios_realtime/#routing","title":"Routing","text":"<ul> <li>Comparador de servicios basados en OSM http://wiki.openstreetmap.org/wiki/Routing/online_routers</li> </ul>"},{"location":"13_geoservicios_realtime/#isocronas","title":"Is\u00f3cronas","text":"<ul> <li>Servicios basados en OSM http://wiki.openstreetmap.org/wiki/Isochrone</li> </ul>"},{"location":"13_geoservicios_realtime/#servicios-varios","title":"Servicios varios","text":"<ul> <li> <p>Servicios de la API de Google Maps https://developers.google.com/maps/web-services/?hl=es-419</p> </li> <li> <p>Servicios de la API de Here https://developer.here.com/documentation</p> </li> <li> <p>Servicios de la API de MapQuest https://developer.mapquest.com/</p> </li> <li> <p>Servicios de la API de ArcGis https://developers.arcgis.com/content-and-services/</p> </li> </ul>"},{"location":"14_herramientas_visualizacion_geoservicios/","title":"Herramientas de visualizaci\u00f3n geoservicios","text":""},{"location":"14_herramientas_visualizacion_geoservicios/#librerias","title":"Librer\u00edas","text":"<p>Para la visualizaci\u00f3n de datos geogr\u00e1ficos en el la web existen diversas librer\u00edas, entre las principales podemos mencionar:</p> <ul> <li> <p>http://leafletjs.com/</p> </li> <li> <p>https://openlayers.org/</p> </li> <li> <p>https://d3js.org/</p> </li> <li> <p>https://developers.google.com/maps/?hl=es-419</p> </li> <li> <p>https://www.mapbox.com/mapbox-gl-js/api/</p> </li> <li> <p>https://maplibre.org/maplibre-gl-js-docs/api/</p> </li> </ul>"},{"location":"14_herramientas_visualizacion_geoservicios/#servicios","title":"Servicios","text":"<p>Aparte de la librer\u00edas que permiten desarrollar nuestras propias aplicaciones, tambi\u00e9n podemos encontrar diferentes servicios que os ofrecen la posibilidad de crear o publicar nuestros mapas en la web de una forma r\u00e1pida y sencilla sin tener que programar. Estos servicios permiten hacer algunos an\u00e1lisis sobre nuestros datos. Entre los principales est\u00e1n:</p> <ul> <li> <p>https://carto.com/</p> </li> <li> <p>https://www.mapbox.com/</p> </li> <li> <p>https://mangomap.com/</p> </li> <li> <p>https://www.giscloud.com/</p> </li> <li> <p>https://www.instamaps.cat/</p> </li> <li> <p>https://www.maptiler.com/</p> </li> </ul>"},{"location":"15_ejemplo_geocodificador/","title":"Ejemplo Geocodificador","text":"<p>La geocodificaci\u00f3n de direcciones consiste en la localizaci\u00f3n espacial de una direcci\u00f3n espec\u00edfica.</p> <p>Existen dos tipos de geocodificaci\u00f3n: </p> <ul> <li>directa es la obtenci\u00f3n de coordenadas a partir de una direcci\u00f3n postal</li> <li>inversa es la localizaci\u00f3n de direcciones a partir de coordenadas geogr\u00e1ficas</li> </ul>"},{"location":"15_ejemplo_geocodificador/#creacion-de-un-visor-que-permita-buscar-direcciones-y-toponimos","title":"Creaci\u00f3n de un visor que permita buscar direcciones y top\u00f3nimos","text":"<p>Para crear un visor de mapas utilizaremos la librer\u00eda de mapas Leaflet <sup>1</sup>. Y cargaremos los datos del Geocodificador del OpenCage <sup>2</sup></p> <ul> <li> <p>Crear una carpeta con el nombre de visor-geocoder.</p> </li> <li> <p>Crear un archivo con el nombre de index.html dentro de la carpeta.</p> </li> <li> <p>Abrir el archivo index.html con un editor de texto y copiar el siguiente c\u00f3digo.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Ejemplo geocoder&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Abrir el archivo index.html en el navegador para comprobar que se carga un mapa centrado en Barcelona.</p> </li> <li> <p>Agregar el plugin al mapa</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Ejemplo geocoder&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/css/L.Control.OpenCageData.Search.min.css\" /&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/js/L.Control.OpenCageSearch.min.js\"&gt;&lt;/script&gt;\n\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n    var options = {\n            key: 'YOUR-API-KEY',\n            limit: 10,\n        };\n        var control = L.Control.openCageSearch(options).addTo(map);\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Recargamos el mapa en el navegador y podemos ver que nos aparece una caja de b\u00fasqueda en el mapa</li> </ul> <p> ejemplo geocodificador</p>"},{"location":"15_ejemplo_geocodificador/#geocodificacion-inversa","title":"Geocodificaci\u00f3n inversa","text":"<p>Implementaremos la funcionalidad que cuando el usuario haga click en el mapa se busque la direcci\u00f3n o top\u00f3nimo m\u00e1s cercano.</p> <ul> <li>Capturar el evento click en el mapa.</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Ejemplo geocoder&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/css/L.Control.OpenCageData.Search.min.css\" /&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/js/L.Control.OpenCageSearch.min.js\"&gt;&lt;/script&gt;\n\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n    var options = {\n            key: 'YOUR-API-KEY',\n            limit: 10,\n        };\n        var control = L.Control.openCageSearch(options).addTo(map);\n\n         map.on('click', function(e){\n            console.log(e);\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar la aplicaci\u00f3n y abrir la consola del desarrollador, al hacer click sobre el mapa ver que en la consola aparece el objeto del evento click. Inspeccionar este objeto para ver que tiene una propiedad llamada latlng que contiene las coordenadas donde se ha hecho el click.</p> </li> <li> <p>Llamar al servicio de geocodificaci\u00f3n pas\u00e1ndole las coordenadas del click para obtener los elementos</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Ejemplo geocoder&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/css/L.Control.OpenCageData.Search.min.css\" /&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/js/L.Control.OpenCageSearch.min.js\"&gt;&lt;/script&gt;\n\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n    var options = {\n            key: 'YOUR-API-KEY',\n            limit: 10,\n        };\n        var control = L.Control.openCageSearch(options).addTo(map);\n\n         map.on('click', function(e){\n            console.log(e);\n            var url = `https://api.opencagedata.com/geocode/v1/json?q=${e.latlng.lat}+${e.latlng.lng}&amp;key=${options.key}`;\n            fetch(url)\n            .then(function(response) {\n            response.json().then(function(data){\n                console.log(data);\n            });\n            })\n            .catch(function(myJson) {\n            console.log(myJson);\n            });\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar la aplicaci\u00f3n y abrir la consola del desarrollador, al hacer click sobre el mapa ver que en la consola aparece el objeto de respuesta del geocodificador. </p> </li> <li> <p>Al recibir la respuesta mostrar un marcador en el mapa en la posici\u00f3n donde el usuario hizo el click.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Ejemplo geocoder&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/css/L.Control.OpenCageData.Search.min.css\" /&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/js/L.Control.OpenCageSearch.min.js\"&gt;&lt;/script&gt;\n\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n    var options = {\n            key: 'YOUR-API-KEY',\n            limit: 10,\n        };\n        var control = L.Control.openCageSearch(options).addTo(map);\n\n    map.on('click', function(e){\n            console.log(e);\n            var url = `https://api.opencagedata.com/geocode/v1/json?q=${e.latlng.lat}+${e.latlng.lng}&amp;key=${options.key}`;\n            fetch(url)\n            .then(function(response) {\n            response.json().then(function(data){\n                console.log(data);\n                var marker = new L.marker(e.latlng);\n                map.addLayer(marker);\n            });\n            })\n            .catch(function(myJson) {\n            console.log(myJson);\n            });\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar el mapa y ver que aparece un marcador al hacer click sobre el mapa.</p> </li> <li> <p>Mostrar la etiqueta con la direcci\u00f3n retornada de la primera respuesta del geocodificador.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Ejemplo geocoder&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/css/L.Control.OpenCageData.Search.min.css\" /&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/js/L.Control.OpenCageSearch.min.js\"&gt;&lt;/script&gt;\n\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n    var options = {\n            key: 'YOUR-API-KEY',\n            limit: 10,\n        };\n        var control = L.Control.openCageSearch(options).addTo(map);\n\n    map.on('click', function(e){\n            console.log(e);\n            var url = `https://api.opencagedata.com/geocode/v1/json?q=${e.latlng.lat}+${e.latlng.lng}&amp;key=${options.key}`;\n            fetch(url)\n            .then(function(response) {\n            response.json().then(function(data){\n                console.log(data);\n                var etiqueta = data.results[0].formatted;\n                var marker = new L.marker(e.latlng).bindPopup(etiqueta);\n                map.addLayer(marker);\n                marker.openPopup();\n            });\n            })\n            .catch(function(myJson) {\n            console.log(myJson);\n            });\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Recargar el mapa y ver que aparece la etiqueta.</li> </ul> <p> ejemplo etiqueta geocodificador</p> <ul> <li>Mostrar el marcador en la posici\u00f3n de la primera respuesta del geocodificador y no en la posici\u00f3n del click</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Ejemplo geocoder&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/css/L.Control.OpenCageData.Search.min.css\" /&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/js/L.Control.OpenCageSearch.min.js\"&gt;&lt;/script&gt;\n\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n    var options = {\n            key: 'YOUR-API-KEY',\n            limit: 10,\n        };\n        var control = L.Control.openCageSearch(options).addTo(map);\n\n    map.on('click', function(e){\n            console.log(e);\n            var url = `https://api.opencagedata.com/geocode/v1/json?q=${e.latlng.lat}+${e.latlng.lng}&amp;key=${options.key}`;\n            fetch(url)\n            .then(function(response) {\n            response.json().then(function(data){\n                console.log(data);\n                var etiqueta = data.results[0].formatted;\n                var posicion = data.results[0].geometry;\n                var marker = new L.marker(posicion).bindPopup(etiqueta);\n                map.addLayer(marker);\n                                marker.openPopup();\n            });\n            })\n            .catch(function(myJson) {\n            console.log(myJson);\n            });\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Recargar el mapa y hacer click sobre el mapa. Vemos que se nos muestra un marcador con la etiqueta en una posici\u00f3n cercana a donde hemos hecho click.</li> </ul> <p>Ejercicios 2 pts</p> <ol> <li> <p>Mostrar la propiedad components.municipality junto con la direcci\u00f3n en la etiqueta (1 pt)</p> <ol> <li>Extra: Mostrar el grado de confianza de la respuesta confidence, la categor\u00eda components._category y el tipo components._type. (1 pt). Ejemplo: Confianza:9Categor\u00eda:outdoors/recreationTipo:leisure</li> </ol> </li> </ol>"},{"location":"15_ejemplo_geocodificador/#referencias","title":"Referencias","text":"<ol> <li> <p>http://leafletjs.com/ \u21a9</p> </li> <li> <p>https://opencagedata.com/ \u21a9</p> </li> </ol>"},{"location":"15_ejemplo_geocodificador_icgc/","title":"Ejemplo Geocodificador","text":"<p>La geocodificaci\u00f3n de direcciones consiste en la localizaci\u00f3n espacial de una direcci\u00f3n espec\u00edfica.</p> <p>Existen dos tipos de geocodificaci\u00f3n: </p> <ul> <li>directa es la obtenci\u00f3n de coordenadas a partir de una direcci\u00f3n postal</li> <li>inversa es la localizaci\u00f3n de direcciones a partir de coordenadas geogr\u00e1ficas</li> </ul>"},{"location":"15_ejemplo_geocodificador_icgc/#creacion-de-un-visor-que-permita-buscar-direcciones-y-toponimos","title":"Creaci\u00f3n de un visor que permita buscar direcciones y top\u00f3nimos","text":"<p>Para crear un visor de mapas utilizaremos la librer\u00eda de mapas Leaflet <sup>1</sup>. Y cargaremos los datos del Geocodificador del ICGC</p> <p>Advertencia</p> <p>El servicio de geodificaci\u00f3n del ICGC que utilizaremos es un servicio beta en fase de prueba</p> <ul> <li> <p>Crear una carpeta con el nombre de visor-geocoder.</p> </li> <li> <p>Crear un archivo con el nombre de index.html dentro de la carpeta.</p> </li> <li> <p>Abrir el archivo index.html con un editor de texto y copiar el siguiente c\u00f3digo.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Ejemplo geocoder&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Abrir el archivo index.html en el navegador para comprobar que se carga un mapa centrado en Barcelona.</p> </li> <li> <p>Descargar en la carpeta el plugin desarrollado por el ICGC <sup>2</sup> https://github.com/OpenICGC/leaflet-geocodericgc-plugin/blob/master/js/leaflet-geocoder.js</p> </li> <li> <p>Agregar el plugin al mapa</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Ejemplo geocoder&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;!-- Load geocoding plugin after Leaflet --&gt;\n        &lt;script src=\"leaflet-geocoder.js\"&gt;&lt;/script&gt;\n\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        var geocodingOptions = {      \n            url:'https://eines.icgc.cat/geocodificador',\n            expanded: true,\n            autocomplete: true,\n            focus:false\n            };\n        L.control.geocoder(geocodingOptions).addTo(map);\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargamos el mapa en el navegador y podemos ver que nos aparece una caja de b\u00fasqueda en el mapa (de momento si estilo)</p> </li> <li> <p>Cargar la hoja de estilo del plugin</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Ejemplo geocoder&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.9.4/leaflet-geocoder-mapzen.css\"&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;!-- Load geocoding plugin after Leaflet --&gt;\n        &lt;script src=\"leaflet-geocoder.js\"&gt;&lt;/script&gt;\n\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        var geocodingOptions = {      \n            url:'https://eines.icgc.cat/geocodificador',\n            expanded: true,\n            autocomplete: true,\n            focus:false\n            };\n        L.control.geocoder(geocodingOptions).addTo(map);\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Recargamos el mapa en el navegador y vemos que el control ahora si tiene estilo</li> </ul> <p> ejemplo geocodificador</p>"},{"location":"15_ejemplo_geocodificador_icgc/#geocodificacion-inversa","title":"Geocodificaci\u00f3n inversa","text":"<p>Implementaremos la funcionalidad que cuando el usuario haga click en el mapa se busque la direcci\u00f3n o top\u00f3nimo m\u00e1s cercano.</p> <ul> <li>Capturar el evento click en el mapa.</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Ejemplo geocoder&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.9.4/leaflet-geocoder-mapzen.css\"&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;!-- Load geocoding plugin after Leaflet --&gt;\n        &lt;script src=\"leaflet-geocoder.js\"&gt;&lt;/script&gt;\n\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        var geocodingOptions = {      \n            url:'https://eines.icgc.cat/geocodificador',\n            expanded: true,\n            autocomplete: true,\n            focus:false\n            };\n        L.control.geocoder(geocodingOptions).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar la aplicaci\u00f3n y abrir la consola del desarrollador, al hacer click sobre el mapa ver que en la consola aparece el objeto del evento click. Inspeccionar este objeto para ver que tiene una propiedad llamada latlng que contiene las coordenadas donde se ha hecho el click.</p> </li> <li> <p>Llamar al servicio de geocodificaci\u00f3n pas\u00e1ndole las coordenadas del click para obtener los elementos</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Ejemplo geocoder&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.9.4/leaflet-geocoder-mapzen.css\"&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;!-- Load geocoding plugin after Leaflet --&gt;\n        &lt;script src=\"leaflet-geocoder.js\"&gt;&lt;/script&gt;\n\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        var geocodingOptions = {      \n            url:'https://eines.icgc.cat/geocodificador',\n            expanded: true,\n            autocomplete: true,\n            focus:false\n            };\n        L.control.geocoder(geocodingOptions).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n            var url = `https://eines.icgc.cat/geocodificadorinvers?lat=${e.latlng.lat}&amp;lon=${e.latlng.lng}`;\n            fetch(url)\n            .then(function(response) {\n            response.json().then(function(data){\n                console.log(data);\n            });\n            })\n            .catch(function(myJson) {\n            console.log(myJson);\n            });\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar la aplicaci\u00f3n y abrir la consola del desarrollador, al hacer click sobre el mapa ver que en la consola aparece el objeto de respuesta del geocodificador. </p> </li> <li> <p>Al recibir la respuesta mostrar un marcador en el mapa en la posici\u00f3n donde el usuario hizo el click.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Ejemplo geocoder&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.9.4/leaflet-geocoder-mapzen.css\"&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;!-- Load geocoding plugin after Leaflet --&gt;\n        &lt;script src=\"leaflet-geocoder.js\"&gt;&lt;/script&gt;\n\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        var geocodingOptions = {      \n            url:'https://eines.icgc.cat/geocodificador',\n            expanded: true,\n            autocomplete: true,\n            focus:false\n            };\n        L.control.geocoder(geocodingOptions).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n            var url = `https://eines.icgc.cat/geocodificadorinvers?lat=${e.latlng.lat}&amp;lon=${e.latlng.lng}`;\n            fetch(url)\n            .then(function(response) {\n            response.json().then(function(data){\n                console.log(data);\n                var marker = new L.marker(e.latlng);\n                map.addLayer(marker);\n            });\n            })\n            .catch(function(myJson) {\n            console.log(myJson);\n            });\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar el mapa y ver que aparece un marcador al hacer click sobre el mapa.</p> </li> <li> <p>Mostrar la etiqueta con la direcci\u00f3n retornada de la primera respuesta del geocodificador.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Ejemplo geocoder&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.9.4/leaflet-geocoder-mapzen.css\"&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;!-- Load geocoding plugin after Leaflet --&gt;\n        &lt;script src=\"leaflet-geocoder.js\"&gt;&lt;/script&gt;\n\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        var geocodingOptions = {      \n            url:'https://eines.icgc.cat/geocodificador',\n            expanded: true,\n            autocomplete: true,\n            focus:false\n            };\n        L.control.geocoder(geocodingOptions).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n            var url = `https://eines.icgc.cat/geocodificadorinvers?lat=${e.latlng.lat}&amp;lon=${e.latlng.lng}`;\n            fetch(url)\n            .then(function(response) {\n            response.json().then(function(data){\n                console.log(data);\n                var etiqueta = data.features[0].properties.label;\n                var marker = new L.marker(e.latlng).bindPopup(etiqueta);\n                map.addLayer(marker);\n                marker.openPopup();\n            });\n            })\n            .catch(function(myJson) {\n            console.log(myJson);\n            });\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Recargar el mapa y ver que aparece la etiqueta.</li> </ul> <p> ejemplo etiqueta geocodificador</p> <ul> <li>Mostrar el marcador en la posici\u00f3n de la primera respuesta del geocodificador y no en la posici\u00f3n del click</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Ejemplo geocoder&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.9.4/leaflet-geocoder-mapzen.css\"&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;!-- Load geocoding plugin after Leaflet --&gt;\n        &lt;script src=\"leaflet-geocoder.js\"&gt;&lt;/script&gt;\n\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        var geocodingOptions = {      \n            url:'https://eines.icgc.cat/geocodificador',\n            expanded: true,\n            autocomplete: true,\n            focus:false\n            };\n        L.control.geocoder(geocodingOptions).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n            var url = `https://eines.icgc.cat/geocodificadorinvers?lat=${e.latlng.lat}&amp;lon=${e.latlng.lng}`;\n            fetch(url)\n            .then(function(response) {\n            response.json().then(function(data){\n                console.log(data);\n                var etiqueta = data.features[0].properties.label;\n                var posicion = data.features[0].geometry.coordinates;\n                var marker = new L.marker(posicion).bindPopup(etiqueta);\n                map.addLayer(marker);\n                marker.openPopup();\n            });\n            })\n            .catch(function(myJson) {\n            console.log(myJson);\n            });\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar el mapa y hacer click sobre el mapa. Vemos que se nos muestra un marcador en Africa. Esto es por que el marker espera las coordenadas en lat, lon y el geojson de respuesta del geocodificador retorna las coordenadas en lon, lat.</p> </li> <li> <p>Cambiar el orden de coordenadas para mostrar el marker en la posici\u00f3n correcta</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Ejemplo geocoder&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.9.4/leaflet-geocoder-mapzen.css\"&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;!-- Load geocoding plugin after Leaflet --&gt;\n        &lt;script src=\"leaflet-geocoder.js\"&gt;&lt;/script&gt;\n\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        var geocodingOptions = {      \n            url:'https://eines.icgc.cat/geocodificador',\n            expanded: true,\n            autocomplete: true,\n            focus:false\n            };\n        L.control.geocoder(geocodingOptions).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n            var url = `https://eines.icgc.cat/geocodificadorinvers?lat=${e.latlng.lat}&amp;lon=${e.latlng.lng}`;\n            fetch(url)\n            .then(function(response) {\n            response.json().then(function(data){\n                console.log(data);\n                var etiqueta = data.features[0].properties.label;\n                var posicion = data.features[0].geometry.coordinates;\n                var marker = new L.marker([posicion[1],posicion[0]]).bindPopup(etiqueta);\n                map.addLayer(marker);\n                marker.openPopup();\n            });\n            })\n            .catch(function(myJson) {\n            console.log(myJson);\n            });\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>Ejercicios 2 pts</p> <ol> <li> <p>Mostrar la propiedad layer junto con la direcci\u00f3n en la etiqueta (1 pt)</p> </li> <li> <p>Extra: Al hacer click en el mapa mostrar los marcadores de los 3 primeros resultados, pero \u00fanicamente desplegar la etiqueta de la primera respuesta. (1 pt) </p> </li> </ol>"},{"location":"15_ejemplo_geocodificador_icgc/#referencias","title":"Referencias","text":"<ol> <li> <p>http://leafletjs.com/ \u21a9</p> </li> <li> <p>https://github.com/OpenICGC/leaflet-geocodericgc-plugin \u21a9</p> </li> </ol>"},{"location":"16_ejemplo_mobility/","title":"Ejemplo Mobility","text":""},{"location":"16_ejemplo_mobility/#creacion-de-un-visor-que-permita-el-calculo-de-isocronas","title":"Creaci\u00f3n de un visor que permita el c\u00e1lculo de Is\u00f3cronas","text":"<p>Algunos de los servicios que ofrecen el c\u00e1lculo de Is\u00f3cronas son: Targomo, ISO4APP, Openrouteservice y Graphhopper</p> <ul> <li>Crear una carpeta con el nombre de visor-mobility.</li> <li>Crear un archivo con el nombre de index.html dentro de la carpeta.</li> <li> <p>Abrir el archivo index.html con un editor de texto y copiar el siguiente c\u00f3digo. <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo Is\u00f3cronas Mapzen&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script&gt;\n        var map = L.map('map');\n\n        map.setView([41.3887, 2.1777], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre></p> </li> <li> <p>Abrir el archivo index.html en el navegador para confirmar que se carga un mapa centrado en Barcelona.</p> </li> <li> <p>Crear una API key. Al revisar la documentaci\u00f3n de la API del servicio de Openrouteservice <sup>1</sup> vemos que es necesario tener una API key para poder utilizarlo. Para crear la API key hay que darse de alta en la p\u00e1gina de Openrouteservice, es un servicio gratuito que tiene unas cuotas de uso.</p> </li> <li> <p>Crear una variable donde guardaremos nuestra API key. Escribir antes de la declaraci\u00f3n de nuestro mapa</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo Is\u00f3cronas Mapzen&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script&gt;\n        var API_KEY_ORS = '{TU_API_KEY}';\n\n        var map = L.map('map');\n\n        map.setView([41.3887, 2.1777], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Cargar la respuesta del servicio utilizando el plugin de Leaflet llamado leaflet.reachability <sup>2</sup>. Este plugin permite hacer una llamada al servicio de Openrouteservice y cargar la respuesta en un mapa. Modificar el archivo index.html para cargar el plugin en nuestra aplicaci\u00f3n. </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo Is\u00f3cronas Mapzen&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.css\"/&gt;\n\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.js\"&gt;&lt;/script&gt;\n\n    &lt;script&gt;\n        var API_KEY_ORS = '{TU_API_KEY}';\n\n        var map = L.map('map');\n\n        map.setView([41.3887, 2.1777], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Agregar el control de Is\u00f3cronas al mapa utilizando el plugin.</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo Is\u00f3cronas Mapzen&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.css\"/&gt;\n\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.js\"&gt;&lt;/script&gt;\n\n    &lt;script&gt;\n        var API_KEY_ORS = '{TU_API_KEY}';\n\n        var map = L.map('map');\n\n        map.setView([41.3887, 2.1777], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        // Initialise the reachability plugin\n        L.control.reachability({\n            // add settings/options here\n            apiKey: API_KEY_ORS\n        }).addTo(map);\n\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar el mapa y comprobar que aparece un el bot\u00f3n del control de Is\u00f3cronas. Abrir la consola del desarrollador y ver las peticiones que se hacen al servicio de Openrouteservice. </p> </li> <li> <p>Modificar la aplicaci\u00f3n para que se haga el c\u00e1lculo de la Is\u00f3crona cuando el usuario haga click en un punto del mapa sin utilizar el plugin. Para ello primero hay que detectar el evento click en el mapa.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo Is\u00f3cronas Mapzen&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.css\"/&gt;\n\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.js\"&gt;&lt;/script&gt;\n\n    &lt;script&gt;\n        var API_KEY_ORS = '{TU_API_KEY}';\n\n        var map = L.map('map');\n\n        map.setView([41.3887, 2.1777], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        // Initialise the reachability plugin\n        L.control.reachability({\n            // add settings/options here\n            apiKey: API_KEY_ORS\n        }).addTo(map);\n\n        map.on('click', async function(e){\n            console.log(e);\n        });\n\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar la aplicaci\u00f3n y abrir la consola del desarrollador. Hacer click sobre el mapa y ver que en la consola aparece el objeto del evento click. Inspeccionar este objeto y ver que tiene una propiedad llamada latlng que contiene las coordenadas donde se ha hecho el click.</p> </li> <li> <p>Crear una funci\u00f3n que tenga como par\u00e1metro una posici\u00f3n (coordenada lat lon) y genere una llamada al servicio de is\u00f3cronas de Openrouteservice para que haga el c\u00e1lculo en la coordenada indicada. Copiar lo siguiente al final de nuestro c\u00f3digo</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo Is\u00f3cronas Mapzen&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.css\"/&gt;\n\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.js\"&gt;&lt;/script&gt;\n\n    &lt;script&gt;\n        var API_KEY_ORS = '{TU_API_KEY}';\n\n        var map = L.map('map');\n\n        map.setView([41.3887, 2.1777], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        // Initialise the reachability plugin\n        L.control.reachability({\n            // add settings/options here\n            apiKey: API_KEY_ORS\n        }).addTo(map);\n\n        map.on('click', async function(e){\n            console.log(e);\n        });\n\n        async function getIsochrona(latlng){\n            var lat = latlng.lat;\n            var lng = latlng.lng;\n            var url = 'https://api.openrouteservice.org/v2/isochrones/cycling-regular';\n            var json = {\n                locations: [[lng, lat]],\n                range_type: \"time\",\n                range: [1200],\n                interval: 300,\n                location_type: \"start\"\n            };\n            const response = await fetch(url, {\n                method: 'POST',\n                mode: 'cors',\n                headers:{\n                    'Accept': 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8',\n                    'Content-Type': 'application/json',\n                    'Authorization': API_KEY_ORS\n                },\n                body: JSON.stringify(json)    \n            });\n            return await response.json();\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Llamar a la funci\u00f3n getIsochrona cuando se hace click en el mapa. Escribir al final de la funci\u00f3n del click</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo Is\u00f3cronas Mapzen&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.css\"/&gt;\n\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.js\"&gt;&lt;/script&gt;\n\n    &lt;script&gt;\n        var API_KEY_ORS = '{TU_API_KEY}';\n\n        var map = L.map('map');\n\n        map.setView([41.3887, 2.1777], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        // Initialise the reachability plugin\n        L.control.reachability({\n            // add settings/options here\n            apiKey: API_KEY_ORS\n        }).addTo(map);\n\n        map.on('click', async function(e){\n            console.log(e);\n            var data = await getIsochrona(e.latlng);\n            console.log(data);\n        });\n\n        async function getIsochrona(latlng){\n            var lat = latlng.lat;\n            var lng = latlng.lng;\n            var url = 'https://api.openrouteservice.org/v2/isochrones/cycling-regular';\n            var json = {\n                locations: [[lng, lat]],\n                range_type: \"time\",\n                range: [1200],\n                interval: 300,\n                location_type: \"start\"\n            };\n            const response = await fetch(url, {\n                method: 'POST',\n                mode: 'cors',\n                headers:{\n                    'Accept': 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8',\n                    'Content-Type': 'application/json',\n                    'Authorization': API_KEY_ORS\n                },\n                body: JSON.stringify(json)    \n            });\n            return await response.json();\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar la p\u00e1gina y hacer click sobre el mapa para ver que en la consola aparece un GeoJSON que contiene la is\u00f3crona.</p> </li> <li> <p>Agregar la una capa geojson que la iniciaremos vac\u00eda sin ning\u00fan elemento.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo Is\u00f3cronas Mapzen&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.css\"/&gt;\n\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.js\"&gt;&lt;/script&gt;\n\n    &lt;script&gt;\n        var API_KEY_ORS = '{TU_API_KEY}';\n\n        var map = L.map('map');\n\n        map.setView([41.3887, 2.1777], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        // Initialise the reachability plugin\n        L.control.reachability({\n            // add settings/options here\n            apiKey: API_KEY_ORS\n        }).addTo(map);\n\n        var geojsonLayer = new L.geoJSON().addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n            var data = await getIsochrona(e.latlng);\n            console.log(data);\n        });\n\n        async function getIsochrona(latlng){\n            var lat = latlng.lat;\n            var lng = latlng.lng;\n            var url = 'https://api.openrouteservice.org/v2/isochrones/cycling-regular';\n            var json = {\n                locations: [[lng, lat]],\n                range_type: \"time\",\n                range: [1200],\n                interval: 300,\n                location_type: \"start\"\n            };\n            const response = await fetch(url, {\n                method: 'POST',\n                mode: 'cors',\n                headers:{\n                    'Accept': 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8',\n                    'Content-Type': 'application/json',\n                    'Authorization': API_KEY_ORS\n                },\n                body: JSON.stringify(json)    \n            });\n            return await response.json();\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Utilizar el m\u00e9todo addData para actualizar la capa geojsonLayer con la respuesta GeoJSON que retorna la API.</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo Is\u00f3cronas Mapzen&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.css\"/&gt;\n\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.js\"&gt;&lt;/script&gt;\n\n    &lt;script&gt;\n        var API_KEY_ORS = '{TU_API_KEY}';\n\n        var map = L.map('map');\n\n        map.setView([41.3887, 2.1777], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        // Initialise the reachability plugin\n        L.control.reachability({\n            // add settings/options here\n            apiKey: API_KEY_ORS\n        }).addTo(map);\n\n        var geojsonLayer = new L.geoJSON().addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n            var data = await getIsochrona(e.latlng);\n            console.log(data);\n            geojsonLayer.addData(data);\n        });\n\n        async function getIsochrona(latlng){\n            var lat = latlng.lat;\n            var lng = latlng.lng;\n            var url = 'https://api.openrouteservice.org/v2/isochrones/cycling-regular';\n            var json = {\n                locations: [[lng, lat]],\n                range_type: \"time\",\n                range: [1200],\n                interval: 300,\n                location_type: \"start\"\n            };\n            const response = await fetch(url, {\n                method: 'POST',\n                mode: 'cors',\n                headers:{\n                    'Accept': 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8',\n                    'Content-Type': 'application/json',\n                    'Authorization': API_KEY_ORS\n                },\n                body: JSON.stringify(json)    \n            });\n            return await response.json();\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Refrescar el mapa y hacer click sobre el mapa para comprobar que se dibuja una nueva l\u00ednea is\u00f3crona.</p> </li> <li> <p>Pintar la l\u00ednea del color que indicamos. Por defecto se pinta la l\u00ednea de color azul. Esto es debido a que el Leaflet no sabe de que color pintar la l\u00ednea y utiliza el color por defecto. En la respuesta del servicio podemos ver que los elementos que nos retorna tienen unas propiedades (properties) en donde se listan una serie de atributos, uno de ellos es el value que corresponde con el valor del intervalo de tiempo. Lo que debemos hacer es decirle al leaflet que utilice esa propiedad para dar el color a la l\u00ednea. Escribir lo siguiente en nuestra capa geojsonLayer.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo Is\u00f3cronas Mapzen&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.css\"/&gt;\n\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.js\"&gt;&lt;/script&gt;\n\n    &lt;script&gt;\n        var API_KEY_ORS = '{TU_API_KEY}';\n\n        var map = L.map('map');\n\n        map.setView([41.3887, 2.1777], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        // Initialise the reachability plugin\n        L.control.reachability({\n            // add settings/options here\n            apiKey: API_KEY_ORS\n        }).addTo(map);\n\n        var geojsonLayer = new L.geoJSON('',{\n            style: function(geoJsonFeature){\n                var color = \"#0000FF\";\n                switch (geoJsonFeature.properties.value) {\n                  case 300:\n                    color = \"#0000FF\";\n                    break;\n                  case 600:\n                    color = \"#00FF00\";\n                    break;\n                  case 900:\n                    color = \"#FF0000\";\n                    break;\n                  case 1200:\n                    color = \"#FF00FF\";\n                    break;\n                  default:\n                    color = \"#0000FF\";\n                    break;\n                }\n                return {color: color};\n            }\n        }).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n            var data = await getIsochrona(e.latlng);\n            console.log(data);\n            geojsonLayer.addData(data);\n        });\n\n        async function getIsochrona(latlng){\n            var lat = latlng.lat;\n            var lng = latlng.lng;\n            var url = 'https://api.openrouteservice.org/v2/isochrones/cycling-regular';\n            var json = {\n                locations: [[lng, lat]],\n                range_type: \"time\",\n                range: [1200],\n                interval: 300,\n                location_type: \"start\"\n            };\n            const response = await fetch(url, {\n                method: 'POST',\n                mode: 'cors',\n                headers:{\n                    'Accept': 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8',\n                    'Content-Type': 'application/json',\n                    'Authorization': API_KEY_ORS\n                },\n                body: JSON.stringify(json)    \n            });\n            return await response.json();\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Recargar el mapa y hacer click para confirmar que los pol\u00edgonos se pintan de diferentes colores.</li> </ul>"},{"location":"16_ejemplo_mobility/#agregar-un-buscador-de-direcciones-y-puntos-de-interes-al-mapa","title":"Agregar un buscador de direcciones y puntos de inter\u00e9s al mapa","text":"<p>Para agregar un buscador utilizaremos el plugin de Leaflet Leaflet.OpenCage.Search <sup>4</sup> desarrollado por OpenCage que permite de una forma f\u00e1cil y r\u00e1pida hacer llamadas al servicio de b\u00fasqueda de OpenCage Geocoder. Para ello hay que obtener un API_KEY en la p\u00e1gina de OpenCage <sup>5</sup></p> <ul> <li>Cargar la librer\u00eda en nuestra aplicaci\u00f3n.</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo Is\u00f3cronas Mapzen&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.css\"/&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/css/L.Control.OpenCageData.Search.min.css\" /&gt;\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/js/L.Control.OpenCageSearch.min.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.js\"&gt;&lt;/script&gt;\n\n    &lt;script&gt;\n        var API_KEY_ORS = '{TU_API_KEY}';\n\n        var map = L.map('map');\n\n        map.setView([41.3887, 2.1777], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        // Initialise the reachability plugin\n        L.control.reachability({\n            // add settings/options here\n            apiKey: API_KEY_ORS\n        }).addTo(map);\n\n        var geojsonLayer = new L.geoJSON('',{\n            style: function(geoJsonFeature){\n                var color = \"#0000FF\";\n                switch (geoJsonFeature.properties.value) {\n                  case 300:\n                    color = \"#0000FF\";\n                    break;\n                  case 600:\n                    color = \"#00FF00\";\n                    break;\n                  case 900:\n                    color = \"#FF0000\";\n                    break;\n                  case 1200:\n                    color = \"#FF00FF\";\n                    break;\n                  default:\n                    color = \"#0000FF\";\n                    break;\n                }\n                return {color: color};\n            }\n        }).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n            var data = await getIsochrona(e.latlng);\n            console.log(data);\n            geojsonLayer.addData(data);\n        });\n\n        async function getIsochrona(latlng){\n            var lat = latlng.lat;\n            var lng = latlng.lng;\n            var url = 'https://api.openrouteservice.org/v2/isochrones/cycling-regular';\n            var json = {\n                locations: [[lng, lat]],\n                range_type: \"time\",\n                range: [1200],\n                interval: 300,\n                location_type: \"start\"\n            };\n            const response = await fetch(url, {\n                method: 'POST',\n                mode: 'cors',\n                headers:{\n                    'Accept': 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8',\n                    'Content-Type': 'application/json',\n                    'Authorization': API_KEY_ORS\n                },\n                body: JSON.stringify(json)    \n            });\n            return await response.json();\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Crear la variable para la API key</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo Is\u00f3cronas Mapzen&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.css\"/&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/css/L.Control.OpenCageData.Search.min.css\" /&gt;\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/js/L.Control.OpenCageSearch.min.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.js\"&gt;&lt;/script&gt;\n\n    &lt;script&gt;\n        var API_KEY_ORS = '{TU_API_KEY}';\n        var API_KEY_OCG = '{TU_API_KEY_OPENCAGE}';\n\n        var map = L.map('map');\n\n        map.setView([41.3887, 2.1777], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        // Initialise the reachability plugin\n        L.control.reachability({\n            // add settings/options here\n            apiKey: API_KEY_ORS\n        }).addTo(map);\n\n        var geojsonLayer = new L.geoJSON('',{\n            style: function(geoJsonFeature){\n                var color = \"#0000FF\";\n                switch (geoJsonFeature.properties.value) {\n                  case 300:\n                    color = \"#0000FF\";\n                    break;\n                  case 600:\n                    color = \"#00FF00\";\n                    break;\n                  case 900:\n                    color = \"#FF0000\";\n                    break;\n                  case 1200:\n                    color = \"#FF00FF\";\n                    break;\n                  default:\n                    color = \"#0000FF\";\n                    break;\n                }\n                return {color: color};\n            }\n        }).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n            var data = await getIsochrona(e.latlng);\n            console.log(data);\n            geojsonLayer.addData(data);\n        });\n\n        async function getIsochrona(latlng){\n            var lat = latlng.lat;\n            var lng = latlng.lng;\n            var url = 'https://api.openrouteservice.org/v2/isochrones/cycling-regular';\n            var json = {\n                locations: [[lng, lat]],\n                range_type: \"time\",\n                range: [1200],\n                interval: 300,\n                location_type: \"start\"\n            };\n            const response = await fetch(url, {\n                method: 'POST',\n                mode: 'cors',\n                headers:{\n                    'Accept': 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8',\n                    'Content-Type': 'application/json',\n                    'Authorization': API_KEY_ORS\n                },\n                body: JSON.stringify(json)    \n            });\n            return await response.json();\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Agregar el control al mapa. Para utilizar el servicio de b\u00fasqueda tambi\u00e9n es necesario pasar nuestra API key:</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo Is\u00f3cronas Mapzen&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.css\"/&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/css/L.Control.OpenCageData.Search.min.css\" /&gt;\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/js/L.Control.OpenCageSearch.min.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.js\"&gt;&lt;/script&gt;\n\n    &lt;script&gt;\n        var API_KEY_ORS = '{TU_API_KEY}';\n        var API_KEY_OCG = '{TU_API_KEY_OPENCAGE}';\n\n        var map = L.map('map');\n\n        map.setView([41.3887, 2.1777], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        // Initialise the reachability plugin\n        L.control.reachability({\n            // add settings/options here\n            apiKey: API_KEY_ORS\n        }).addTo(map);\n\n        var options_g = {\n            key: API_KEY_OCG,\n            limit: 10\n        };\n        var geocoder = L.Control.openCageSearch(options_g).addTo(map);\n\n        var geojsonLayer = new L.geoJSON('',{\n            style: function(geoJsonFeature){\n                var color = \"#0000FF\";\n                switch (geoJsonFeature.properties.value) {\n                  case 300:\n                    color = \"#0000FF\";\n                    break;\n                  case 600:\n                    color = \"#00FF00\";\n                    break;\n                  case 900:\n                    color = \"#FF0000\";\n                    break;\n                  case 1200:\n                    color = \"#FF00FF\";\n                    break;\n                  default:\n                    color = \"#0000FF\";\n                    break;\n                }\n                return {color: color};\n            }\n        }).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n            var data = await getIsochrona(e.latlng);\n            console.log(data);\n            geojsonLayer.addData(data);\n        });\n\n        async function getIsochrona(latlng){\n            var lat = latlng.lat;\n            var lng = latlng.lng;\n            var url = 'https://api.openrouteservice.org/v2/isochrones/cycling-regular';\n            var json = {\n                locations: [[lng, lat]],\n                range_type: \"time\",\n                range: [1200],\n                interval: 300,\n                location_type: \"start\"\n            };\n            const response = await fetch(url, {\n                method: 'POST',\n                mode: 'cors',\n                headers:{\n                    'Accept': 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8',\n                    'Content-Type': 'application/json',\n                    'Authorization': API_KEY_ORS\n                },\n                body: JSON.stringify(json)    \n            });\n            return await response.json();\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar el mapa y comprobar que aparece el control.</p> </li> <li> <p>Calcular las is\u00f3cronas al seleccionar un resultado de la b\u00fasqueda. Modificar la funci\u00f3n _geocodeResultSelected del control geocoder</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo Is\u00f3cronas Mapzen&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.css\"/&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/css/L.Control.OpenCageData.Search.min.css\" /&gt;\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/js/L.Control.OpenCageSearch.min.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.js\"&gt;&lt;/script&gt;\n\n    &lt;script&gt;\n        var API_KEY_ORS = '{TU_API_KEY}';\n        var API_KEY_OCG = '{TU_API_KEY_OPENCAGE}';\n\n        var map = L.map('map');\n\n        map.setView([41.3887, 2.1777], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        // Initialise the reachability plugin\n        L.control.reachability({\n            // add settings/options here\n            apiKey: API_KEY_ORS\n        }).addTo(map);\n\n        var options_g = {\n            key: API_KEY_OCG,\n            limit: 10\n        };\n        var geocoder = L.Control.openCageSearch(options_g).addTo(map);\n        geocoder._geocodeResultSelected = async function(result){\n            if (this.options.collapsed) {\n                this._collapse();\n            }\n            console.log(result);\n        };\n\n        var geojsonLayer = new L.geoJSON('',{\n            style: function(geoJsonFeature){\n                var color = \"#0000FF\";\n                switch (geoJsonFeature.properties.value) {\n                  case 300:\n                    color = \"#0000FF\";\n                    break;\n                  case 600:\n                    color = \"#00FF00\";\n                    break;\n                  case 900:\n                    color = \"#FF0000\";\n                    break;\n                  case 1200:\n                    color = \"#FF00FF\";\n                    break;\n                  default:\n                    color = \"#0000FF\";\n                    break;\n                }\n                return {color: color};\n            }\n        }).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n            var data = await getIsochrona(e.latlng);\n            console.log(data);\n            geojsonLayer.addData(data);\n        });\n\n        async function getIsochrona(latlng){\n            var lat = latlng.lat;\n            var lng = latlng.lng;\n            var url = 'https://api.openrouteservice.org/v2/isochrones/cycling-regular';\n            var json = {\n                locations: [[lng, lat]],\n                range_type: \"time\",\n                range: [1200],\n                interval: 300,\n                location_type: \"start\"\n            };\n            const response = await fetch(url, {\n                method: 'POST',\n                mode: 'cors',\n                headers:{\n                    'Accept': 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8',\n                    'Content-Type': 'application/json',\n                    'Authorization': API_KEY_ORS\n                },\n                body: JSON.stringify(json)    \n            });\n            return await response.json();\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Refrescar el mapa y abrir la consola de desarrolladores para comprobar que al seleccionar un resultado de la b\u00fasqueda aparece un objeto en la consola. Inspeccionar este objeto para ver que tiene una propiedad latlng que es lo que necesitamos para calcular las is\u00f3cronas.</p> </li> <li> <p>Llamar a nuestra funci\u00f3n getIsochrona en la funci\u00f3n del evento select para llamar a la API y luego refrescar la capa de geojsonLayer. Esto ya lo hemos hecho cuando el usuario hace click en el mapa. Copiar lo siguiente en la funci\u00f3n</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo Is\u00f3cronas Mapzen&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.css\"/&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/css/L.Control.OpenCageData.Search.min.css\" /&gt;\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://calvinmetcalf.github.io/leaflet-ajax/dist/leaflet.ajax.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@1.4.1/dist/js/L.Control.OpenCageSearch.min.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/gh/trafforddatalab/leaflet.reachability@v2.0.0/leaflet.reachability.js\"&gt;&lt;/script&gt;\n\n    &lt;script&gt;\n        var API_KEY_ORS = '{TU_API_KEY}';\n        var API_KEY_OCG = '{TU_API_KEY_OPENCAGE}';\n\n        var map = L.map('map');\n\n        map.setView([41.3887, 2.1777], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        // Initialise the reachability plugin\n    L.control.reachability({\n            // add settings/options here\n            apiKey: API_KEY_ORS\n        }).addTo(map);\n\n        var options_g = {\n            key: API_KEY_OCG,\n            limit: 10\n        };\n        var geocoder = L.Control.openCageSearch(options_g).addTo(map);\n        geocoder._geocodeResultSelected = async function(result){\n            if (this.options.collapsed) {\n                this._collapse();\n            }\n            console.log(result);\n            var data = await getIsochrona(result.center);\n            geojsonLayer.addData(data);\n        };\n\n        var geojsonLayer = new L.geoJSON('',{\n            style: function(geoJsonFeature){\n                var color = \"#0000FF\";\n                switch (geoJsonFeature.properties.value) {\n                  case 300:\n                    color = \"#0000FF\";\n                    break;\n                  case 600:\n                    color = \"#00FF00\";\n                    break;\n                  case 900:\n                    color = \"#FF0000\";\n                    break;\n                  case 1200:\n                    color = \"#FF00FF\";\n                    break;\n                  default:\n                    color = \"#0000FF\";\n                    break;\n                }\n                return {color: color};\n            }\n        }).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n            var data = await getIsochrona(e.latlng);\n            console.log(data);\n            geojsonLayer.addData(data);\n        });\n\n        async function getIsochrona(latlng){\n            var lat = latlng.lat;\n            var lng = latlng.lng;\n            var url = 'https://api.openrouteservice.org/v2/isochrones/cycling-regular';\n            var json = {\n                locations: [[lng, lat]],\n                range_type: \"time\",\n                range: [1200],\n                interval: 300,\n                location_type: \"start\"\n            };\n            const response = await fetch(url, {\n                method: 'POST',\n                mode: 'cors',\n                headers:{\n                    'Accept': 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8',\n                    'Content-Type': 'application/json',\n                    'Authorization': API_KEY_ORS\n                },\n                body: JSON.stringify(json)    \n            });\n            return await response.json();\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Refrescar la p\u00e1gina y al seleccionar un resultado de b\u00fasqueda comprobar que calcula las is\u00f3cronas desde ese punto.</li> </ul> <p> ejemplo is\u00f3cronas</p> <p>Ejercicios 2 pts</p> <p>En la funci\u00f3n de crearUrlIsochrona </p> <ol> <li>Cambiar el modo de transporte profile (1 pt)</li> <li>Cambiar el alcance range (1 pt)</li> </ol> <p>Ayuda: En el siguiente enlace se pueden ver las diferentes opciones de la API https://openrouteservice.org/dev/#/api-docs/v2/isochrones/{profile}/post</p>"},{"location":"16_ejemplo_mobility/#referencias","title":"Referencias","text":"<ol> <li> <p>https://openrouteservice.org \u21a9</p> </li> <li> <p>https://github.com/traffordDataLab/leaflet.reachability \u21a9</p> </li> <li> <p>https://github.com/calvinmetcalf/leaflet-ajax \u21a9</p> </li> <li> <p>https://github.com/OpenCageData/leaflet-opencage-search \u21a9</p> </li> <li> <p>https://opencagedata.com/ \u21a9</p> </li> </ol>"},{"location":"17_ejemplo_geoservicio_realtime/","title":"Ejemplo servicio realtime para compartir la ubicaci\u00f3n","text":"<p>Simularemos un servicio que permita compartir la ubicaci\u00f3n de los usuarios y ver que usuarios est\u00e1n en linea. Para ello utilizaremos la librer\u00eda Socket.io <sup>1</sup> que permite la comunicaci\u00f3n en tiempo real en dos direcciones cliente-servidor (tipo pull) y servidor-cliente (tipo push). Esto lo hace gracias a un socket <sup>2</sup>.</p> <p>Para mostrar los datos en el mapa utilizaremos la librer\u00eda Leaflet <sup>3</sup>. Para obtener la ubicaci\u00f3n de los usuarios podemos usar el plugin leaflet-locatecontrol <sup>4</sup>, en nuestro caso vamos a simular la ubicaci\u00f3n del usuario haciendo click sobre el mapa en lugar de utilizar la ubicaci\u00f3n del usuario.</p>"},{"location":"17_ejemplo_geoservicio_realtime/#creacion-del-mapa","title":"Creaci\u00f3n del mapa","text":"<ul> <li> <p>Crear una carpeta con el nombre de user-realtime.</p> </li> <li> <p>Crear una carpeta con el nombre de public dentro de la carpeta user-realtime.</p> </li> <li> <p>Crear un archivo con el nombre de index.html dentro de la carpeta public.</p> </li> <li> <p>Abrir el archivo index.html con un editor de texto y copiar el siguiente c\u00f3digo.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Servicio compartir ubicaci\u00f3n realtime&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Abrir el archivo index.html en el navegador para comprobar que se carga un mapa centrado en Barcelona.</p> </li> <li> <p>Capturar el evento click en el mapa. Luego de la declaraci\u00f3n de nuestra capa escribir los siguiente:</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Servicio compartir ubicaci\u00f3n realtime&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Recargar la aplicaci\u00f3n y abrir la consola del desarrollador, al hacer click sobre el mapa ver que en la consola aparece el objeto del evento click. Inspeccionar este objeto para ver que tiene una propiedad llamada latlng que contiene las coordenadas donde se ha hecho el click.</li> </ul>"},{"location":"17_ejemplo_geoservicio_realtime/#creacion-del-servicio-que-comparte-la-ubicacion-de-los-usuarios","title":"Creaci\u00f3n del servicio que comparte la ubicaci\u00f3n de los usuarios","text":"<ul> <li> <p>Utilizaremos Node.js <sup>5</sup> para implementar nuestro servidor web y utilizaremos el m\u00f3dulo de socket.io para establecer la comunicaci\u00f3n entre el cliente y nuestro servidor.</p> </li> <li> <p>Instalar Node.js. Descargar la \u00faltima versi\u00f3n LTS y lo instalaremos con las opciones por defecto. Una vez instalado el Node abrir la consola para verificar que se ha instalado correctamente. Escribir</p> </li> </ul> <pre><code>node -v\n</code></pre> <ul> <li>Navegar hasta nuestra carpeta user-realtime y escribir:</li> </ul> <pre><code>npm init -y \n</code></pre> <p>Con este comando estaremos creando el archivo package.json con los valores predeterminados.</p> <ul> <li> <p>Instalar las dependencias para crear nuestro servicio de proxy. En este caso utilizaremos Express <sup>6</sup> como servidor web, el m\u00f3dulo socket.io <sup>7</sup> y el m\u00f3dulo de cors <sup>8</sup>.</p> </li> <li> <p>Instalar el express y guardarlo en la lista de dependencias</p> </li> </ul> <pre><code>npm install --save express socket.io cors\n</code></pre> <p>Al ejecutar estos comandos veremos que se crea una carpeta llamada node_modules donde se guardan los m\u00f3dulos instalados.</p> <ul> <li>Instalar el m\u00f3dulo nodemon <sup>8</sup> de manera global.</li> </ul> <pre><code>npm install -g nodemon\n</code></pre> <ul> <li>Crear un archivo llamado app.js que contendr\u00e1 nuestra aplicaci\u00f3n que servir\u00e1 de servidor web. Para ello copiar lo siguiente en este archivo.</li> </ul> <pre><code>var express  = require('express');\nvar app = express();\nvar cors = require('cors');\nvar http = require('http').Server(app);\nvar io = require('socket.io')(http);\n\napp.use(cors());\napp.use(express.static('public'));\n\nio.on('connection', function(socket){\n    console.log('a user connected');\n});\n\nhttp.listen(3000, function(){\n    console.log('listening on *:3000');\n});\n</code></pre> <ul> <li>Probar que nuestro servidor est\u00e1 funcionando, escribiendo:</li> </ul> <pre><code>nodemon app.js\n</code></pre> <ul> <li>Abrir la url de nuestro servidor http://localhost:3000/ en el navegador para ver nuestro mapa.</li> </ul>"},{"location":"17_ejemplo_geoservicio_realtime/#modificar-el-mapa","title":"Modificar el mapa","text":"<ul> <li>Agregar la librer\u00eda cliente de socket.io. Escribir en el archivo index.html justo debajo de donde cargamos el leaflet</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Servicio compartir ubicaci\u00f3n realtime&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;script src=\"https://cdn.jsdelivr.net/npm/socket.io-client@4.4.0/dist/socket.io.min.js\"&gt;&lt;/script&gt;\n        &lt;script type=\"text/javascript\"&gt;\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Declarar la variable que va a tener el objeto socket.io al inicio de nuestro c\u00f3digo antes de la declaraci\u00f3n del mapa escribir los siguiente:</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Servicio compartir ubicaci\u00f3n realtime&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;script src=\"https://cdn.jsdelivr.net/npm/socket.io-client@4.4.0/dist/socket.io.min.js\"&gt;&lt;/script&gt;\n        &lt;script type=\"text/javascript\"&gt;\n            var socket = io();\n\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar la p\u00e1gina y ver que en la consola aparece el mensaje de a user connected.</p> </li> <li> <p>Enviar el evento click al servidor. En la funci\u00f3n que se llama al hacer click sobre el mapa escribir los siguiente para enviar un evento al servidor. Este evento lo llamaremos user_click y le pasaremos como par\u00e1metro la posici\u00f3n del click.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Servicio compartir ubicaci\u00f3n realtime&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;script src=\"https://cdn.jsdelivr.net/npm/socket.io-client@4.4.0/dist/socket.io.min.js\"&gt;&lt;/script&gt;\n        &lt;script type=\"text/javascript\"&gt;\n            var socket = io();\n\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n            socket.emit('user_click', e.latlng);\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"17_ejemplo_geoservicio_realtime/#modificar-el-servidor","title":"Modificar el servidor","text":"<ul> <li>Escuchar al evento user_click en nuestra aplicaci\u00f3n del servidor. Dentro de la funci\u00f3n que se llama en el io.on es donde se crea el socket de conexi\u00f3n, por lo tanto escribir nuestro c\u00f3digo dentro de la misma. Debajo de donde escribimos el mensaje de a user connected escribir lo siguiente:</li> </ul> <pre><code>var express  = require('express');\nvar app = express();\nvar cors = require('cors');\nvar http = require('http').Server(app);\nvar io = require('socket.io')(http);\n\napp.use(cors());\napp.use(express.static('public'));\n\nio.on('connection', function(socket){\n    console.log('a user connected');\n    socket.on('user_click', function(msg){\n        console.log(msg);\n    });\n});\n\nhttp.listen(3000, function(){\n    console.log('listening on *:3000');\n});\n</code></pre> <ul> <li> <p>Recargar la p\u00e1gina y hacer click sobre el mapa para ver que en la consola aparece las coordenadas del click. Con esto ya hemos logrado la comunicaci\u00f3n cliente-servidor.</p> </li> <li> <p>Lograr la comunicaci\u00f3n servidor-cliente y que el servidor notifique a todos los cliente para esto debemos emitir un evento en nuestro servidor. Este evento lo llamaremos new_user. Copiar lo siguiente para emitir el evento dentro de la funci\u00f3n que se llama en el evento user_click.</p> </li> </ul> <pre><code>var express  = require('express');\nvar app = express();\nvar cors = require('cors');\nvar http = require('http').Server(app);\nvar io = require('socket.io')(http);\n\napp.use(cors());\napp.use(express.static('public'));\n\nio.on('connection', function(socket){\n    console.log('a user connected');\n    socket.on('user_click', function(msg){\n        console.log(msg);\n        io.emit('new_user', msg);\n    });\n});\n\nhttp.listen(3000, function(){\n    console.log('listening on *:3000');\n});\n</code></pre>"},{"location":"17_ejemplo_geoservicio_realtime/#modificar-el-mapa_1","title":"Modificar el mapa","text":"<ul> <li>Escuchar el evento new_user en nuestro cliente. Al final de nuestro c\u00f3digo html escribir</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Servicio compartir ubicaci\u00f3n realtime&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;script src=\"https://cdn.jsdelivr.net/npm/socket.io-client@4.4.0/dist/socket.io.min.js\"&gt;&lt;/script&gt;\n        &lt;script type=\"text/javascript\"&gt;\n            var socket = io();\n\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n            socket.emit('user_click', e.latlng);\n        });\n\n        socket.on('new_user', function(msg){\n            console.log(msg);\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar la p\u00e1gina. Clicar sobre el mapa y ver las coordenadas del click tanto en el la consola del servidor como en la consola de desarrolladores del navegador.</p> </li> <li> <p>Mostrar un marcador en el mapa en la posici\u00f3n donde el usuario hace click. En nuestro html en la funci\u00f3n que escucha el evento new_user agregar el siguiente c\u00f3digo</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Servicio compartir ubicaci\u00f3n realtime&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n        &lt;style&gt;\n                #map {\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        bottom: 0;\n                        right: 0;\n                }\n        &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n        &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n        &lt;script src=\"https://cdn.jsdelivr.net/npm/socket.io-client@4.4.0/dist/socket.io.min.js\"&gt;&lt;/script&gt;\n        &lt;script type=\"text/javascript\"&gt;\n            var socket = io();\n\n            var map = L.map('map');\n\n            map.setView([41.3887, 2.1777], 13);\n\n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        map.on('click', function(e){\n            console.log(e);\n            socket.emit('user_click', e.latlng);\n        });\n\n        socket.on('new_user', function(msg){\n            console.log(msg);\n            L.marker([msg.lat, msg.lng]).addTo(map);\n        });\n\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Recargar nuestra aplicaci\u00f3n y abrir otra pesta\u00f1a con nuestra aplicaci\u00f3n para simular que somos dos usuarios distintos. Hacer click en el mapa en cualquiera de las pesta\u00f1as y ver que nos aparece el marcador en ambas pesta\u00f1as.</li> </ul>"},{"location":"17_ejemplo_geoservicio_realtime/#referencias","title":"Referencias","text":"<ol> <li> <p>https://socket.io/ \u21a9</p> </li> <li> <p>https://es.wikipedia.org/wiki/Socket_de_Internet \u21a9</p> </li> <li> <p>http://leafletjs.com/ \u21a9</p> </li> <li> <p>https://github.com/domoritz/leaflet-locatecontrol \u21a9</p> </li> <li> <p>https://nodejs.org/es/ \u21a9</p> </li> <li> <p>http://expressjs.com/ \u21a9</p> </li> <li> <p>https://github.com/socketio/socket.io \u21a9</p> </li> <li> <p>https://www.npmjs.com/package/cors \u21a9\u21a9</p> </li> <li> <p>https://www.npmjs.com/package/nodemon \u21a9</p> </li> </ol>"},{"location":"18_ejemplo_gtfs/","title":"Ejemplo GTFS","text":""},{"location":"18_ejemplo_gtfs/#que-es-la-gtfs","title":"\u00bfQu\u00e9 es la GTFS?","text":"<p>La Especificaci\u00f3n general de feeds de transporte p\u00fablico (GTFS) define un formato com\u00fan para los horarios de transporte p\u00fablico y la informaci\u00f3n geogr\u00e1fica asociada a ellos. Los \"feeds\" GTFS permiten que las empresas de transporte p\u00fablico publiquen sus datos de transporte y que los programadores escriban aplicaciones que consuman esos datos de manera interoperable <sup>1</sup>.</p>"},{"location":"18_ejemplo_gtfs/#creacion-de-un-visor-que-muestre-las-lineas-y-paradas-de-un-gtfs","title":"Creaci\u00f3n de un visor que muestre las l\u00edneas y paradas de un GTFS","text":"<p>Para crear un visor de mapas utilizaremos la librer\u00eda de mapas Leaflet <sup>2</sup>. Y cargaremos los datos de portal de la Plataforma VLCi (Valencia SmartCity) <sup>3</sup> </p> <ul> <li> <p>Crear una carpeta con el nombre de visor-gtfs.</p> </li> <li> <p>Crear una carpeta con el nombre de public dentro de la carpeta visor-gtfs.</p> </li> <li> <p>Crear un archivo con el nombre de index.html dentro de la carpeta public.</p> </li> <li> <p>Abrir el archivo index.html con un editor de texto y copiar el siguiente c\u00f3digo.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo GTFS&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script&gt;\n        var map = L.map('map');\n\n        map.setView([39.4652, -0.3861], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Abrir el archivo index.html en el navegador para confirmar que se carga un mapa centrado en Valencia.</li> </ul>"},{"location":"18_ejemplo_gtfs/#crear-el-proxy","title":"Crear el proxy","text":"<ul> <li> <p>Crear un archivo con el nombre de package.json dentro de la carpeta.</p> </li> <li> <p>Abrir el archivo package.json con un editor de texto y copiar el siguiente c\u00f3digo.</p> </li> </ul> <pre><code>{\n    \"name\": \"visor-gtfs\",\n    \"version\": \"1.0.0\",\n    \"description\": \"\",\n    \"main\": \"index.js\",\n    \"scripts\": {\n        \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\"\n    },\n    \"author\": \"\",\n    \"license\": \"ISC\",\n    \"dependencies\": {\n        \"assert\": \"^2.0.0\",\n        \"cors\": \"^2.8.5\",\n        \"express\": \"^4.17.1\",\n        \"fast-csv\": \"^3.4.0\",\n        \"request\": \"^2.88.0\",\n        \"yauzl\": \"^2.10.0\"\n    }\n}\n</code></pre> <ul> <li>Instalar Node.js <sup>4</sup>. Descargar la \u00faltima versi\u00f3n LTS y lo instalaremos con las opciones por defecto. Abrir la consola para verificar que se ha instalado correctamente y escribir</li> </ul> <pre><code>node -v\n</code></pre> <ul> <li>Navegar hasta nuestra carpeta visor-gtfs y escribir:</li> </ul> <pre><code>npm install\n</code></pre> <p>Con este comando estamos instalando las dependencias declaradas en el archivo package.json</p> <p>Al ejecutar estos comandos veremos que se crea una carpeta llamada node_modules donde se guardan los m\u00f3dulos instalados.</p> <ul> <li>Instalar el m\u00f3dulo nodemon [^8] de manera global.</li> </ul> <pre><code>npm install -g nodemon\n</code></pre> <ul> <li>Crear un archivo llamado app.js que servir\u00e1 de proxy con el servicio GTFS. Copiar lo siguiente en este archivo.</li> </ul> <pre><code>var express  = require('express');\nvar app      = express();\nvar cors = require('cors');\nvar request = require('request');\nvar path = require('path');\nvar https = require('https');\nvar fs = require('fs');\nvar yauzl = require(\"yauzl\");\n\napp.use(cors());\napp.use(express.static('public'));\n\napp.listen(3000);\n</code></pre> <ul> <li>Probar que nuestro proxy est\u00e1 funcionando, escribir:</li> </ul> <pre><code>nodemon app.js\n</code></pre> <ul> <li> <p>Escribir en el navegador http://localhost:3000 y ver nuestro mapa.</p> </li> <li> <p>Crear un archivo llamado gtfs2geojson.js. Copiar en el archivo el c\u00f3digo del siguiente enlace https://raw.githubusercontent.com/andrewharvey/gtfs2geojson/master/index.js este c\u00f3digo convierte datos de un GTFS en un GeoJSON. C\u00f3digo basado en la librer\u00eda https://github.com/andrewharvey/gtfs2geojson</p> </li> <li> <p>Cargar en archivo en nuestra app.js. Escribir lo siguiente justo despu\u00e9s de donde se carga el m\u00f3dulo yauzl</p> </li> </ul> <pre><code>var express  = require('express');\nvar app      = express();\nvar cors = require('cors');\nvar request = require('request');\nvar path = require('path');\nvar https = require('https');\nvar fs = require('fs');\nvar yauzl = require(\"yauzl\");\nvar gtfs2geojson = require('./gtfs2geojson.js');\n\napp.use(cors());\napp.use(express.static('public'));\n\napp.listen(3000);\n</code></pre> <ul> <li>Crear la variable que contiene la url del servicio GTFS de L\u00edneas, paradas, horarios de autobuses de la EMT de Valencia <sup>5</sup>. Escribir lo siguiente justo despu\u00e9s de la variable gtfs2geojson</li> </ul> <pre><code>var express  = require('express');\nvar app      = express();\nvar cors = require('cors');\nvar request = require('request');\nvar path = require('path');\nvar https = require('https');\nvar fs = require('fs');\nvar yauzl = require(\"yauzl\");\nvar gtfs2geojson = require('./gtfs2geojson.js');\n\nconst url = 'https://opendata.vlci.valencia.es/dataset/ab058cf8-ad3e-4d9c-ac89-0c6367ecf351/resource/c81b69e6-c082-44dc-acc6-66fc417b4e66/download/google_transit.zip';\n\napp.use(cors());\napp.use(express.static('public'));\n\napp.listen(3000);\n</code></pre> <ul> <li>Crear una funci\u00f3n llamada getZip para descargar un archivo. La funci\u00f3n recibe como par\u00e1metro una url. Escribir lo siguiente al final del archivo app.js</li> </ul> <pre><code>var express  = require('express');\nvar app      = express();\nvar cors = require('cors');\nvar request = require('request');\nvar path = require('path');\nvar https = require('https');\nvar fs = require('fs');\nvar yauzl = require(\"yauzl\");\nvar gtfs2geojson = require('./gtfs2geojson.js');\n\nconst url = 'https://opendata.vlci.valencia.es/dataset/ab058cf8-ad3e-4d9c-ac89-0c6367ecf351/resource/c81b69e6-c082-44dc-acc6-66fc417b4e66/download/google_transit.zip';\n\napp.use(cors());\napp.use(express.static('public'));\n\napp.listen(3000);\n\nfunction getZip(url){\n    return new Promise(function (resolve, reject) {\n        var file = fs.createWriteStream(\"gtfs.zip\");\n        var request = https.get(url, function(response) {\n            response.pipe(file);\n        });\n        file.on('finish', function(){\n            resolve();\n        });\n    }); \n}\n</code></pre> <ul> <li>Crear una funci\u00f3n que extrae un archivo de un zip. La funci\u00f3n recibe como par\u00e1metro el nombre del archivo que se desea extraer. Escribir lo siguiente al final del archivo app.js</li> </ul> <pre><code>var express  = require('express');\nvar app      = express();\nvar cors = require('cors');\nvar request = require('request');\nvar path = require('path');\nvar https = require('https');\nvar fs = require('fs');\nvar yauzl = require(\"yauzl\");\nvar gtfs2geojson = require('./gtfs2geojson.js');\n\nconst url = 'https://opendata.vlci.valencia.es/dataset/ab058cf8-ad3e-4d9c-ac89-0c6367ecf351/resource/c81b69e6-c082-44dc-acc6-66fc417b4e66/download/google_transit.zip';\n\napp.use(cors());\napp.use(express.static('public'));\n\napp.listen(3000);\n\nfunction getZip(url){\n    return new Promise(function (resolve, reject) {\n        var file = fs.createWriteStream(\"gtfs.zip\");\n        var request = https.get(url, function(response) {\n            response.pipe(file);\n        });\n        file.on('finish', function(){\n            resolve();\n        });\n    }); \n}\n\nfunction leerZip(archivo){\n    return new Promise(function (resolve, reject) {\n        yauzl.open('gtfs.zip', {lazyEntries: true}, function(err, zipfile) {\n            if (err) throw err;\n            zipfile.readEntry();\n            zipfile.on(\"entry\", function(entry) {\n            if (/\\/$/.test(entry.fileName)) {\n                // Directory file names end with '/'.\n                // Note that entires for directories themselves are optional.\n                // An entry's fileName implicitly requires its parent directories to exist.\n                zipfile.readEntry();\n            } else {\n                // file entry\n                if(entry.fileName === archivo){\n                zipfile.openReadStream(entry, function(err, readStream) {\n                    if (err) throw err;\n                    var file = fs.createWriteStream(entry.fileName);\n                    readStream.pipe(file); \n                    file.on('finish', function(){\n                        resolve();\n                    });\n                });\n                }else{\n                zipfile.readEntry();\n                }\n            }\n            });\n        });\n    }); \n}\n</code></pre> <ul> <li>Descargar el archivo GTFS y guardarlo en el ordenador. Escribir lo siguiente justo antes de la l\u00ednea donde definimos el puerto por el cual escucha nuestro servidor</li> </ul> <pre><code>var express  = require('express');\nvar app      = express();\nvar cors = require('cors');\nvar request = require('request');\nvar path = require('path');\nvar https = require('https');\nvar fs = require('fs');\nvar yauzl = require(\"yauzl\");\nvar gtfs2geojson = require('./gtfs2geojson.js');\n\nconst url = 'https://opendata.vlci.valencia.es/dataset/ab058cf8-ad3e-4d9c-ac89-0c6367ecf351/resource/c81b69e6-c082-44dc-acc6-66fc417b4e66/download/google_transit.zip';\n\napp.use(cors());\napp.use(express.static('public'));\n\napp.all(\"/getdata/*\", function(req, res) {\n    getZip(url).then(function(){\n        Promise.all([leerZip('shapes.txt'),leerZip('stops.txt')]).then(values =&gt; {\n            res.json({\"msg\": \"archivos descargados\"});\n        });\n    });\n});\n\napp.listen(3000);\n\nfunction getZip(url){\n    return new Promise(function (resolve, reject) {\n        var file = fs.createWriteStream(\"gtfs.zip\");\n        var request = https.get(url, function(response) {\n            response.pipe(file);\n        });\n        file.on('finish', function(){\n            resolve();\n        });\n    }); \n}\n\nfunction leerZip(archivo){\n    return new Promise(function (resolve, reject) {\n        yauzl.open('gtfs.zip', {lazyEntries: true}, function(err, zipfile) {\n            if (err) throw err;\n            zipfile.readEntry();\n            zipfile.on(\"entry\", function(entry) {\n            if (/\\/$/.test(entry.fileName)) {\n                // Directory file names end with '/'.\n                // Note that entires for directories themselves are optional.\n                // An entry's fileName implicitly requires its parent directories to exist.\n                zipfile.readEntry();\n            } else {\n                // file entry\n                if(entry.fileName === archivo){\n                zipfile.openReadStream(entry, function(err, readStream) {\n                    if (err) throw err;\n                    var file = fs.createWriteStream(entry.fileName);\n                    readStream.pipe(file); \n                    file.on('finish', function(){\n                        resolve();\n                    });\n                });\n                }else{\n                zipfile.readEntry();\n                }\n            }\n            });\n        });\n    }); \n}\n</code></pre> <ul> <li> <p>Abrir la url http://localhost:3000/getdata/ en el navegador para comprobar que se han descargado correctamente los archivos gtfs.zip, shapes.txt y stops.txt.</p> </li> <li> <p>Leer los archivos GTFS y convertirlos a GeoJson. Escribir lo siguiente justo antes de la l\u00ednea donde definimos el puerto por el cual escucha nuestro servidor</p> </li> </ul> <pre><code>var express  = require('express');\nvar app      = express();\nvar cors = require('cors');\nvar request = require('request');\nvar path = require('path');\nvar https = require('https');\nvar fs = require('fs');\nvar yauzl = require(\"yauzl\");\nvar gtfs2geojson = require('./gtfs2geojson.js');\n\nconst url = 'https://opendata.vlci.valencia.es/dataset/ab058cf8-ad3e-4d9c-ac89-0c6367ecf351/resource/c81b69e6-c082-44dc-acc6-66fc417b4e66/download/google_transit.zip';\n\napp.use(cors());\napp.use(express.static('public'));\n\napp.all(\"/getdata/*\", function(req, res) {\n    getZip(url).then(function(){\n        Promise.all([leerZip('shapes.txt'),leerZip('stops.txt')]).then(values =&gt; {\n            res.json({\"msg\": \"archivos descargados\"});\n        });\n    });\n});\n\napp.all(\"/stops/*\", function(req, res) {\n    gtfs2geojson.stops(fs.readFileSync('stops.txt', 'utf8'), function(result){\n        res.json(result);\n    });\n});\n\napp.all(\"/shapes/*\", function(req, res) {\n    gtfs2geojson.lines(fs.readFileSync('shapes.txt', 'utf8'), function(result){\n        res.json(result);\n    });\n});\n\napp.listen(3000);\n\nfunction getZip(url){\n    return new Promise(function (resolve, reject) {\n        var file = fs.createWriteStream(\"gtfs.zip\");\n        var request = https.get(url, function(response) {\n            response.pipe(file);\n        });\n        file.on('finish', function(){\n            resolve();\n        });\n    }); \n}\n\nfunction leerZip(archivo){\n    return new Promise(function (resolve, reject) {\n        yauzl.open('gtfs.zip', {lazyEntries: true}, function(err, zipfile) {\n            if (err) throw err;\n            zipfile.readEntry();\n            zipfile.on(\"entry\", function(entry) {\n            if (/\\/$/.test(entry.fileName)) {\n                // Directory file names end with '/'.\n                // Note that entires for directories themselves are optional.\n                // An entry's fileName implicitly requires its parent directories to exist.\n                zipfile.readEntry();\n            } else {\n                // file entry\n                if(entry.fileName === archivo){\n                zipfile.openReadStream(entry, function(err, readStream) {\n                    if (err) throw err;\n                    var file = fs.createWriteStream(entry.fileName);\n                    readStream.pipe(file); \n                    file.on('finish', function(){\n                        resolve();\n                    });\n                });\n                }else{\n                zipfile.readEntry();\n                }\n            }\n            });\n        });\n    }); \n}\n</code></pre> <ul> <li>Abrir la url http://localhost:3000/stops/ en el navegador para comprobar que se muestra un GeoJson con la informaci\u00f3n de las paradas. </li> </ul>"},{"location":"18_ejemplo_gtfs/#modificar-el-mapa","title":"Modificar el mapa","text":"<ul> <li>Cargar este JSON en nuestro mapa utilizando un plugin de Leaflet llamado leaflet-ajax <sup>6</sup>. Este plugin permite hacer una llamada AJAX a un servicio que retorne un JSON y cargar la respuesta en un mapa. Para cargar este plugin debemos agregar lo siguiente justo despu\u00e9s de donde hemos cargado el leaflet</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo GTFS&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"&gt;&lt;/script&gt;\n    &lt;script&gt;\n        var map = L.map('map');\n\n        map.setView([39.4652, -0.3861], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Utilizar el plugin para agregar la capa de paradas al mapa llamando a nuestro servidor. Agregar lo siguiente al final de nuestro c\u00f3digo:</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo GTFS&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"&gt;&lt;/script&gt;\n    &lt;script&gt;\n        var map = L.map('map');\n\n        map.setView([39.4652, -0.3861], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        var geojsonParadas = new L.GeoJSON.AJAX('/stops/',{\n            pointToLayer: function (feature, latlng) {                    \n                return new L.CircleMarker(latlng, {\n                    radius: 5,\n                    fillColor: \"#A30000\",\n                    color: \"#A30000\",\n                    weight: 1,\n                    opacity: 1,\n                    fillOpacity: 0.8\n                });\n            },\n            onEachFeature: function (feature, layer) {\n                layer.bindPopup(feature.properties.stop_name);\n            }\n        }).addTo(map);\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar el mapa y comprobar que aparecen los puntos de las paradas en el mapa.</p> </li> <li> <p>Utilizar el plugin para agregar la capa de l\u00edneas al mapa llamando a nuestro servidor. Agregar lo siguiente al final de nuestro c\u00f3digo:</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo GTFS&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"&gt;&lt;/script&gt;\n    &lt;script&gt;\n        var map = L.map('map');\n\n        map.setView([39.4652, -0.3861], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        var geojsonParadas = new L.GeoJSON.AJAX('/stops/',{\n            pointToLayer: function (feature, latlng) {                    \n                return new L.CircleMarker(latlng, {\n                    radius: 5,\n                    fillColor: \"#A30000\",\n                    color: \"#A30000\",\n                    weight: 1,\n                    opacity: 1,\n                    fillOpacity: 0.8\n                });\n            },\n            onEachFeature: function (feature, layer) {\n                layer.bindPopup(feature.properties.stop_name);\n            }\n        }).addTo(map);\n\n        var geojsonLineas = new L.GeoJSON.AJAX('/shapes/',{\n\n        }).addTo(map);\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar el mapa y comprobar que aparecen las l\u00edneas del bus en el mapa.</p> </li> <li> <p>Cargar la librer\u00eda de manipulaci\u00f3n de colores chroma.js <sup>7</sup>. Escribir lo siguiente despu\u00e9s de donde cargamos el plugin de leaflet.ajax</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo GTFS&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.0.6/chroma.min.js\"&gt;&lt;/script&gt;\n    &lt;script&gt;\n        var map = L.map('map');\n\n        map.setView([39.4652, -0.3861], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        var geojsonParadas = new L.GeoJSON.AJAX('/stops/',{\n            pointToLayer: function (feature, latlng) {                    \n                return new L.CircleMarker(latlng, {\n                    radius: 5,\n                    fillColor: \"#A30000\",\n                    color: \"#A30000\",\n                    weight: 1,\n                    opacity: 1,\n                    fillOpacity: 0.8\n                });\n            },\n            onEachFeature: function (feature, layer) {\n                layer.bindPopup(feature.properties.stop_name);\n            }\n        }).addTo(map);\n\n        var geojsonLineas = new L.GeoJSON.AJAX('/shapes/',{\n\n        }).addTo(map);\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Dar estilo a la capa de l\u00edneas generando un color aleatorio. Escribir lo siguiente en las opciones de la capa geojsonLineas</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt;Ejemplo GTFS&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n    &lt;style&gt;\n        #map {\n            height: 100%;\n            width: 100%;\n            position: absolute;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div id=\"map\"&gt;\n\n    &lt;/div&gt;\n\n    &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.0.6/chroma.min.js\"&gt;&lt;/script&gt;\n    &lt;script&gt;\n        var map = L.map('map');\n\n        map.setView([39.4652, -0.3861], 13);  \n\n        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n        }).addTo(map);\n\n        var geojsonParadas = new L.GeoJSON.AJAX('/stops/',{\n            pointToLayer: function (feature, latlng) {                    \n                return new L.CircleMarker(latlng, {\n                    radius: 5,\n                    fillColor: \"#A30000\",\n                    color: \"#A30000\",\n                    weight: 1,\n                    opacity: 1,\n                    fillOpacity: 0.8\n                });\n            },\n            onEachFeature: function (feature, layer) {\n                layer.bindPopup(feature.properties.stop_name);\n            }\n        }).addTo(map);\n\n        var geojsonLineas = new L.GeoJSON.AJAX('/shapes/',{\n            style: function(geoJsonFeature){\n                return {color: chroma.random(), opacity: 0.5};\n            }\n        }).addTo(map);\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Recargar el mapa y comprobar que aparecen las l\u00edneas del bus en el mapa con colores aleatorios.</li> </ul> <p> ejemplo gtfs</p> <p>Ejercicios 2,5 pts</p> <ol> <li> <p>Mostrar un popup con informaci\u00f3n de la propiedad shape_id al hacer click en la capa de l\u00edneas (1 pt)</p> </li> <li> <p>Cargar datos del gtfs de FGC https://www.fgc.cat/es/opendata/ En el siguiente enlace est\u00e1 el fichero de gtfs https://www.fgc.cat/wp-content/uploads/2018/02/google_transit.zip (1 pt)</p> </li> <li> <p>Centrar el mapa en Barcelona (0,5 pt)</p> </li> </ol>"},{"location":"18_ejemplo_gtfs/#referencias","title":"Referencias","text":"<ol> <li> <p>https://developers.google.com/transit/gtfs/?hl=es-419 \u21a9</p> </li> <li> <p>http://leafletjs.com/ \u21a9</p> </li> <li> <p>https://opendata.vlci.valencia.es \u21a9</p> </li> <li> <p>https://nodejs.org/es/ \u21a9</p> </li> <li> <p>http://gobiernoabierto.valencia.es/es/dataset/?id=google-transit-lineas-paradas-horarios-de-autobuses \u21a9</p> </li> <li> <p>https://github.com/calvinmetcalf/leaflet-ajax \u21a9</p> </li> <li> <p>https://github.com/gka/chroma.js/ \u21a9</p> </li> </ol>"},{"location":"1_introduccion_a_las_smart_cities/","title":"Introducci\u00f3n a las Smart Cities","text":"<p>Una ciudad inteligente es un \u00e1rea urbana que utiliza diferentes tipos de sensores electr\u00f3nicos de recopilaci\u00f3n de datos para suministrar informaci\u00f3n utilizada para administrar recursos de manera eficiente. Esto incluye datos recopilados de ciudadanos, dispositivos y activos que se procesan y analizan para monitorear y administrar el tr\u00e1fico y los sistemas de transporte, centrales el\u00e9ctricas, redes de suministro de agua, gesti\u00f3n de desechos, cumplimiento de la ley, sistemas de informaci\u00f3n, escuelas, bibliotecas, hospitales y otros servicios comunitarios.</p> <p>https://es.wikipedia.org/wiki/Ciudad_inteligente</p>"},{"location":"1_introduccion_a_las_smart_cities/#smart-cities-es-tecnologia-de-la-informacion","title":"Smart cities es tecnolog\u00eda de la informaci\u00f3n","text":""},{"location":"1_introduccion_a_las_smart_cities/#smart-city-ejemplo-barcelona","title":"Smart city: ejemplo Barcelona","text":"<p>Barcelona ha establecido una serie de proyectos que pueden considerarse aplicaciones de 'ciudad inteligente' dentro de su estrategia \"CityOS\". Por ejemplo, se ha implementado tecnolog\u00eda de sensores en el sistema de riego del Parc del Centre de Poblenou, donde se transmiten datos en tiempo real a los equipos de jardiner\u00eda sobre el nivel de agua necesario para las plantas. Barcelona tambi\u00e9n ha dise\u00f1ado una nueva red de autobuses basada en el an\u00e1lisis de datos de los flujos de tr\u00e1fico m\u00e1s comunes en Barcelona, \u200b\u200butilizando principalmente rutas verticales, horizontales y diagonales con una serie de intercambios. La integraci\u00f3n de m\u00faltiples tecnolog\u00edas de ciudades inteligentes se puede ver a trav\u00e9s de la implementaci\u00f3n de sem\u00e1foros inteligentes, ya que los autobuses recorren rutas dise\u00f1adas para optimizar el n\u00famero de sem\u00e1foros en verde. Adem\u00e1s, cuando se notifica una emergencia en Barcelona, \u200b\u200bla ruta aproximada del veh\u00edculo de emergencia se ingresa en el sistema de sem\u00e1foros, poniendo todas las luces en verde a medida que el veh\u00edculo se acerca a trav\u00e9s de una combinaci\u00f3n de GPS y software de gesti\u00f3n de tr\u00e1fico, lo que permite que los servicios de emergencia llegar al incidente sin demora. Gran parte de estos datos son administrados por la Plataforma Sentilo.</p> <p>https://en.wikipedia.org/wiki/List_of_smart_cities#Barcelona</p>"},{"location":"1_introduccion_a_las_smart_cities/#smart-cities-tambien-es-comportamiento-humano","title":"Smart cities tambi\u00e9n es comportamiento humano","text":"<p>En las Smart Cities no es s\u00f3lo el componente tecnol\u00f3gico, tambi\u00e9n es muy importante el componente humano. Una ciudad podr\u00e1 ser calificado de inteligente en la medida que las inversiones que se realicen en capital humano (educaci\u00f3n), en aspectos sociales, \u200ben infraestructuras de energ\u00eda,\u200b tecnolog\u00edas de comunicaci\u00f3n e infraestructuras de transporte,\u200b contemplen y promuevan una calidad de vida elevada, un desarrollo econ\u00f3mico-ambiental durable y sostenible, una gobernanza participativa,\u200b una gesti\u00f3n prudente y reflexiva de los recursos naturales, as\u00ed como un buen aprovechamiento del tiempo de los ciudadanos. </p> <p>Tecnol\u00f3gicamente una Smart City se base en un conjunto de servicios (web) especializados</p> <p>Si estos servicios contienen una componente geogr\u00e1fica (coordenadas), hablaremos de GeoServicios.</p>"},{"location":"1_introduccion_a_las_smart_cities/#que-es-un-servicio-y-para-que-sirve","title":"\u00bfQu\u00e9 es un servicio y para qu\u00e9 sirve?","text":"<p>Un servicio es una interfaz que recibe par\u00e1metros + valores y devuelve una respuesta formateada.</p> <p>Los par\u00e1metros y repuestas son conocidos y est\u00e1n documentados en formato de API.</p>"},{"location":"1_introduccion_a_las_smart_cities/#api-application-programming-interface","title":"API - Application Programming Interface","text":"<p>La interfaz de programaci\u00f3n de aplicaciones, conocida tambi\u00e9n por la sigla API,\u200b es un conjunto de subrutinas, funciones y procedimientos que ofrece cierta biblioteca para ser utilizada por otro software. <sup>1</sup></p> <p>El t\u00e9rmino API se usa a menudo para referirse a las API web, que permiten la comunicaci\u00f3n entre computadoras que est\u00e1n unidas por Internet. Tambi\u00e9n hay API para lenguajes de programaci\u00f3n, bibliotecas de software, sistemas operativos de computadora y hardware de computadora.</p> <p>La documentaci\u00f3n de la API generalmente se proporciona para facilitar el uso.</p> <p>Webs con enlaces a diferentes APIs</p> <p>https://www.programmableweb.com/</p> <p>https://rapidapi.com/</p>"},{"location":"1_introduccion_a_las_smart_cities/#http","title":"HTTP","text":"<p>El protocolo HTTP tiene diferentes m\u00e9todos de interrogaci\u00f3n.</p> <ul> <li>GET</li> <li>POST</li> <li>UPDATE</li> <li>DELETE</li> <li>INSERT</li> </ul> <p>Note</p> <p>HTTP - GET es el m\u00e1s usado en APIs web</p>"},{"location":"1_introduccion_a_las_smart_cities/#tipos-de-peticiones-http-get","title":"Tipos de peticiones HTTP - GET","text":"<p>KvP: (Key value Pair): despu\u00e9s del ? pasamos par\u00e1metro = valor y concatenamos con &amp;.</p> <p>Ejemplo: http://midominio.com/servidor/enpoint?parametro1=valor1&amp;parametro2=valor=2</p> <p>RESTful: la URL define el recurso, dentro de una arquitectura REST.</p> <p>Ejemplo: http://midominio.com/servidor/recurso.json</p> <p>RESTful and KvP: la URL define el recurso, pero podemos filtrar recurso con par\u00e1metros.</p> <p>Ejemplo: http://midominio.com/servidor/recurso.json?parametro1=valor1 (Utilizada en APIs OpenData)  </p> <p>Muchos servicios y/o informaci\u00f3n relativa a Smart City, son expuestos  c\u00f3mo OpenData (Datos Abiertos) en portales de administraciones p\u00fablicas. Son las llamadas \u201cPlataformas\u201c para la publicaci\u00f3n y gesti\u00f3n de Open data.</p> <p>Temario</p> <ul> <li>Introducci\u00f3n a las Smart Cities<ul> <li>Conceptos Smart Cities</li> <li>Conceptos Open Data</li> <li>Conceptos sensores</li> <li>Tecnolog\u00edas OpenData</li> </ul> </li> </ul>"},{"location":"1_introduccion_a_las_smart_cities/#referencias","title":"Referencias","text":"<ol> <li> <p>https://es.wikipedia.org/wiki/Interfaz_de_programaci%C3%B3n_de_aplicaciones \u21a9</p> </li> </ol>"},{"location":"2_1_apis_y_servicios_open_data/","title":"API servicios Open data (CKAN y SOCRATA)","text":""},{"location":"2_1_apis_y_servicios_open_data/#ejemplo-api-ckan","title":"Ejemplo API CKAN","text":"<p>El API de CKAN https://docs.ckan.org/en/latest/api/index.html no ofrece diferentes niveles y m\u00e9todos para poder buscar y filtrar datasets.</p> <p>En este ejemplo utilizaremos el m\u00e9todo resource_search para buscar datasets en cualquier portal de CKAN</p> <p>Para buscar en portales CKAN necesitamos saber la URL del portal , ejemplo https://demo.ckan.org y a\u00f1adir el path del m\u00e9todo a utilizar /api/3/action/resource_search?</p> <p>https://demo.ckan.org/api/3/action/resource_search?</p> <p>Ver ejemplos online </p>"},{"location":"2_1_apis_y_servicios_open_data/#creacion-de-un-buscador","title":"Creaci\u00f3n de un buscador","text":"<ul> <li> <p>Dentro de nuestro espacio de trabajo creamos un archivo con el nombre de ckan.html.</p> </li> <li> <p>Abrimos el archivo ckan.html con un editor de texto y copiamos el siguiente c\u00f3digo.</p> </li> </ul> <p><pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n  &lt;title&gt;\n    Basic sample Resource Search API CKAN\n  &lt;/title&gt;\n  &lt;link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\"\n    crossorigin=\"anonymous\"&gt;\n  &lt;script src=\"https://code.jquery.com/jquery-3.6.1.min.js\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js\"\n    crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n  &lt;style&gt;\n    #results {\n      width: 100%;\n      background-color: #f2f2f2;\n      margin: 5px;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> *  Abrimos el archivo ckan.html en el navegador.</p> <ul> <li>A\u00f1adimos dentro del tag <code>&lt;body&gt;</code> la maquetaci\u00f3n HTML</li> </ul> <pre><code>  &lt;div class=\"container\"&gt;\n    &lt;h3&gt;Resource Search example &lt;/h3&gt;\n    &lt;p&gt; Package Search &lt;br&gt;\n      &lt;a target=\"_blank\" href=\"https://docs.ckan.org/en/latest/api/\"&gt;https://docs.ckan.org/en/latest/api/&lt;/a&gt;\n    &lt;/p&gt;\n    &lt;form id=\"_form\"&gt;\n      &lt;div class=\"form-group\"&gt;\n        &lt;label for=\"url_ckan\"&gt;Url:&lt;/label&gt;\n\n        &lt;select id=\"url_ckan\"&gt;\n          &lt;option value=\"https://demo.ckan.org/api/3/action/resource_search?\"&gt;ckan.org&lt;/option&gt;\n          &lt;option value=\"https://old.datahub.io/api/3/action/resource_search?\"&gt;old.datahub.io&lt;/option&gt;\n          &lt;!-- a\u00f1adimos BCN opendata --&gt;\n                    &lt;!--\n          &lt;option value=\"https://opendata-ajuntament.barcelona.cat/data/api/3/action/resource_search?\"&gt;OpenBCN&lt;/option&gt;\n                    --&gt;\n        &lt;/select&gt;\n      &lt;/div&gt;\n      &lt;div class=\"form-group\"&gt;\n        &lt;label for=\"text_filter_ckan\"&gt; Filter &lt;u&gt;(name, descripton, format )&lt;/u&gt;&lt;/label&gt;\n        &lt;input type=\"text\" class=\"form-control\" id=\"text_filter_ckan\" value=\"name:wifi\" placeholder=\"text filter\"&gt;\n      &lt;/div&gt;\n    &lt;/form&gt;\n    &lt;form class=\"form-inline\"&gt;\n      &lt;div class=\"form-group\"&gt;\n        &lt;label for=\"num_results_ckan\"&gt;Num results&lt;/label&gt;\n        &lt;input type=\"number\" size=\"3\" class=\"form-control\" id=\"num_results_ckan\" value=\"5\"&gt;\n      &lt;/div&gt;\n\n    &lt;/form&gt;\n    &lt;form&gt;\n      &lt;div class=\"form-group\"&gt;\n        &lt;button id=\"bt_send\" type=\"button\" class=\"btn btn-default btn-success\"&gt;Send&lt;/button&gt;\n      &lt;/div&gt;\n    &lt;/form&gt;\n    &lt;hr&gt;\n    &lt;div id=\"results\"&gt;&lt;/div&gt;\n    &lt;div id=\"mygrid\" style=\"height: 500px\"&gt;&lt;/div&gt;\n  &lt;/div&gt;\n</code></pre> <ul> <li> <p>Abrimos el archivo ckan.html en el navegador.</p> </li> <li> <p>A\u00f1adimos justo encima del tag <code>&lt;/body&gt;</code> el siguiente c\u00f3digo javascript</p> </li> </ul> <pre><code>    &lt;script&gt;\n    $.ajaxSetup({\n      cache: true\n    });\n    $(document).ready(function () {\n      $('#bt_send').on('click', function () {\n        sendRequest();\n      });\n\n      $(\"#_form\").submit(function (event) {\n        sendRequest();\n        event.preventDefault();\n      });\n\n\n      function sendRequest() {\n        var data = {\n          rows: $('#num_results_ckan').val(),\n          query: $('#text_filter_ckan').val()\n        };\n        $.ajax({\n          url: $('#url_ckan').val(),\n          data: data,\n          dataType: 'jsonp',\n          success: function (data) {\n            if (data.success) {\n              $('#results').html('Total results found: ' + data.result.count);\n              $('#mygrid').html('');\n\n              if (data.result.count &gt;= 1) {\n                $('#mygrid').append('&lt;ul&gt;');\n                $.each(data.result.results, function (index, value) {\n                  console.log(value);\n                  $('#mygrid').append('&lt;li&gt;' + value.name +': &lt;a href=\"' + value.url + '\"&gt;' + value.url +\n                    '&lt;/a&gt;');\n\n                  $('#mygrid').append('&lt;/li&gt;');\n                });\n                $('#mygrid').append('&lt;/ul&gt;');\n\n              }\n\n            } else {\n              $('#results').html(\"An error occured: \" + data.error.message);\n            }\n          },\n          error: function (xhr) {\n            $('#results').html(\"An error occured: \" + xhr.status + \" \" + xhr.statusText);\n          }\n\n        });\n      }\n\n    });\n  &lt;/script&gt;\n</code></pre> <ul> <li>Abrimos p\u00e1gina ckan.html y lanzamos b\u00fasquedas</li> </ul> <p>Question</p> <p>Ejercicio 1: A\u00f1adir una o m\u00e1s URLs de otros portales de CKAN, por ejemplo OpenDataBCN</p> <p>Question</p> <p>Ejercicio 2: \u00bfC\u00f3mo har\u00edamos para qu\u00e9 en los resultados apareciera la fecha de creaci\u00f3n del dato?</p> <p>Question</p> <p>Ejercicio 3: Buscamos name:accidents  y descargamos CSV accidentes</p>"},{"location":"2_1_apis_y_servicios_open_data/#ejemplos-api-socrata","title":"Ejemplos API SOCRATA","text":"<p>El API de Socrata https://dev.socrata.com no ofrece diferentes niveles y m\u00e9todos para poder buscar y filtra datasets.</p> <p>En este primer ejemplo utilizaremos la Discovery API https://socratadiscovery.docs.apiary.io/ para buscar datasets en cualquier portal de Socrata</p> <p>Creaci\u00f3n de un buscador</p> <ul> <li> <p>Creamos un archivo con el nombre de socrata.html.</p> </li> <li> <p>Abrimos el archivo socrata.html con un editor de texto y copiamos el siguiente c\u00f3digo.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n  &lt;title&gt;\n    Basic sample API Discovery SOCRATA\n  &lt;/title&gt;\n  &lt;link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\"\n    crossorigin=\"anonymous\"&gt;\n  &lt;script src=\"https://code.jquery.com/jquery-3.6.1.min.js\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js\"\n    crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n  &lt;style&gt;\n    #results {\n      width: 100%;\n      background-color: #f2f2f2;\n      margin: 5px;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Abrimos el archivo socrata.html en el navegador.</p> </li> <li> <p>A\u00f1adimos dentro del tag <code>&lt;body&gt;</code> la maquetaci\u00f3n HTML.</p> </li> </ul> <pre><code>    &lt;div class=\"container\"&gt;\n    &lt;h3&gt;SOCRATA Resource Search example &lt;/h3&gt;\n    &lt;p&gt;Discovery API &lt;br&gt;\n      &lt;a target=\"_blank\" href=\"https://socratadiscovery.docs.apiary.io/#\"&gt;https://socratadiscovery.docs.apiary.io/#&lt;/a&gt;\n    &lt;/p&gt;\n    &lt;form&gt;\n      &lt;div class=\"form-group\"&gt;\n        &lt;div class=\"radio\"&gt;\n          &lt;label&gt;\n            &lt;input type=\"radio\" name=\"optionsRadios\" id=\"optionsRadios1\"\n              value=\"https://api.eu.socrata.com/api/catalog/v1\" checked&gt;\n            EU API Discovery\n          &lt;/label&gt;\n        &lt;/div&gt;\n        &lt;div class=\"radio\"&gt;\n          &lt;label&gt;\n            &lt;input type=\"radio\" name=\"optionsRadios\" id=\"optionsRadios2\"\n              value=\"https://api.us.socrata.com/api/catalog/v1\"&gt;\n            US API Discovery\n          &lt;/label&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n      &lt;div class=\"form-group\"&gt;\n        &lt;label for=\"text_filter_socrata\"&gt; Filter &lt;u&gt;&lt;/u&gt;&lt;/label&gt;\n        &lt;input type=\"text\" class=\"form-control\" id=\"text_filter_socrata\" value=\"Contracts\" placeholder=\"text filter\"&gt;\n      &lt;/div&gt;\n    &lt;/form&gt;\n    &lt;form class=\"form-inline\"&gt;\n      &lt;div class=\"form-group\"&gt;\n        &lt;label for=\"num_results_socrata\"&gt;Num results&lt;/label&gt;\n        &lt;input type=\"number\" size=\"3\" class=\"form-control\" id=\"num_results_socrata\" value=\"25\"&gt;\n      &lt;/div&gt;\n\n    &lt;/form&gt;\n    &lt;form&gt;\n      &lt;div class=\"form-group\"&gt;\n        &lt;button id=\"bt_send\" type=\"button\" class=\"btn btn-default btn-success\"&gt;Send&lt;/button&gt;\n      &lt;/div&gt;\n    &lt;/form&gt;\n    &lt;hr&gt;\n    &lt;div id=\"results\"&gt;&lt;/div&gt;\n    &lt;div id=\"mygrid\" style=\"height: 500px\"&gt;&lt;/div&gt;\n  &lt;/div&gt;\n</code></pre> <ul> <li> <p>Abrimos el archivo socrata.html en el navegador.</p> </li> <li> <p>A\u00f1adimos justo encima del tag <code>&lt;/body&gt;</code> el siguiente c\u00f3digo javascript</p> </li> </ul> <pre><code>    &lt;script&gt;\n    $.ajaxSetup({\n      cache: true\n    });\n    $(document).ready(function () {\n      $('#bt_send').on('click', function () {\n        sendRequest();\n      });\n\n      $('#text_filter_socrata').on('keypress', function (event) {\n        if (event.which == 13) {\n          sendRequest();\n          event.preventDefault();\n        }\n      });\n\n      function sendRequest() {\n        var _data = {\n          q: $('#text_filter_socrata').val(),\n          limit: $('#num_results_socrata').val()\n        };\n        $.ajax({\n          url: $('input:radio[name=optionsRadios]:checked').val(),\n          data: _data,\n          method: 'GET',\n          dataType: 'json',\n          success: function (data) {\n            console.info(data);\n            if (data) {\n              $('#results').html('Total results found: ' + data.resultSetSize);\n              $('#mygrid').html('');\n\n              if (data.resultSetSize &gt;= 1) {\n                $('#mygrid').append('&lt;ul&gt;');\n                $.each(data.results, function (index, value) {\n                  $('#mygrid').append('&lt;li&gt;&lt;b&gt;' + value.resource.name + '&lt;/b&gt;(' + value.resource.type + '): &lt;a target=\"_blank\" href=\"' + value.link + '\"&gt;' + value.link + '&lt;/a&gt;');\n                  $('#mygrid').append('&lt;/li&gt;');\n                });\n                $('#mygrid').append('&lt;/ul&gt;');\n              }\n            } else {\n              $('#results').html(\"An error occured:\");\n            }\n          },\n          error: function (xhr) {\n            $('#results').html(\"An error occured: \" + xhr.status + \" \" + xhr.statusText);\n          }\n        });\n      }\n    });\n  &lt;/script&gt;\n</code></pre> <ul> <li>Abrimos p\u00e1gina socrata.html y lanzamos b\u00fasquedas</li> </ul> <p>Question</p> <p>Ejercicio 1: \u00bfC\u00f3mo filtrar\u00edamos para qu\u00e9 s\u00f3lo ense\u00f1ara \"assets\" de tipo \"map\", only:map?</p>"},{"location":"2_1_apis_y_servicios_open_data/#creacion-de-un-mapa-para-ver-resultados-de-socrata","title":"Creaci\u00f3n de un mapa para ver resultados de Socrata","text":"<ul> <li> <p>Creamos un archivo con el nombre de socrata_mapa.html.</p> </li> <li> <p>Abrimos el archivo socrata_mapa.html con un editor de texto y copiamos el siguiente c\u00f3digo.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n  &lt;title&gt;\n    Basic Leaflet Map sample API Discovery SOCRATA\n  &lt;/title&gt;\n  &lt;link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\"\n    crossorigin=\"anonymous\"&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.9.3/dist/leaflet.css\" crossorigin=\"\" /&gt;\n\n  &lt;script src=\"https://code.jquery.com/jquery-3.6.1.min.js\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js\"\n    crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://unpkg.com/leaflet@1.9.3/dist/leaflet.js\"\n    integrity=\"sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=\" crossorigin=\"\"&gt;&lt;/script&gt;\n  &lt;script type=\"text/javascript\"\n    src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js\"&gt;&lt;/script&gt;\n  &lt;script type=\"text/javascript\" src=\"https://cdnjs.cloudflare.com/ajax/libs/spin.js/2.3.2/spin.min.js\"&gt;&lt;/script&gt;\n  &lt;script type=\"text/javascript\"\n    src=\"https://cdnjs.cloudflare.com/ajax/libs/Leaflet.Spin/1.1.2/leaflet.spin.min.js\"&gt;&lt;/script&gt;\n  &lt;style&gt;\n    #results {\n      width: 100%;\n      background-color: #f2f2f2;\n      margin: 5px;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>A\u00f1adimos dentro del tag  <code>&lt;body&gt;</code> la maquetaci\u00f3n HTML</li> </ul> <pre><code>    &lt;div class=\"container\"&gt;\n    &lt;h3&gt;SOCRATA Maps Resources &lt;/h3&gt;\n    &lt;div class=\"row\"&gt;\n      &lt;div class=\"col-md-6\"&gt;\n        &lt;p&gt;Discovery API &lt;br&gt;\n          &lt;a target=\"_blank\" href=\"https://socratadiscovery.docs.apiary.io/#\"&gt;https://socratadiscovery.docs.apiary.io/#&lt;/a&gt;\n        &lt;/p&gt;\n        &lt;form&gt;\n          &lt;div class=\"form-group\"&gt;\n            &lt;div class=\"radio\"&gt;\n              &lt;label&gt;\n                &lt;input type=\"radio\" name=\"optionsRadios\" id=\"optionsRadios1\"\n                  value=\"https://api.eu.socrata.com/api/catalog/v1\" checked&gt;\n                EU API Discovery\n              &lt;/label&gt;\n            &lt;/div&gt;\n            &lt;div class=\"radio\"&gt;\n              &lt;label&gt;\n                &lt;input type=\"radio\" name=\"optionsRadios\" id=\"optionsRadios2\"\n                  value=\"https://api.us.socrata.com/api/catalog/v1\"&gt;\n                US API Discovery\n              &lt;/label&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n          &lt;div class=\"form-group\"&gt;\n            &lt;label for=\"text_filter_socrata\"&gt; Filter &lt;u&gt;&lt;/u&gt;&lt;/label&gt;\n            &lt;input type=\"text\" class=\"form-control\" id=\"text_filter_socrata\" value=\"\" placeholder=\"text filter\"&gt;\n\n            &lt;div class=\"checkbox\"&gt;\n              &lt;label&gt;&lt;input type=\"checkbox\" id=\"chk_transparencia\" value=\"analisi.transparenciacatalunya.cat\"&gt;Only\n                https://analisi.transparenciacatalunya.cat&lt;/label&gt;\n            &lt;/div&gt;\n            &lt;div&gt; Filter : only=maps&lt;/div&gt;\n          &lt;/div&gt;\n\n        &lt;/form&gt;\n        &lt;form class=\"form-inline\"&gt;\n          &lt;div class=\"form-group\"&gt;\n            &lt;label for=\"num_results_socrata\"&gt;Num results&lt;/label&gt;\n            &lt;input type=\"number\" size=\"3\" class=\"form-control\" id=\"num_results_socrata\" value=\"25\"&gt;\n          &lt;/div&gt;\n\n        &lt;/form&gt;\n        &lt;form&gt;\n          &lt;div class=\"form-group\"&gt;\n            &lt;button id=\"bt_send\" type=\"button\" class=\"btn btn-default btn-success\"&gt;Send&lt;/button&gt;\n          &lt;/div&gt;\n        &lt;/form&gt;\n        &lt;hr&gt;\n        &lt;div id=\"results\"&gt;&lt;/div&gt;\n        &lt;div id=\"mygrid\" style=\"height: 365px;overflow:auto\"&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n      &lt;div class=\"col-md-6\"&gt;\n        &lt;div id=\"map\" style=\"width:100%;height:700px\"&gt;&lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n</code></pre> <ul> <li> <p>Abrimos el archivo socrata_mapa.html en el navegador.</p> </li> <li> <p>A\u00f1adimos justo encima del tag <code>&lt;/body&gt;</code> el siguiente c\u00f3digo javascript</p> </li> </ul> <pre><code>  &lt;script&gt;\n    $.ajaxSetup({\n      cache: true\n    });\n    var map;\n    var geojsonLayer;\n    var _LL;\n    $(document).ready(function () {\n      map = L.map('map').setView([41.6863, 1.8382], 8);\n      esri = L.tileLayer(\n        'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {\n        maxZoom: 17,\n        minZoom: 1,\n        attribution: 'Tiles \u00a9 Esri',\n      })\n\n      osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        maxZoom: 19,\n        minZoom: 1,\n        attribution: 'OSM'\n      }).addTo(map);\n\n      Stamen_Toner = L.tileLayer('http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png', {\n        attribution: 'Map tiles by &lt;a href=\"https://stamen.com\"&gt;Stamen Design&lt;/a&gt;, &lt;a href=\"https://creativecommons.org/licenses/by/3.0\"&gt;CC BY 3.0&lt;/a&gt; &amp;mdash; Map data &amp;copy; &lt;a href=\"https://www.openstreetmap.org/copyright\"&gt;OpenStreetMap&lt;/a&gt;',\n        subdomains: 'abcd',\n        minZoom: 0,\n        maxZoom: 20\n      })\n\n      var baseMaps = {\n        \"Orto\": esri,\n        \"Mapa\": osm,\n        \"Toner\": Stamen_Toner\n      };\n\n      L.control.layers(baseMaps, null).addTo(map);\n      L.control.scale().addTo(map);\n\n\n      $('#bt_send').on('click', function () {\n        sendRequest();\n      });\n\n      $('#text_filter_socrata').on('keypress', function (event) {\n        if (event.which == 13) {\n          sendRequest();\n          event.preventDefault();\n        }\n      });\n\n      $(document).on('click', '.btn-xs', function () {\n\n        var attr = $(this).attr('data');\n        if (attr &amp;&amp; attr.indexOf('#') != -1) {\n          var params = attr.split(\"#\");\n          var _url = 'https://' + params[1] + '/api/views.json?method=getByResourceName&amp;name=' + params[0];\n          $.ajax({\n            url: _url,\n            method: 'GET',\n            dataType: 'json',\n            success: function (data) {\n\n              if (data.childViews) {\n                var _url2 = 'https://' + params[1] + '/resource/' + data.childViews[0] + '.json?';\n                //var _url2 = 'https://' + params[1] + '/api/geospatial/' + data.childViews[0] + '?method=export&amp;format=GeoJSON';\n                sendRequestGEOJSON(_url2, true);\n              } else {\n                var _url2 = 'https://' + params[1] + '/resource/' + params[0] + '.json?$limit=30';\n                sendRequestGEOJSON(_url2, false);\n              }\n            },\n            error: function (xhr) {\n              $('#results').html(\"An error occured: \" + xhr.status + \" \" + xhr.statusText);\n            }\n\n          });\n\n        } else {\n          alert(\"No resource available\");\n        }\n      });\n\n      function clearLayers() {\n        if (geojsonLayer &amp;&amp; map.hasLayer(geojsonLayer)) {\n          map.removeLayer(geojsonLayer);\n        };\n        if (_LL &amp;&amp; map.hasLayer(_LL)) {\n          map.removeLayer(_LL);\n        };\n      }\n\n      function sendRequestGEOJSON(_url2, isGeoJson) {\n        map.spin(true);\n        var stylePoint = {\n          radius: 8,\n          fillColor: \"#ff7800\",\n          color: \"#000\",\n          weight: 1,\n          opacity: 1,\n          fillOpacity: 0.8\n        };\n        clearLayers();\n        $.ajax({\n          type: \"GET\",\n          url: _url2,\n          // jsonp: \"$jsonp\",\n          //  dataType: \"jsonp\",\n          success: function (response) {\n            if (isGeoJson) {\n\n              geojsonLayer = L.geoJson(response, {\n                style: function (feature) {\n                  return {\n                    weight: 2,\n                    color: \"#999\",\n                    opacity: 1,\n                    fillColor: \"#B0DE5C\",\n                    fillOpacity: 0.8\n                  };\n                },\n\n                onEachFeature: popUp\n              }).addTo(map);\n              map.fitBounds(geojsonLayer.getBounds());\n              map.spin(false);\n            } else {\n              _LL = L.featureGroup()\n\n              for (var i = 0; i &lt; response.length; i++) {\n                var marker = response[i];\n\n                if (response[i].location_1) {\n                  L.circleMarker([response[i].location_1.latitude, response[i].location_1.longitude], stylePoint).addTo(_LL);\n                } else if (response[i].location) {\n                  L.circleMarker([response[i].location.latitude, response[i].location.longitude], stylePoint).addTo(_LL);\n                } else {\n                  $('#results').html(\"ERROR no locations found\");\n                  map.spin(false);\n\n                }\n              }\n\n              _LL.addTo(map);\n              map.panTo(_LL.getBounds().getCenter());\n              map.spin(false);\n\n            }\n          },\n          error: function (xhr) {\n            $('#results').html(\"An error occured: \" + xhr.status + \" \" + xhr.statusText);\n            map.spin(false);\n          }\n        });\n      }\n\n      function popUp(f, l) {\n        var out = [];\n        if (f.properties) {\n          for (key in f.properties) {\n            out.push(key + \": \" + f.properties[key]);\n          }\n          l.bindPopup(out.join(\"&lt;br /&gt;\"));\n        }\n      }\n\n      function sendRequest() {\n        var _data = {\n          limit: $('#num_results_socrata').val(),\n          only: 'maps'\n        };\n        console.info($('#chk_transparencia').attr('checked'));\n        if ($('#chk_transparencia').attr('checked')) {\n          _data.domains = $('#chk_transparencia').val();\n        }\n        if ($('#text_filter_socrata').val() != \"\") {\n          _data.q = $('#text_filter_socrata').val();\n        }\n\n        $.ajax({\n          url: $('input:radio[name=optionsRadios]:checked').val(),\n          data: _data,\n          method: 'GET',\n          dataType: 'json',\n          success: function (data) {\n            console.info(data);\n            if (data) {\n              $('#results').html('Total results found: ' + data.resultSetSize);\n              $('#mygrid').html('');\n\n              if (data.resultSetSize &gt;= 1) {\n                var cList = $('&lt;ul&gt;').appendTo('#mygrid');\n                $.each(data.results, function (index, value) {\n                  $('&lt;li class=\"li\"&gt;&lt;b&gt;' + value.resource.name + ': &lt;/b&gt;' +\n                    '&lt;a target=\"_blank\" href=\"' + value.link + '\"&gt; Link &lt;/a&gt; ' +\n                    '&lt;a class=\"btn btn-success btn-xs\"  href=\"#\" data=\"' + value.resource.id + '#' + value.metadata.domain + '\"&gt;Map it&lt;/a&gt;').appendTo(cList);\n\n                });\n              }\n\n            } else {\n              console.info(data);\n              $('#results').html(\"An error occured:\");\n            }\n          },\n          error: function (xhr) {\n            $('#results').html(\"An error occured: \" + xhr.status + \" \" + xhr.statusText);\n          }\n        });\n      }\n    });\n  &lt;/script&gt;\n</code></pre> <ul> <li>Abrimos p\u00e1gina socrat_mapa.html y lanzamos b\u00fasquedas</li> </ul> <p>Question</p> <p>Ejercicio 1: A\u00f1adimos attribution y download_count a los resultados</p> <p>Question</p> <p>Ejercicio 2: \u00bfCambiamos colores y estilos del mapa?</p>"},{"location":"2_1_apis_y_servicios_open_data/#referencias","title":"Referencias","text":"<p>https://docs.ckan.org/en/latest/api/ https://ckan.org https://www.socrata.com https://docs.socratadiscovery.apiary.io</p>"},{"location":"2_introduccion_open_data/","title":"Introducci\u00f3n al Open data","text":"<p>El concepto datos abiertos (open data, en ingl\u00e9s) es una filosof\u00eda y pr\u00e1ctica que persigue que determinados tipos de datos est\u00e9n disponibles de forma libre para todo el mundo, sin restricciones de derechos de autor, de patentes o de otros mecanismos de control.\u200b Tiene una \u00e9tica similar a otros movimientos y comunidades abiertos, como el software libre, el c\u00f3digo abierto (open source, en ingl\u00e9s) y el acceso libre (open access, en ingl\u00e9s). <sup>1</sup></p>"},{"location":"2_introduccion_open_data/#modelos-open-data","title":"Modelos Open data","text":""},{"location":"2_introduccion_open_data/#representar-y-exponer","title":"Representar y Exponer","text":"<p>Las nuevas plataformas de publicaci\u00f3n de Open data equilibran la barra de los esfuerzos entre representar/exponer y consumir/reutilizar.</p> <p> publica tus datos en la Web (con cualquier formato) y bajo una licencia abierta</p> <p>  publ\u00edcalos como datos estructurados (ej: Excel en vez de una imagen de una tabla escaneada)</p> <p>  usa formatos no propietarios (ej: CSV en vez de Excel)</p> <p>  usa URIs para denotar cosas, as\u00ed la gente puede apuntar a estas</p> <p>  enlaza tus datos a otros datos para proveer contexto</p>"},{"location":"2_introduccion_open_data/#linked-data","title":"Linked data","text":"<p>En inform\u00e1tica, los datos enlazados o datos vinculados (a menudo referidos en ingl\u00e9s como linked data) describe un m\u00e9todo de publicaci\u00f3n de datos estructurados para que puedan ser interconectados y m\u00e1s \u00fatiles. Se basa en tecnolog\u00edas Web est\u00e1ndar, tales como HTTP, RDF, RDFa y los URI,\u200b pero en vez de utilizarlos para servir p\u00e1ginas web para los lectores humanos, las extiende para compartir informaci\u00f3n de una manera que puede ser le\u00edda autom\u00e1ticamente por ordenadores. Esto permite que sean conectados y consultados datos de diferentes fuentes.<sup>2</sup></p> <p></p> <p>https://lod-cloud.net/</p>"},{"location":"2_introduccion_open_data/#plataformas-open-data","title":"Plataformas Open data","text":""},{"location":"2_introduccion_open_data/#socrata","title":"Socrata","text":"<p>Socrata era una empresa de software adquirida por Tyler Technologies en 2018. Socrata proporciona herramientas de visualizaci\u00f3n y an\u00e1lisis de datos basadas en la nube para abrir datos gubernamentales. Originalmente llamada Blist, Socrata se fund\u00f3 en febrero de 2007. Socrata se dirige a usuarios de Internet no t\u00e9cnicos que desean ver y compartir datos gubernamentales, de salud, energ\u00eda, educaci\u00f3n o medio ambiente. Sus productos se emiten bajo una licencia propietaria, cerrada y exclusiva.</p> <p>Sede:  Seattle, Washington, USA</p> <p>Fundada: 2007 </p> <p>Modelo negocio: Software-as-a-Service bajo licencia. API y SDK\u2019s (acceso a datos) OpenSource.</p> <p>https://www.tylertech.com/products/socrata</p> <p>http://dev.socrata.com/</p> <p>https://github.com/socrata</p> <p>Portal global: https://www.opendatanetwork.com</p> <p>Discovery API: https://socratadiscovery.docs.apiary.io/#</p> <p>SODA API (Socrata Open Data API): https://dev.socrata.com/consumers/getting-started.html</p>"},{"location":"2_introduccion_open_data/#portales-con-socrata","title":"Portales con Socrata:","text":"<p>https://analisi.transparenciacatalunya.cat/</p> <p>https://opendata.rubi.cat/es/browse</p>"},{"location":"2_introduccion_open_data/#opendatasoft","title":"OpenDataSoft","text":"<p>OpenDataSoft es una empresa privada de software especializada en transformar datos estructurados en API y visualizaciones. Fundada en 2011, OpenDataSoft se dirige a usuarios no t\u00e9cnicos que desean compartir y visualizar datos gubernamentales, de salud, energ\u00e9ticos y medioambientales. OpenDataSoft permite ecosistemas de intercambio restringido y abierto como portales de datos abiertos.</p> <p>Sede:  Paris, Fr</p> <p>Fundada: 2011 </p> <p>Modelo negocio: Software-as-a-Service bajo licencia. API y SDK\u2019s (acceso a datos) OpenSource. Gratuito para \u201cnonprofit\u201d y ONG</p> <p>https://www.opendatasoft.com/</p> <p>https://www.opendatasoft.com/open-data-solutions/</p> <p>https://github.com/opendatasoft</p> <p>Portal global: https://public.opendatasoft.com/explore/?sort=modified</p> <p>API: https://public.opendatasoft.com/api/v1/console/datasets/1.0/search/</p>"},{"location":"2_introduccion_open_data/#ckan","title":"Ckan","text":"<p>Open Knowledge International (OKI) (conocida como Open Knowledge Foundation (OKF) hasta abril de 2014, luego Open Knowledge hasta mayo de 2016) es una red global sin fines de lucro que promueve y comparte informaci\u00f3n sin cargo, incluida tanto el contenido como los datos. Fue fundada por Rufus Pollock el 24 de mayo de 2004 en Cambridge, Reino Unido.</p> <p>Sede:  Cambrigde, UK</p> <p>Fundada: 2004</p> <p>Modelo negocio: Fundaci\u00f3n Open Knowledge International. Todo OpenSource pero tambi\u00e9n ofrecen servicio (de pago) de Hosting.</p> <p>https://ckan.org</p> <p>https://github.com/ckan/ckan</p> <p>https://datahub.io</p> <p>Portal global: http://dataportals.org/</p> <p>API: http://docs.ckan.org/en/latest/api/index.html</p> <ul> <li>CKAN es OpenSource</li> <li>Puedo instalarlo en mi servidor o utilizar servicio web</li> <li>Puedo automatizar la gesti\u00f3n de datasets</li> <li>Todos los Datasets est\u00e1n expuestos via API</li> </ul>"},{"location":"2_introduccion_open_data/#ejemplos-api","title":"Ejemplos API","text":"<p>Listado de portales con CKAN http://dataportals.org/api/data.json/</p> <p>Museos de Barcelona https://opendata-ajuntament.barcelona.cat/data/api/3/action/package_search?q=museu</p> <p>Barrios Barcelona https://opendata-ajuntament.barcelona.cat/data/api/3/action/resource_search?query=description:barri</p>"},{"location":"2_introduccion_open_data/#portales-con-ckan","title":"Portales con Ckan:","text":"<p>https://opendata-ajuntament.barcelona.cat/</p> <p>https://www.seu-e.cat/es/web/rubi/dades-obertes</p> <p>https://data.gov.uk/</p>"},{"location":"2_introduccion_open_data/#referencias","title":"Referencias","text":"<ol> <li> <p>https://es.wikipedia.org/wiki/Datos_abiertos \u21a9</p> </li> <li> <p>https://es.wikipedia.org/wiki/Datos_enlazados \u21a9</p> </li> </ol>"},{"location":"3_conceptos_vector_tiles/","title":"Conceptos Vector Tiles","text":"<p>Vector Tiles es un formato para almacenar datos geogr\u00e1ficos en formato binario (Google Protobuf) y pensados para la visualizaci\u00f3n en navegadores web modernos que soporten webGL.</p> <p>Una tesela vectorial (vector tiles) contiene datos vectoriales georreferenciados (puede contener m\u00faltiples capas), recortados en teselas para facilitar su recuperaci\u00f3n. Son equivalentes a las teselas raster tradicionales (XYZ,WMTS, TMS) pero retornan datos vectoriales en lugar de una imagen raster.</p> <p>Cada conjunto de teselas vectoriales tiene su propio esquema. Un esquema consiste en nombres de capas, atributos, selecci\u00f3n de elementos.</p> <p>Ejemplo mapa raster</p> <p>https://openicgc.github.io/exemples/leaflet/icgc-raster-leaflet-map.html</p> <p>Ejemplo mapa vector</p> <p>https://openicgc.github.io/exemples/maplibre/icgc-basemap-maplibre-map.html#7.4/41.706/1.146</p>"},{"location":"3_conceptos_vector_tiles/#contexto","title":"Contexto","text":"<p>En 2005 GoogleMaps introdujo una \"nueva\" forma de mostrar datos geogr\u00e1ficos por la web, pregenerando el mapa por niveles de zoom y tiles (teselas) de 256x256 pixeles.</p> <p>Tambi\u00e9n cre\u00f3 una nueva proyecci\u00f3n basada en mercator, llamada pseude-mercator o web mercator, cuyo c\u00f3digo EPSG es 3857</p> <p> </p> <p>Despu\u00e9s de GoogleMaps, otros proveedores o plataformas c\u00f3mo OpenStreetMap siguen esta misma forma de organizar la geoinformaci\u00f3n.</p>"},{"location":"3_conceptos_vector_tiles/#protocolos","title":"Protocolos","text":"<p>Para cargar la im\u00e1genes se utiliza una llamada HTTP rest d\u00f3nde se especifica;</p> <p>https://.../.../z/x/y.format</p> <p>Z= Nivel de zoom</p> <p>X=coordenada X</p> <p>Y=coordenada Y</p> <p>Formato </p> <p>Raster: Imagen png o JPEG</p> <p>Vector: (pbf o mvt)</p> <p></p>"},{"location":"3_conceptos_vector_tiles/#protocolos_1","title":"Protocolos","text":"<p>Existen tres especificaciones para servir tiles</p> <ul> <li> <p>TMS (Tile Map Service): X Y coordenadas empiezan de debajo  izquierda (t\u00edpico eje cartesiano de coordenadas)</p> </li> <li> <p>WMTS (Web Map Tile Service): OGC estandar , coordenadas empiezan de arriba izquierda.</p> </li> <li> <p>ZXY o \"slippy map\": Igual que TMS pero la Y empieza por arriba izquierda</p> </li> </ul> <p> </p>"},{"location":"3_conceptos_vector_tiles/#caracteristicas","title":"Caracter\u00edsticas","text":"<p>Las teselas vectoriales han sido utilizadas por el cliente Android de Google Maps desde diciembre de 2010 y en el cliente de escritorio desde 2013. Las teselas vectoriales para renderizar los datos de OpenStreetMap se propusieron por primera vez en marzo de 2013 y est\u00e1n soportadas por Mapnik, el renderizador de datos de OpenStreetMap m\u00e1s utilizado.  Mapbox, proveedor comercial de herramientas de cartograf\u00eda personalizada y de hosting, es el m\u00e1ximo impulsor de esta tecnolog\u00eda y ha centrado su herramienta de cartograf\u00eda, Mapbox Studio, en torno a las teselas vectoriales.</p> <ul> <li>Cada tile es un contenedor de datos vectores y atributos</li> <li>Los Tiles no tienen estilo, el estilo se aplica en cliente</li> <li>Soporta rotaci\u00f3n y orientaci\u00f3n</li> <li>Soporta extrusi\u00f3n y 3D</li> </ul>"},{"location":"3_conceptos_vector_tiles/#ejemplos-en-accion","title":"Ejemplos en acci\u00f3n","text":"<p>https://openicgc.github.io/</p>"},{"location":"3_conceptos_vector_tiles/#herramientas-y-recursos","title":"Herramientas y recursos","text":"<p>Fuente: https://github.com/mapbox/awesome-vector-tiles</p>"},{"location":"3_conceptos_vector_tiles/#taller","title":"Taller","text":"<p>https://geoinquiets.github.io/taller-vt/</p>"},{"location":"3_conceptos_vector_tiles/#license","title":"License","text":""},{"location":"4_visualizacion_kepler/","title":"Visualizaci\u00f3n con Kepler.gl","text":"<p>Kepler.gl desarrollada por Uber, en un principio para uso interno, para analizar y visualizar sus propios datos.</p> <p>Es una aplicaci\u00f3n basada en web GL de alto rendimiento y agn\u00f3stica de datos para la exploraci\u00f3n visual de conjuntos de datos de geolocalizaci\u00f3n a gran escala. Construido en la parte superior de deck.gl, kepler.gl puede representar millones de puntos que representan miles de viajes y realizar agregaciones espaciales sobre la marcha.</p> <p></p>"},{"location":"4_visualizacion_kepler/#ejercicio-de-visualizacion-con-keplergl","title":"Ejercicio de visualizaci\u00f3n con Kepler.gl","text":"<p>Tip</p> <p>Queremos ver d\u00f3nde hay m\u00e1s accidentes</p> <ul> <li> <p>Descargamos dataset CSV de OpenData BCN</p> </li> <li> <p>Vamos a http://kepler.gl/#/demo </p> </li> </ul> <p><code>A\u00f1adimos csv</code></p> <p></p> <p><code>Add Layer: Type Hexbin</code></p> <p><code>Columns: Latitud Longuitud</code></p> <p><code>Color: Scale Quantize</code></p> <p><code>Hexagon radius 0.1</code></p> <p><code>Coverage 0.75</code></p> <p></p> <p>Info</p> <p>Continuamos a\u00f1adiendo m\u00e1s capas y mapas bases</p>"},{"location":"5_herramientas_visualizacion_datos/","title":"Herramientas de visualizaci\u00f3n de datos","text":""},{"location":"5_herramientas_visualizacion_datos/#librerias","title":"Librer\u00edas","text":"<p>Debido a que los datos que podemos encontrar en un portal de Opendata pueden variar mucho tanto en formato como en el tipo; lo mejor para visualizarlos es utilizar librer\u00edas gen\u00e9ricas de visualizaci\u00f3n de datos. Entre las principales tenemos: </p> <ul> <li> <p>https://d3js.org/</p> </li> <li> <p>https://vega.github.io/vega/</p> </li> <li> <p>https://p5js.org/examples/</p> </li> <li> <p>http://www.chartjs.org/</p> </li> <li> <p>https://www.highcharts.com/products/highcharts/</p> </li> </ul>"},{"location":"5_herramientas_visualizacion_datos/#servicios","title":"Servicios","text":"<p>Aparte de estas librer\u00edas que nos permiten desarrollar nuestras aplicaciones de visualizaci\u00f3n de datos tambi\u00e9n existen algunos servicios conocidos como BI (Business Intelligence) que aparte de mostrar los datos tambi\u00e9n nos permiten hacer ciertos an\u00e1lisis. Algunos de los principales servicios son: </p> <ul> <li> <p>https://www.tableau.com/</p> </li> <li> <p>https://www.qlik.com/es-es</p> </li> <li> <p>http://www.pentaho.com/</p> </li> <li> <p>https://powerbi.microsoft.com/es-es/</p> </li> </ul>"},{"location":"6_conceptos_geoservicios/","title":"Conceptos b\u00e1sicos de Geoservicios","text":"<p>Recursos</p> <p>La mayor\u00edas de los conceptos son sacados del Libro libre SIG de Victor Olaya http://volaya.github.io/libro-sig/</p>"},{"location":"6_conceptos_geoservicios/#geoservicio","title":"Geoservicio","text":"<p>Un geoservicio es un servidor que ofrece alg\u00fan servicio relacionado con el \u00e1mbito SIG, su principal funci\u00f3n es acceder a informaci\u00f3n geoespacial existente en diferentes formatos y servir dicha informaci\u00f3n a clientes a trav\u00e9s de protocolos est\u00e1ndares.</p> <p>El servidor es el elemento encargado de ofrecer el servicio como tal, respondiendo a las peticiones del cliente. A medida que los clientes se hacen m\u00e1s complejos y presentan mayor n\u00famero de funcionalidades, tambi\u00e9n los servidores deben ser capaces de proporcionar servicios m\u00e1s elaborados.</p> <p>Las capacidades fundamentales a las que responden los servidores dentro del \u00e1mbito SIG pueden dividirse en los siguientes grupos:</p> <ul> <li>Servir representaciones de los datos. Los servicios de cartograf\u00eda Web, tanto en sus or\u00edgenes como en la actualidad, son eminentemente gr\u00e1ficos, y en \u00faltima instancia lo que la aplicaci\u00f3n Web correspondiente va a hacer es mostrarnos alg\u00fan tipo de imagen con un mapa formado a partir de una serie de datos geogr\u00e1ficos. Ejemplo WMS</li> </ul> <p>El servidor puede responder directamente a este tipo de necesidades, preparando una imagen a partir de los datos geogr\u00e1ficos de los que dispone. En el caso de que estos sean ya im\u00e1genes \u2014por ejemplo, im\u00e1genes de sat\u00e9lite u ortofotos\u2014, bastar\u00e1 servir estas, transmitiendo una versi\u00f3n escalada de las dimensiones exactas que el cliente necesite para representar en pantalla. En caso de que los datos sean de tipo vectorial, o bien raster sin una forma de representaci\u00f3n impl\u00edcita \u2014por ejemplo, un Modelo Digital del Terreno\u2014 es necesario emplear alg\u00fan m\u00e9todo para asignarles dicha representaci\u00f3n. Este puede ser asignado por defecto por el servidor, que establecer\u00e1 una simbolog\u00eda fija, o bien ofrecer un servicio m\u00e1s complejo en el que el cliente no solo pide una representaci\u00f3n gr\u00e1fica de una serie de datos para una zona dada, sino que adem\u00e1s puede especificar c\u00f3mo crear esa representaci\u00f3n (v\u00eda SLD).</p> <ul> <li>Servir los datos directamente. Una opci\u00f3n m\u00e1s flexible que lo anterior es que el servidor provea directamente los datos geogr\u00e1ficos y sea despu\u00e9s el cliente quien los utilice como corresponda, bien sea simplemente represent\u00e1ndolos \u2014en cuyo caso deber\u00eda ser el propio cliente quien establezca la simbolog\u00eda, ya que esta tarea ya no queda en manos del servidor\u2014 o bien trabajando con ellos de cualquier otra forma, como por ejemplo analiz\u00e1ndolos. Ejemplo WFS</li> </ul> <p>Aunque las posibilidades son mayores en este caso, se requieren por parte del cliente unas capacidades mayores, ya que mientras que representar una imagen es algo sumamente sencillo desde el punto de vista t\u00e9cnico, crear esta a partir de los datos geogr\u00e1ficos es m\u00e1s complejo.</p> <ul> <li> <p>Servir consultas. Un paso m\u00e1s all\u00e1 en la funcionalidad que puede ofrecer el servidor es responder a preguntas realizadas por el cliente relativas a los datos, ya sean estas relativas a la parte espacial de dichos datos, o bien a su componente tem\u00e1tica. El servidor puede ofrecer como respuesta conjuntos reducidos de los datos de los que dispone, o valores que describan a estos. Estas consultas pueden ser \u00fatiles, por ejemplo, para establecer filtros previos cuando se dispone de un conjunto amplio de or\u00edgenes de datos. Un cliente Web puede obtener datos de distintos servidores, y puede consultar si, para un zona dada, estos servidores disponen de informaci\u00f3n, sin m\u00e1s que consultar la extensi\u00f3n cubierta por los datos de cada uno de ellos y comprobar si se intersecta con la regi\u00f3n de inter\u00e9s. En funci\u00f3n de la respuesta, puede o no realizarse posteriormente el acceso a los datos en s\u00ed. Ejemplo CSW</p> </li> <li> <p>Servir procesos. Por \u00faltimo, un servidor puede ofrecer nuevos datos, espaciales o no espaciales, resultantes de alg\u00fan tipo de proceso o c\u00e1lculo a partir de datos espaciales. En este caso, el proceso constituye en s\u00ed el servicio ofrecido por el servidor, y el cliente debe definir los par\u00e1metros de entrada de este y los posibles par\u00e1metros de ajuste que resulten necesarios. Los datos con los que se trabaja pueden ser proporcionados por el cliente, incorpor\u00e1ndolos a su propia petici\u00f3n, o bien pueden residir en el propio servidor. En este \u00faltimo caso, el servidor ofrece tanto los datos, como la posibilidad de extraer resultados a partir de ellos, es decir, los datos y una herramienta para explotarlos. Tambi\u00e9n pueden emplearse datos en un servidor distinto, a los que el servidor de procesos puede acceder si estos est\u00e1n disponibles, convirti\u00e9ndose en cliente de ese segundo servidor. Ejemplo WPS</p> </li> </ul> <p>Las posibilidades que estos servicios brindan son muy numerosas. Por una parte, pueden a\u00f1adirse funcionalidades avanzadas a interfaces Web, llevando a estas las capacidades propias de los SIG de escritorio. Por otra, la difusi\u00f3n de algoritmos de an\u00e1lisis geogr\u00e1fico resulta m\u00e1s sencilla, pudiendo ofrecerse estos a todo tipo de usuarios sin necesidad de ning\u00fan software especializado. Y por \u00faltimo, en ciertos casos pueden rebajarse los tiempos de proceso, ya que, en el caso de operaciones complejas, la mayor potencia del servidor respecto al cliente puede resultar en un mayor rendimiento. El reparto de tareas entre varios servidores (computaci\u00f3n distribuida) es otra de las posibilidades que pueden a su vez ampliar la eficiencia de los procesos.</p>"},{"location":"6_conceptos_geoservicios/#referencias","title":"Referencias","text":"<p>Libro libre SIG de Victor Olaya http://volaya.github.io/libro-sig/</p>"},{"location":"7_ejemplo_servicio_wms/","title":"Ejemplo servicio WMS","text":""},{"location":"7_ejemplo_servicio_wms/#acceso-al-servicio-wms","title":"Acceso al servicio WMS","text":"<p>La manera m\u00e1s f\u00e1cil de encontrar las url de los servicios WMS es buscando en la IDE correspondiente o si conocemos al proveedor del servicio buscando en su p\u00e1gina web.</p> <p>En el portal del PNOA podemos encontrar los diferentes productos y servicios que ofrece. Otro ejemplo tambi\u00e9n ser\u00eda la web del Institut Cartogr\u00e0fic i Geol\u00f2gic de Catalunya (ICGC) </p> <p>La url del servicio WMS de Ortofotos del PNOA es: http://www.ign.es/wms-inspire/pnoa-ma?request=GetCapabilities&amp;service=WMS</p> <p>Para ver las capacidades y descripci\u00f3n del servicio tenemos que hacer una consulta GetCapabilities http://www.ign.es/wms-inspire/pnoa-ma?request=GetCapabilities&amp;service=WMS. Al abrir la consulta en nuestro navegador vemos un XML donde se describe el servicio y donde podremos sacar los par\u00e1metros necesarios para poder visualizar el servicio en nuestro visor de mapas.</p> <p>Para ver los datos de este servicio sobre un mapa crearemos un visor utilizando Leaflet. <sup>1</sup></p>"},{"location":"7_ejemplo_servicio_wms/#creacion-de-un-visor","title":"Creaci\u00f3n de un visor","text":"<ul> <li>Crear una carpeta con el nombre de visor-wms.</li> <li>Crear un archivo con el nombre de index.html dentro de la carpeta</li> <li>Abrir el archivo index.html con un editor de texto y copiar el siguiente c\u00f3digo.</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Servicio de WMS&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\"/&gt;\n  &lt;style&gt;\n    #mapid {\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"mapid\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script type=\"text/javascript\"&gt;\n    var map = L.map('mapid');\n    map.setView([41.3887, 2.1777], 13);\n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Abrir el archivo index.html en el navegador para ver que carga un mapa centrado en Barcelona.</p> </li> <li> <p>Agregar la capa WMS del PNOA</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Servicio de WMS&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\"/&gt;\n  &lt;style&gt;\n    #mapid {\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"mapid\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script type=\"text/javascript\"&gt;\n    var map = L.map('mapid');\n    map.setView([41.3887, 2.1777], 13);\n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n\n    var pnoa = L.tileLayer.wms(\"http://www.ign.es/wms-inspire/pnoa-ma?SERVICE=WMS&amp;\", {\n      layers: 'OI.OrthoimageCoverage',\n      format: 'image/png',\n      transparent: true,\n      version: '1.3.0',//wms version (ver get capabilities)\n      attribution: \"PNOA WMS. Cedido por \u00a9 Instituto Geogr\u00e1fico Nacional de Espa\u00f1a\"\n    }).addTo(map);\n\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Recargar la p\u00e1gina para visualizar nuestra capa WMS de Ortofotos.</li> </ul> <p>Ejercicios 1,5 pts</p> <ol> <li> <p>Agregar el servicio WMS de Ortofotos del ICGC. URL del servicio http://geoserveis.icc.cat/icc_mapesmultibase/noutm/wms/service? (1 pt)</p> <p>Ayuda: Para ver el nombre de la capa (layers) hacer un GetCapabilities http://geoserveis.icc.cat/icc_mapesmultibase/noutm/wms/service?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=Getcapabilities.</p> </li> <li> <p>En el par\u00e1metro attribution de la nueva capa poner \"Institut Cartogr\u00e0fic i Geol\u00f2gic de Catalunya\" (0,5 pt)</p> </li> </ol>"},{"location":"7_ejemplo_servicio_wms/#referencias","title":"Referencias","text":"<ol> <li> <p>http://leafletjs.com/ \u21a9</p> </li> </ol>"},{"location":"8_consideraciones_servicios_opendata/","title":"Consideraciones sobre servicios Open data","text":""},{"location":"8_consideraciones_servicios_opendata/#problemas-frecuentes-al-trabajar-con-servicios-open-data","title":"Problemas frecuentes al trabajar con servicios Open Data","text":"<ul> <li> <p>Ausencia de normalizaci\u00f3n u homogeneidad en los portales y servicios.</p> </li> <li> <p>Datos en formatos cerrados o no reutilizables como el pdf.</p> </li> <li> <p>Cambio de las direcciones de los recursos. Por ejemplo, suele ocurrir que cuando se cambia el nombre de un servidor \u00f3 la tecnolog\u00eda del portal ocasiona un cambio en las URLs y dejan de funcionar las aplicaciones y servicios que consumen esos datos.</p> </li> <li> <p>Datos poco fiables, err\u00f3neos, inconsistentes. Falta de  normalizaci\u00f3n y homogeneidad tambi\u00e9n en los datos. Ejemplo https://analisi.transparenciacatalunya.cat/Urbanisme-infraestructures/Equipaments-de-Catalunya/8gmd-gz7i</p> </li> </ul>"},{"location":"8_consideraciones_servicios_opendata/#ejemplo-de-buenas-practicas","title":"Ejemplo de buenas pr\u00e1cticas","text":"<p>Un buen ejemplo de servicios realtime Open Data son los servicios de notificaci\u00f3n de terremotos de el USGS porque est\u00e1n muy bien documentados, tienen salida en m\u00faltiples formatos, son gratuitos y de libre acceso y ofrecen diferentes niveles de usuarios (programadores y no programadores)</p> <p>https://earthquake.usgs.gov/earthquakes/feed/v1.0/geojson.php</p>"},{"location":"8_consideraciones_servicios_opendata/#ejemplo-de-malas-practicas","title":"Ejemplo de \"malas\" pr\u00e1cticas","text":"<p>En el servicio OpenData de la AEMET http://www.aemet.es/es/datos_abiertos/AEMET_OpenData observamos que nos solicitan una API Key para acceder a los servicios y para obtenerla hay que dar una direcci\u00f3n de email y resolver un captcha, lo que constituye una barrera de entrada.  </p> <p>Luego, existe una diferencia clara entre desarrolladores y el acceso general. Y en ninguno de los perfiles de usuarios hay un acceso f\u00e1cil, directo y claro a la informaci\u00f3n. Lo vemos cuando solicitamos un recurso, que nos retorna un json apuntando a otro recurso. </p> <p>Ejemplo https://opendata.aemet.es/opendata/api/prediccion/especifica/municipio/diaria/08001?api_key=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJib2xvc2lnQGdtYWlsLmNvbSIsImp0aSI6ImFkMzFlYjhmLTYxYmQtNGUxMi05Y2E0LTE4MGU4M2UzYzkwNSIsImlzcyI6IkFFTUVUIiwiaWF0IjoxNTExOTgzOTI2LCJ1c2VySWQiOiJhZDMxZWI4Zi02MWJkLTRlMTItOWNhNC0xODBlODNlM2M5MDUiLCJyb2xlIjoiIn0.YYQ93aedA5RM6WTp8XR-gDw3XyMeMxYrCEddDbSpwhU</p> <p>Retorna <pre><code>{\n    \"descripcion\" : \"exito\",\n    \"estado\" : 200,\n    \"datos\" : \"https://opendata.aemet.es/opendata/sh/36188a6b\",\n    \"metadatos\" : \"https://opendata.aemet.es/opendata/sh/dfd88b22\"\n}\n</code></pre></p> <p>Datos https://opendata.aemet.es/opendata/sh/36188a6b</p> <p>Metadatos https://opendata.aemet.es/opendata/sh/dfd88b22</p>"},{"location":"9_ejemplo_servicio_bicing_bcn/","title":"Ejemplo servicio bicing Barcelona","text":""},{"location":"9_ejemplo_servicio_bicing_bcn/#acceso-al-servicio-de-datos-del-bicing-de-barcelona","title":"Acceso al servicio de datos del Bicing de Barcelona","text":"<p>En el portal Open data del Ayuntamiento de Barcelona podemos encontrar un dataset (conjunto de datos) que contiene las estaciones del servicio de Bicing</p> <p>Anteriormente ten\u00edan un servicio donde daban toda la informaci\u00f3n de la estaci\u00f3n en tiempo real http://wservice.viabicing.cat/v2/stations. Actualmente lo han separado en dos servicios unos con la informaci\u00f3n de las estaciones (identificador, nombre, coordenadas, etc.) y otro con estado de las estaciones (n\u00famero de bicis disponibles, tipos de bicis, etc)</p> <p>Si bien el Ayuntamiento de Barcelona no ofrece expl\u00edcitamente el acceso a los datos del Bicing como un servicio, si que tiene un servicio de datos en tiempo real. La url la podemos encontrar presionando el bot\u00f3n de Descargar del recurso json</p> <p> url servicio de bicing</p> <p>Al abrir la url https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_information en nuestro navegador observaremos que la respuesta es un archivo json con un conjunto de elementos que tienen las coordenadas de la localizaci\u00f3n de la estaci\u00f3n de bicing, la direcci\u00f3n, la capacidad, etc.</p> <p>Mapa que utiliza este servicio, https://www.bicing.barcelona/es/mapa-de-disponibilidad-provisional</p> <p>El archivo json que retorna el servicio tiene coordenadas pero no es un fichero GeoJSON. <sup>1</sup></p> <p>Para ver estos datos sobre un mapa crearemos un visor utilizando Leaflet. <sup>2</sup></p>"},{"location":"9_ejemplo_servicio_bicing_bcn/#creacion-de-un-visor","title":"Creaci\u00f3n de un visor","text":"<ul> <li>Crear una carpeta con el nombre de visor-bicing.</li> <li>Crear un archivo con el nombre de index.html dentro de la carpeta</li> <li>Abrir el archivo index.html con un editor de texto y copiar el siguiente c\u00f3digo.</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Servicio de Bicing realtime&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script type=\"text/javascript\"&gt;\n    var map = L.map('map');\n    map.setView([41.3887, 2.1777], 13);\n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Abrir el archivo index.html en el navegador para ver que carga un mapa centrado en Barcelona.</p> </li> <li> <p>Agregar el plugin para cargar datos en tiempo real. Para ellos utilizaremos el plugin Leaflet Realtime <sup>3</sup>.  Copiar lo siguiente justo despu\u00e9s de cuando carguemos la librer\u00eda de Leaflet.</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Servicio de Bicing realtime&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-realtime/2.2.0/leaflet-realtime.min.js\"&gt;&lt;/script&gt;\n  &lt;script type=\"text/javascript\"&gt;\n    var map = L.map('map');\n    map.setView([41.3887, 2.1777], 13);\n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Agregar la capa de realtime del bicing a nuestro mapa. Siguiendo el ejemplo b\u00e1sico del plugin para cagar una capa, copiar lo siguiente al final de nuestro c\u00f3digo de javascript.</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Servicio de Bicing realtime&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-realtime/2.2.0/leaflet-realtime.min.js\"&gt;&lt;/script&gt;\n  &lt;script type=\"text/javascript\"&gt;\n    var map = L.map('map');\n    map.setView([41.3887, 2.1777], 13);\n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n\n    var realtime = L.realtime({\n      url: 'https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_information',\n      crossOrigin: true,\n      type: 'json'\n    }, {\n      interval: 3 * 1000\n    }).addTo(map);\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar la p\u00e1gina para visualizar nuestra capa de bicing. Observaremos que no aparece ning\u00fan dato. Abrir la consola de desarrollador del navegador presionando F12 y veremos que cada 3 segundos aparecer\u00e1 un error. El error es Error: Invalid GeoJSON object.. Este error es debido a lo que ya comentamos; la respuesta del servicio de Bicing no es un GeoJSON.</p> </li> <li> <p>Crear una variable llamada geojson que ser\u00e1 la que contendr\u00e1 el GeoJSON resultante de la transformaci\u00f3n, antes de la declaraci\u00f3n de nuestra capa de realtime</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Servicio de Bicing realtime&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-realtime/2.2.0/leaflet-realtime.min.js\"&gt;&lt;/script&gt;\n  &lt;script type=\"text/javascript\"&gt;\n    var map = L.map('map');\n    map.setView([41.3887, 2.1777], 13);\n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n\n    var geojson = {\n      type: 'FeatureCollection',\n      features: []\n    };\n\n    var realtime = L.realtime({\n      url: 'https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_information',\n      crossOrigin: true,\n      type: 'json'\n    }, {\n      interval: 3 * 1000\n    }).addTo(map);\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Modificar la aplicaci\u00f3n para transformar la respuesta del bicing en un GeoJSON. Modificar nuestra capa realtime con el siguiente c\u00f3digo</li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Servicio de Bicing realtime&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-realtime/2.2.0/leaflet-realtime.min.js\"&gt;&lt;/script&gt;\n  &lt;script type=\"text/javascript\"&gt;\n    var map = L.map('map');\n    map.setView([41.3887, 2.1777], 13);\n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n\n    var geojson = {\n      type: 'FeatureCollection',\n      features: []\n    };\n\n    var realtime = L.realtime(function(success, error) {\n        fetch('https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_information')\n        .then(function(response) {\n            return response.json();\n        })\n        .then(function(data) {\n            var stations = data.data.stations;\n            for (var i = stations.length - 1; i &gt;= 0; i--) {\n                var station = stations[i];\n                var feature = {\n                    type: 'Feature',\n                    properties: {\n                        altitude: station.altitude,\n                        name: station.name,\n                        id: station.station_id,\n                        address: station.address,\n                        post_code: station.post_code,\n                        capacity: station.capacity\n                    },\n                    geometry: {\n                        type: 'Point',\n                        coordinates: [station.lon, station.lat]\n                    }\n                };\n                geojson.features.push(feature);\n            }\n            success(geojson);\n        })\n        .catch(error);\n    }, {\n        interval: 3 * 1000\n    }).addTo(map);\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li> <p>Recargar la aplicaci\u00f3n y veremos los puntos de las estaciones de bicing. Si vamos a la pesta\u00f1a de red (network) en la consola de desarrollador del navegador podremos ver que cada 3 segundos se hace una llamada al servicio.</p> </li> <li> <p>Crear un popup para ver la informaci\u00f3n de la estaci\u00f3n al seleccionarla. Escribir justo despu\u00e9s de donde definimos el intervalo</p> </li> </ul> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Servicio de Bicing realtime&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" /&gt;\n  &lt;style&gt;\n    #map {\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"map\"&gt;&lt;/div&gt;\n\n  &lt;script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/leaflet-realtime/2.2.0/leaflet-realtime.min.js\"&gt;&lt;/script&gt;\n  &lt;script type=\"text/javascript\"&gt;\n    var map = L.map('map');\n    map.setView([41.3887, 2.1777], 13);\n\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n      attribution: '&amp;copy; &lt;a href=\"http://osm.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors'\n    }).addTo(map);\n\n    var geojson = {\n      type: 'FeatureCollection',\n      features: []\n    };\n\n        var realtime = L.realtime(function(success, error) {\n        fetch('https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_information')\n        .then(function(response) {\n            return response.json();\n        })\n        .then(function(data) {\n            var stations = data.data.stations;\n            for (var i = stations.length - 1; i &gt;= 0; i--) {\n                var station = stations[i];\n                var feature = {\n                    type: 'Feature',\n                    properties: {\n                        altitude: station.altitude,\n                        name: station.name,\n                        id: station.station_id,\n                        address: station.address,\n                        post_code: station.post_code,\n                        capacity: station.capacity\n                    },\n                    geometry: {\n                        type: 'Point',\n                        coordinates: [station.lon, station.lat]\n                    }\n                };\n                geojson.features.push(feature);\n            }\n            success(geojson);\n        })\n        .catch(error);\n    }, {\n        interval: 3 * 1000,\n        onEachFeature(f, l) {\n            l.bindPopup(function() {\n                return '&lt;h3&gt;' + f.properties.id + '&lt;/h3&gt;' +\n                    '&lt;p&gt;' + f.properties.address + '&lt;/p&gt;' +\n                    '&lt;p&gt;capacity: &lt;strong&gt;' + f.properties.capacity + '&lt;/strong&gt;&lt;/p&gt;' +\n                    '&lt;p&gt;c\u00f3digo postal: ' + f.properties.post_code + '&lt;/p&gt;';\n            });\n        }\n    }).addTo(map);\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li>Recargar la p\u00e1gina y hacer click sobre alguna estaci\u00f3n para ver su informaci\u00f3n en tiempo real.</li> </ul> <p> mapa de servicio de bicing</p>"},{"location":"9_ejemplo_servicio_bicing_bcn/#referencias","title":"Referencias","text":"<ol> <li> <p>https://es.wikipedia.org/wiki/GeoJSON \u21a9</p> </li> <li> <p>http://leafletjs.com/ \u21a9</p> </li> <li> <p>https://github.com/perliedman/leaflet-realtime \u21a9</p> </li> </ol>"},{"location":"ejemplos/utilizacion-servicio-opendata/javascripts/vendor/slickgrid/2.2/","title":"Welcome to SlickGrid","text":"<p>Find documentation and examples in the wiki.</p> <p>UPDATE:  March 5th, 2014 - I have too many things going on in my life right now to really give SlickGrid support and development the time and attention it deserves.  I am not stopping it, but I will most likely be unresponsive for some time.  Sorry.</p>"},{"location":"ejemplos/utilizacion-servicio-opendata/javascripts/vendor/slickgrid/2.2/#slickgrid-is-an-advanced-javascript-gridspreadsheet-component","title":"SlickGrid is an advanced JavaScript grid/spreadsheet component","text":"<p>Some highlights:</p> <ul> <li>Adaptive virtual scrolling (handle hundreds of thousands of rows with extreme responsiveness)</li> <li>Extremely fast rendering speed</li> <li>Supports jQuery UI Themes</li> <li>Background post-rendering for richer cells</li> <li>Configurable &amp; customizable</li> <li>Full keyboard navigation</li> <li>Column resize/reorder/show/hide</li> <li>Column autosizing &amp; force-fit</li> <li>Pluggable cell formatters &amp; editors</li> <li>Support for editing and creating new rows.</li> <li>Grouping, filtering, custom aggregators, and more!</li> <li>Advanced detached &amp; multi-field editors with undo/redo support.</li> <li>\u201cGlobalEditorLock\u201d to manage concurrent edits in cases where multiple Views on a page can edit the same data.</li> <li>Support for millions of rows</li> </ul>"}]}